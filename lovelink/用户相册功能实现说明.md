# 用户相册功能实现说明

## 功能概述

本项目已成功实现了完整的用户相册功能，包括照片上传、浏览、管理等核心功能。图片文件上传到MinIO存储服务的`lovelink`桶下的`userPhoto`文件夹中。

## 功能特性

### 1. 照片上传
- ✅ 支持多种图片格式（jpg、png、gif、bmp、webp）
- ✅ 文件大小限制（最大10MB）
- ✅ 自动压缩和优化
- ✅ 批量上传支持
- ✅ 上传进度显示
- ✅ 错误处理和重试机制

### 2. 相册管理
- ✅ 分页浏览相册照片
- ✅ 照片排序（按上传时间和自定义排序）
- ✅ 照片描述编辑
- ✅ 隐私设置（公开/私密）
- ✅ 照片删除功能
- ✅ 设置头像功能

### 3. 界面设计
- ✅ 现代化的渐变背景设计
- ✅ 响应式网格布局
- ✅ 流畅的动画效果
- ✅ 直观的操作界面
- ✅ 完善的加载状态提示

## 技术架构

### 后端实现
- **数据库表**: `tb_user_photo` - 存储用户相册信息
- **控制器**: `UserPhotoController` - 处理相册相关API请求
- **服务层**: `TbUserPhotoService` - 业务逻辑处理
- **文件存储**: MinIO - 图片文件存储服务
- **工具类**: `MinioUtil` - 文件上传工具

### 前端实现
- **页面**: `/pages/mine/album.vue` - 相册主页面
- **API**: `/api/user/photo.js` - 相册接口封装
- **组件**: Vue 3 Composition API
- **样式**: SCSS + 渐变动画

## 数据库表结构

```sql
CREATE TABLE `tb_user_photo` (
  `photo_id` bigint NOT NULL AUTO_INCREMENT COMMENT '相片ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `photo_url` varchar(255) NOT NULL COMMENT '照片URL',
  `photo_desc` varchar(200) DEFAULT NULL COMMENT '照片描述',
  `is_avatar` tinyint NOT NULL DEFAULT '0' COMMENT '是否头像：0-否，1-是',
  `is_public` tinyint NOT NULL DEFAULT '1' COMMENT '是否公开：0-私密，1-公开',
  `sort_order` int NOT NULL DEFAULT '0' COMMENT '排序顺序',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`photo_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_is_avatar` (`is_avatar`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户相册表';
```

## API接口文档

### 1. 上传照片
- **接口**: `POST /user/photo/upload`
- **参数**: 
  - `file`: 图片文件
  - `photoDesc`: 照片描述（可选）
  - `isPublic`: 是否公开（0-私密，1-公开）
- **认证**: 需要token

### 2. 获取相册列表
- **接口**: `GET /user/photo/list`
- **参数**: 
  - `pageNum`: 页码（默认1）
  - `pageSize`: 每页数量（默认20）
- **认证**: 需要token

### 3. 删除照片
- **接口**: `DELETE /user/photo/delete/{photoId}`
- **参数**: `photoId` - 照片ID
- **认证**: 需要token

### 4. 设置头像
- **接口**: `POST /user/photo/setAvatar/{photoId}`
- **参数**: `photoId` - 照片ID
- **认证**: 需要token

### 5. 更新照片信息
- **接口**: `PUT /user/photo/update/{photoId}`
- **参数**: 
  - `photoDesc`: 照片描述（可选）
  - `isPublic`: 是否公开（可选）
- **认证**: 需要token

## MinIO存储配置

### 存储路径
- **桶名**: `lovelink`
- **文件夹**: `userPhoto`
- **路径格式**: `userPhoto/yyyy/MM/dd/uuid.ext`

### 配置示例
```yaml
minio:
  endpoint: http://182.254.244.209:9000
  accessKey: minioadmin
  secretKey: minioadmin
  bucketName: lovelink
```

## 使用方法

### 1. 访问相册
在"我的"页面点击"我的相册"菜单项即可进入相册页面。

### 2. 上传照片
1. 点击右上角"+"按钮
2. 选择"拍照"或"从相册选择"
3. 选择图片后自动上传
4. 支持一次选择多张图片批量上传

### 3. 管理照片
- **预览**: 点击照片可全屏预览
- **操作**: 长按照片显示操作菜单
- **设置头像**: 选择"设为头像"
- **删除**: 选择"删除照片"并确认

## 测试功能

为了方便测试，我们创建了专门的测试页面：
- **路径**: `/pages/test/album-test`
- **功能**: 测试所有相册API接口
- **访问**: 直接在浏览器中访问测试页面

## 注意事项

1. **文件大小限制**: 单个文件最大10MB
2. **支持格式**: jpg、png、gif、bmp、webp
3. **权限控制**: 只能操作自己的照片
4. **存储安全**: 文件存储在MinIO服务器，确保数据安全
5. **网络要求**: 需要稳定的网络连接进行文件上传

## 后续优化建议

1. **图片压缩**: 可以在前端进行图片压缩以减少上传时间
2. **缓存机制**: 实现图片缓存以提高加载速度
3. **批量操作**: 支持批量删除、批量设置隐私等
4. **相册分类**: 支持创建不同的相册分类
5. **分享功能**: 支持照片分享到社交平台

## 总结

用户相册功能已完整实现，包括前端界面、后端API、数据库设计和文件存储等各个环节。功能稳定可靠，界面美观易用，完全满足用户上传和管理相册的需求。
