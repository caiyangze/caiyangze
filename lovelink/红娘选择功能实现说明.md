# 红娘选择功能实现说明

## 功能概述

实现了用户在发起牵线申请时可以选择指定红娘的功能，用户可以：
1. 选择系统自动分配红娘（原有功能）
2. 从可用红娘列表中选择指定红娘（新增功能）
3. 按红娘等级筛选（金牌、正式、预备红娘）
4. 查看红娘昵称而非真实姓名（保护隐私）

## 后端实现

### 1. 修改DTO
- **文件**: `lovelink-user/src/main/java/com/zhentao/dto/MatchmakingRequestCreateDTO.java`
- **修改**: 添加可选的 `matchmakerId` 字段

### 2. 新增红娘信息DTO
- **文件**: `lovelink-user/src/main/java/com/zhentao/dto/MatchmakerInfoDTO.java`
- **用途**: 用于前端展示红娘信息，包含等级、经验、评分等
- **隐私保护**: 使用昵称而非真实姓名

### 3. 控制器新增接口
- **文件**: `lovelink-user/src/main/java/com/zhentao/controller/MatchmakingRequestController.java`
- **新增接口**:
  - `GET /user/matchmaking/available-matchmakers?level={level}` - 获取可用红娘列表，支持等级筛选
- **修改接口**:
  - `POST /user/matchmaking/submit` - 支持用户指定红娘ID

### 4. 红娘分配逻辑
- 如果用户指定了红娘ID，验证红娘是否可用后直接分配
- 如果用户未指定，使用原有的智能分配算法
- 分配算法考虑红娘等级、成功次数、从业年限和当前工作负载

## 前端实现

### 1. API接口
- **文件**: `abab_uniapp/api/matchmaker.js`
- **新增**: `getAvailableMatchmakers(level)` 函数，支持等级筛选
- **修改**: `submitMatchmakingRequest()` 支持传入红娘ID

### 2. 申请页面
- **文件**: `abab_uniapp/pages/matchmaker/request.vue`
- **新增功能**:
  - 红娘选择选项（自动分配 vs 指定红娘）
  - 红娘列表弹窗
  - 等级筛选功能（全部、金牌、正式、预备）
  - 红娘信息展示（昵称、等级、经验、成功案例等）
  - 推荐红娘标识

### 3. 测试页面
- **文件**: `abab_uniapp/pages/test/matchmaker-selection-test.vue`
- **用途**: 测试红娘选择功能的各个接口

## 使用流程

### 用户操作流程
1. 用户进入牵线申请页面
2. 在"选择红娘"部分，用户可以选择：
   - **系统自动分配**: 系统根据算法智能分配最合适的红娘
   - **选择指定红娘**: 点击后弹出红娘列表，用户可以查看并选择心仪的红娘
3. 填写申请留言
4. 提交申请

### 红娘列表展示
- 显示红娘的基本信息：昵称（非真实姓名）、等级、服务区域
- 显示专业信息：从业年限、成功案例数、当前处理申请数
- 显示个人介绍
- 标识推荐红娘（前3名）
- 支持按等级筛选：全部、金牌红娘、正式红娘、预备红娘

## 技术特点

### 1. 智能推荐
- 根据红娘的综合评分进行排序
- 评分算法考虑多个维度：
  - 等级权重（30%）
  - 成功次数权重（25%）
  - 从业年限权重（20%）
  - 工作负载权重（25%）

### 2. 用户体验
- 直观的选择界面
- 详细的红娘信息展示
- 推荐标识帮助用户选择
- 流畅的交互动画

### 3. 数据安全与隐私保护
- 只展示必要的红娘信息
- 使用昵称而非真实姓名保护隐私
- 敏感信息（如身份证号、电话号码）不对外暴露
- 验证红娘状态确保服务质量

## 测试方法

### 1. 后端测试
```bash
# 启动用户服务
cd lovelink-user
mvn spring-boot:run

# 测试获取红娘列表接口（全部）
curl -X GET "http://localhost:9001/user/matchmaking/available-matchmakers" \
  -H "token: YOUR_TOKEN"

# 测试获取金牌红娘列表
curl -X GET "http://localhost:9001/user/matchmaking/available-matchmakers?level=3" \
  -H "token: YOUR_TOKEN"

# 测试提交申请（指定红娘）
curl -X POST "http://localhost:9001/user/matchmaking/submit" \
  -H "Content-Type: application/json" \
  -H "token: YOUR_TOKEN" \
  -d '{
    "targetUserId": 1,
    "matchmakerId": 1,
    "requestMessage": "测试申请"
  }'
```

### 2. 前端测试
1. 访问测试页面：`/pages/test/matchmaker-selection-test`
2. 点击各个测试按钮验证功能
3. 访问申请页面：`/pages/matchmaker/request?targetUserId=1`
4. 测试红娘选择功能

## 注意事项

1. **数据库要求**: 确保 `tb_matchmaker` 表中有可用的红娘数据
2. **权限验证**: 所有接口都需要有效的用户token
3. **状态检查**: 只显示状态为1（正常服务）的红娘
4. **错误处理**: 如果选择的红娘不可用，会提示用户重新选择

## 后续优化建议

1. **红娘头像**: 集成红娘头像显示
2. **评价系统**: 添加用户对红娘的评价功能
3. **地域匹配**: 根据用户地理位置推荐附近的红娘
4. **实时状态**: 显示红娘的在线状态
5. **预约功能**: 允许用户预约特定时间的红娘服务
