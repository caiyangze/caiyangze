<template>
  <view class="user-detail-page" :style="{ background: computedBg }">
    <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
    <view v-if="loading" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">Âä†ËΩΩ‰∏≠...</text>
    </view>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπ -->
    <view v-else class="main-wrapper">

      <!-- Ëá™ÂÆö‰πâÂØºËà™Ê†è -->
      <view class="custom-navbar" :style="{ paddingTop: statusBarHeight + 'px' }">
        <view class="navbar-content">
          <view class="nav-left" @tap="goBack">
            <text class="nav-icon">‚Üê</text>
          </view>
          <view class="nav-center">
            <text class="nav-title">{{ (userInfo && userInfo.nickname) || 'Áî®Êà∑ËØ¶ÊÉÖ' }}</text>
          </view>
          <view class="nav-right" @tap="showMoreActions">
            <text class="nav-icon">‚ãØ</text>
          </view>
        </view>
      </view>

      <!-- ÊªöÂä®ÂÜÖÂÆπ -->
      <scroll-view
          scroll-y
          class="scroll-container"
          :style="{ paddingTop: statusBarHeight + 88 + 'px' }"
      >
        <!-- Áî®Êà∑ËµÑÊñôÂå∫Âüü -->
        <view class="user-profile">
          <!-- Â§¥ÂÉèÂå∫Âüü -->
          <view class="avatar-container">
            <image
                :src="userInfo.avatarUrl || '/static/common/default-avatar.png'"
                mode="aspectFill"
                class="user-avatar"
                @error="handleImageError"
            />
            <view v-if="userInfo.isOnline" class="online-indicator"></view>
            <view class="badges">
              <view v-if="userInfo.isVip === 1" class="vip-badge">VIP</view>
              <view v-if="userInfo.userRole === 2" class="matchmaker-badge">Á∫¢Â®ò</view>
              <view v-if="userInfo.isVerified === 1" class="verified-badge">‚úì</view>
            </view>
          </view>

          <!-- Áî®Êà∑Âêç -->
          <view class="username-section">
            <text class="user-name">{{ userInfo.nickname || 'Áî®Êà∑' }}</text>
          </view>



          <!-- ÊÄßÂà´ÂíåÂπ¥ÈæÑ‰ø°ÊÅØ -->
          <view class="gender-age-section">
            <text class="gender-age-text">{{ getGenderAndAge() }}</text>
          </view>

          <!-- ÁªüËÆ°Êï∞ÊçÆ -->
          <view class="stats-row">
            <view class="stat-item">
              <text class="stat-count">{{ userInfo.countFollow || 0 }}</text>
              <text class="stat-label">ÂÖ≥Ê≥®</text>
            </view>
            <view class="stat-item">
              <text class="stat-count">{{ userInfo.fan || 0 }}</text>
              <text class="stat-label">Á≤â‰∏ù</text>
            </view>
            <view class="stat-item">
              <text class="stat-count">{{ userInfo.countLike || 0 }}</text>
              <text class="stat-label">Ëé∑Ëµû</text>
            </view>
          </view>

          <!-- ‰∏™‰∫∫ÁÆÄ‰ªã -->
          <view class="bio-section" v-if="userProfile.selfIntroduction">
            <text class="bio-text">{{ userProfile.selfIntroduction }}</text>
          </view>

          <!-- ÂÖ≥Ê≥®ÊåâÈíÆ -->
          <view class="follow-button-container">
            <view
              class="follow-button"
              :class="{ followed: userInfo.isFollowed }"
              @tap="toggleFollow"
            >
              <text class="follow-text">{{ userInfo.isFollowed ? 'Â∑≤ÂÖ≥Ê≥®' : 'ÂÖ≥Ê≥®' }}</text>
            </view>
          </view>
        </view>

        <!-- Ê†áÁ≠æÂ±ïÁ§∫ -->
        <view class="tags-section" v-if="userTags.length > 0">
          <view class="tag-item" v-for="tag in userTags" :key="tag.id">
            <text class="tag-text">{{ tag.tagName }}</text>
          </view>
        </view>

        <!-- Ê†áÁ≠æÈ°µÂàáÊç¢ -->
        <view class="tab-bar">
          <view
              class="tab-item"
              :class="{ active: currentTab === 'photos' }"
              @tap="switchTab('photos')"
          >
            <text class="tab-text">Áõ∏ÂÜå</text>
          </view>
          <view
              class="tab-item"
              :class="{ active: currentTab === 'moments' }"
              @tap="switchTab('moments')"
          >
            <text class="tab-text">Âä®ÊÄÅ</text>
          </view>
          <view
              class="tab-item"
              :class="{ active: currentTab === 'info' }"
              @tap="switchTab('info')"
          >
            <text class="tab-text">ËµÑÊñô</text>
          </view>
        </view>

        <!-- ÂÜÖÂÆπÂå∫Âüü -->
        <view class="content-container">
          <!-- Áõ∏ÂÜåÂÜÖÂÆπ -->
          <view v-if="currentTab === 'photos'" class="photos-content">
            <view v-if="userPhotos.length > 0" class="photo-grid">
              <view
                  class="photo-item"
                  v-for="(photo, index) in userPhotos"
                  :key="photo.photoId"
                  @tap="previewPhoto(index)"
              >
                <image
                    :src="photo.photoUrl"
                    mode="aspectFill"
                    class="photo-image"
                    @error="handlePhotoError(index)"
                />
              </view>
            </view>
            <view v-else class="empty-state">
              <text class="empty-icon">üì∑</text>
              <text class="empty-text">ÊöÇÊó†ÁÖßÁâá</text>
            </view>
          </view>

          <!-- Âä®ÊÄÅÂÜÖÂÆπ -->
          <view v-if="currentTab === 'moments'" class="moments-content">
            <view v-if="userMoments.length > 0" class="moment-list">
              <view class="moment-item" v-for="moment in userMoments" :key="moment.momentId">
                <view class="moment-header">
                  <view class="moment-info">
                    <text class="moment-time">{{ formatTime(moment.createdAt) }}</text>
                    <text v-if="moment.location" class="moment-location">üìç {{ moment.location }}</text>
                  </view>
                </view>

                <view class="moment-content">
                  <text class="moment-text">{{ moment.content }}</text>
                </view>

                <view v-if="moment.mediaList && moment.mediaList.length > 0" class="moment-media">
                  <view
                      class="media-grid"
                      :class="getMediaGridClass(moment.mediaList.length)"
                  >
                    <view
                        class="media-item"
                        v-for="(media, index) in moment.mediaList"
                        :key="media.mediaId"
                        @tap="previewMomentMedia(moment.mediaList, index)"
                    >
                      <image
                          :src="media.mediaUrl"
                          mode="aspectFill"
                          class="media-image"
                      />
                    </view>
                  </view>
                </view>

                <view class="moment-actions">
                  <view class="action-item" @tap="toggleMomentLike(moment)">
                    <text class="action-icon" :class="{ liked: moment.isLiked }">
                      {{ moment.isLiked ? '‚ù§Ô∏è' : 'ü§ç' }}
                    </text>
                    <text class="action-count">{{ moment.likeCount || 0 }}</text>
                  </view>
                  <view class="action-item" @tap="viewMomentComments(moment)">
                    <text class="action-icon">üí¨</text>
                    <text class="action-count">{{ moment.commentCount || 0 }}</text>
                  </view>
                  <view class="action-item">
                    <text class="action-icon">üëÅ</text>
                    <text class="action-count">{{ moment.viewCount || 0 }}</text>
                  </view>
                </view>
              </view>
            </view>
            <view v-else class="empty-state">
              <text class="empty-icon">üìù</text>
              <text class="empty-text">ÊöÇÊó†Âä®ÊÄÅ</text>
            </view>
          </view>

          <!-- ËµÑÊñôÂÜÖÂÆπ -->
          <view v-if="currentTab === 'info'" class="info-content">
            <!-- ‰∏™‰∫∫‰ªãÁªç -->
            <view class="info-section" v-if="userProfile.selfIntroduction">
              <view class="section-title">üí≠ ‰∏™‰∫∫‰ªãÁªç</view>
              <view class="intro-text">{{ userProfile.selfIntroduction }}</view>
            </view>

            <!-- Âü∫Êú¨ËµÑÊñô -->
            <view class="info-section">
              <view class="section-title">üìã Âü∫Êú¨ËµÑÊñô</view>
              <view class="info-grid">
                <view class="info-item" v-if="userProfile.height">
                  <text class="info-label">Ë∫´È´ò</text>
                  <text class="info-value">{{ userProfile.height }}cm</text>
                </view>
                <view class="info-item" v-if="userProfile.weight">
                  <text class="info-label">‰ΩìÈáç</text>
                  <text class="info-value">{{ userProfile.weight }}kg</text>
                </view>
                <view class="info-item" v-if="userProfile.education">
                  <text class="info-label">Â≠¶ÂéÜ</text>
                  <text class="info-value">{{ getEducationText(userProfile.education) }}</text>
                </view>
                <view class="info-item" v-if="userProfile.company">
                  <text class="info-label">ÂÖ¨Âè∏</text>
                  <text class="info-value">{{ userProfile.company }}</text>
                </view>
                <view class="info-item" v-if="userProfile.position">
                  <text class="info-label">ËÅå‰Ωç</text>
                  <text class="info-value">{{ userProfile.position }}</text>
                </view>
                <view class="info-item" v-if="userProfile.incomeLevel">
                  <text class="info-label">Êî∂ÂÖ•</text>
                  <text class="info-value">{{ getIncomeLevelText(userProfile.incomeLevel) }}</text>
                </view>
                <view class="info-item" v-if="userProfile.maritalStatus">
                  <text class="info-label">Â©öÂßªÁä∂ÂÜµ</text>
                  <text class="info-value">{{ getMaritalStatusText(userProfile.maritalStatus) }}</text>
                </view>
                <view class="info-item" v-if="userProfile.hasChildren !== null">
                  <text class="info-label">Â≠êÂ•≥</text>
                  <text class="info-value">{{ userProfile.hasChildren ? 'Êúâ' : 'Êó†' }}</text>
                </view>
                <view class="info-item" v-if="userProfile.houseStatus">
                  <text class="info-label">Êàø‰∫ß</text>
                  <text class="info-value">{{ getHouseStatusText(userProfile.houseStatus) }}</text>
                </view>
                <view class="info-item" v-if="userProfile.carStatus">
                  <text class="info-label">ËΩ¶‰∫ß</text>
                  <text class="info-value">{{ getCarStatusText(userProfile.carStatus) }}</text>
                </view>
                <view class="info-item" v-if="userProfile.hobby">
                  <text class="info-label">Áà±Â•Ω</text>
                  <text class="info-value">{{ userProfile.hobby }}</text>
                </view>
              </view>
            </view>

            <!-- ËÆ§ËØÅ‰ø°ÊÅØ -->
            <view class="info-section" v-if="userInfo.isVerified === 1">
              <view class="section-title">‚úÖ ËÆ§ËØÅ‰ø°ÊÅØ</view>
              <view class="cert-item">
                <text class="cert-icon">üÜî</text>
                <text class="cert-text">ÂÆûÂêçËÆ§ËØÅ</text>
                <text class="cert-status verified">Â∑≤ËÆ§ËØÅ</text>
              </view>
            </view>
          </view>
        </view>

        <!-- Â∫ïÈÉ®Âç†‰Ωç -->
        <view class="bottom-placeholder"></view>
      </scroll-view>

      <!-- Â∫ïÈÉ®Êìç‰ΩúÊåâÈíÆ -->
      <view class="bottom-actions">
        <view class="action-btn secondary" @tap="sendMessage">
          <text class="btn-icon">üí¨</text>
          <text class="btn-text">ÂèëÊ∂àÊÅØ</text>
        </view>
        <view class="action-btn primary" @tap="requestIntroduction">
          <text class="btn-icon">üíï</text>
          <text class="btn-text">Áî≥ËØ∑‰ªãÁªç</text>
        </view>
      </view>
    </view>
  </view>
</template>

<script setup>
import { ref, reactive, computed, onMounted, getCurrentInstance } from 'vue'
import {
  getUserDetail,
  getUserPhotos,
  getUserMoments,
  toggleUserFollow,
  checkUserFollow
} from '@/api/user/detail'
import { useGlobalThemeMixin } from '@/mixins/global-theme-mixin.js'

// ‰ΩøÁî®ÂÖ®Â±Ä‰∏ªÈ¢òÊ∑∑ÂÖ•
const { currentBackground } = useGlobalThemeMixin()

// ËÆ°ÁÆóÂ±ûÊÄß
const computedBg = computed(() => {
  return currentBackground.value
})

// È°µÈù¢Êï∞ÊçÆ
const userInfo = ref({
  nickname: '',
  gender: 0,
  avatarUrl: '',
  birthDate: null,
  fan: 0,
  countFollow: 0,
  countLike: 0,
  isVip: 0,
  isVerified: 0,
  isLiked: false,
  isFollowed: false,
  isOnline: false
})
const userProfile = ref({
  age: null,
  workCity: '',
  height: null,
  weight: null,
  education: null,
  company: '',
  position: '',
  incomeLevel: null,
  maritalStatus: null,
  hasChildren: null,
  houseStatus: null,
  carStatus: null,
  selfIntroduction: '',
  hobby: ''
})
const userTags = ref([])
const userPhotos = ref([])
const userMoments = ref([])
const photoErrors = reactive({})
const statusBarHeight = ref(0)
const currentTab = ref('photos')
const loading = ref(false)

// È°µÈù¢ÂèÇÊï∞
const pageParams = ref({})

// È°µÈù¢Âä†ËΩΩ
onMounted(() => {
  // Ëé∑ÂèñÁ≥ªÁªüÁä∂ÊÄÅÊ†èÈ´òÂ∫¶
  const sysInfo = uni.getSystemInfoSync()
  statusBarHeight.value = sysInfo.statusBarHeight

  // ‰ªé URL ‰∏≠Ëé∑ÂèñÂèÇÊï∞
  const urlParams = new URLSearchParams(window.location.search)
  let userId = urlParams.get('userId') || urlParams.get('id')

  // Â¶ÇÊûú URL ÂèÇÊï∞‰∏≠Ê≤°ÊúâÔºåÂ∞ùËØï‰ªéË∑ØÁî±ÂèÇÊï∞‰∏≠Ëé∑Âèñ
  if (!userId) {
    // Â∞ùËØï‰ªéÂΩìÂâçË∑ØÁî±‰∏≠Ëé∑ÂèñÂèÇÊï∞
    try {
      const currentRoute = getCurrentInstance()?.proxy?.$route
      if (currentRoute && currentRoute.query) {
        userId = currentRoute.query.userId || currentRoute.query.id
      }
    } catch (e) {
      console.log('Êó†Ê≥ïËé∑ÂèñË∑ØÁî±ÂèÇÊï∞:', e)
    }
  }

  // Â¶ÇÊûúËøòÊòØÊ≤°ÊúâÔºå‰ΩøÁî®ÈªòËÆ§ÊµãËØïÁî®Êà∑ID
  if (!userId) {
    userId = '1' // ‰ΩøÁî®ÈªòËÆ§Áî®Êà∑IDËøõË°åÊµãËØï
    console.warn('Êú™Ëé∑ÂèñÂà∞Áî®Êà∑IDÂèÇÊï∞Ôºå‰ΩøÁî®ÈªòËÆ§Áî®Êà∑ID:', userId)
  }

  pageParams.value = { userId }
  console.log('Ëé∑ÂèñÂà∞ÁöÑuserId:', userId)

  if (userId) {
    getUserDetailData(userId)
  } else {
    console.error('Êú™Ëé∑ÂèñÂà∞Áî®Êà∑IDÂèÇÊï∞')
    uni.showToast({
      title: 'Áî®Êà∑IDÂèÇÊï∞ÈîôËØØ',
      icon: 'none'
    })
  }
})

// Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖ
async function getUserDetailData(userId) {
  try {
    loading.value = true
    let targetUser = null

    // ‰ΩøÁî®Áõ∏‰∫≤ÂπøÂú∫APIËé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÔºàÊîØÊåÅÊåâÁî®Êà∑IDÁ≠õÈÄâÔºâ
    const result = await getUserDetail(userId)
    console.log('getUserDetail ÂìçÂ∫î:', result)

    if (result.code === 200 && result.data && result.data.records) {
      // Êü•ÊâæÊåáÂÆöÁî®Êà∑IDÁöÑÊï∞ÊçÆ
      targetUser = result.data.records.find(user => user.userId == userId)

      if (!targetUser && result.data.records.length > 0) {
        // Â¶ÇÊûúÊ≤°ÊâæÂà∞ÊåáÂÆöÁî®Êà∑Ôºå‰ΩÜÊúâÊï∞ÊçÆÔºåÂèñÁ¨¨‰∏Ä‰∏™ÔºàÂèØËÉΩÊòØÁ≠õÈÄâÈóÆÈ¢òÔºâ
        targetUser = result.data.records[0]
        console.warn('Êú™ÊâæÂà∞ÊåáÂÆöÁî®Êà∑IDÁöÑÊï∞ÊçÆÔºå‰ΩøÁî®Á¨¨‰∏Ä‰∏™Áî®Êà∑Êï∞ÊçÆ')
      }
    }

    if (targetUser) {
      console.log('Ëé∑ÂèñÂà∞ÁöÑÁî®Êà∑Êï∞ÊçÆ:', targetUser)
      console.log('Áî®Êà∑ËµÑÊñô:', targetUser.userProfile)
      console.log('Áî®Êà∑Ê†áÁ≠æ:', targetUser.userTags)
      console.log('Áî®Êà∑ÁÇπËµûÊï∞ countLike:', targetUser.countLike)
      console.log('Áî®Êà∑Á≤â‰∏ùÊï∞ fan:', targetUser.fan)
      console.log('Áî®Êà∑ÂÖ≥Ê≥®Êï∞ countFollow:', targetUser.countFollow)

      // Á°Æ‰øùÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÁªüËÆ°Êï∞ÊçÆ‰∏çË¢´Ë¶ÜÁõñ
      userInfo.value = {
        ...targetUser,
        isLiked: targetUser.isLiked || false,
        isFollowed: targetUser.isFollowed || false,
        isOnline: targetUser.isOnline || false,
        // Á°Æ‰øùÁªüËÆ°Êï∞ÊçÆ‰ΩøÁî®Êï∞ÊçÆÂ∫ìÁöÑÂÄº
        countLike: targetUser.countLike || 0,
        fan: targetUser.fan || 0,
        countFollow: targetUser.countFollow || 0
      }
      userProfile.value = targetUser.userProfile || {}
      userTags.value = targetUser.userTags || []

      // Âä†ËΩΩÁî®Êà∑Áõ∏ÂÜå„ÄÅÂä®ÊÄÅÂíåÂÖ≥Ê≥®Áä∂ÊÄÅ
      await Promise.all([
        loadUserPhotos(userId),
        loadUserMoments(userId),
        loadFollowStatus(userId)
      ])
    } else {
      throw new Error('Êú™ÊâæÂà∞Áî®Êà∑Êï∞ÊçÆ')
    }
  } catch (error) {
    console.error('Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•:', error)
    uni.showToast({ title: 'Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', icon: 'none' })
    userInfo.value = {}
    userProfile.value = {}
    userPhotos.value = []
    userMoments.value = []
  } finally {
    loading.value = false
  }
}

// Âä†ËΩΩÁî®Êà∑Áõ∏ÂÜå
async function loadUserPhotos(userId) {
  try {
    const result = await getUserPhotos(userId, 1, 20) // Ëé∑ÂèñÂâç20Âº†ÁÖßÁâá
    console.log('Áî®Êà∑Áõ∏ÂÜåÂìçÂ∫î:', result)

    if (result.code === 200) {
      // Â§ÑÁêÜÂàÜÈ°µÊï∞ÊçÆÁªìÊûÑ
      if (result.data && result.data.records) {
        userPhotos.value = result.data.records || []
      } else if (Array.isArray(result.data)) {
        userPhotos.value = result.data
      } else {
        userPhotos.value = []
      }
      console.log('Áî®Êà∑Áõ∏ÂÜåÊï∞ÊçÆ:', userPhotos.value)
    } else {
      console.warn('Ëé∑ÂèñÁî®Êà∑Áõ∏ÂÜåÂ§±Ë¥•:', result.message)
      userPhotos.value = []
    }
  } catch (error) {
    console.error('Ëé∑ÂèñÁî®Êà∑Áõ∏ÂÜåÂ§±Ë¥•:', error)
    userPhotos.value = []
  }
}

// Âä†ËΩΩÁî®Êà∑Âä®ÊÄÅ
async function loadUserMoments(userId) {
  try {
    const result = await getUserMoments(userId, 1, 20) // Ëé∑ÂèñÂâç20Êù°Âä®ÊÄÅ
    if (result.code === 200) {
      // Â§ÑÁêÜÂàÜÈ°µÊï∞ÊçÆÁªìÊûÑ
      if (result.data && result.data.records) {
        userMoments.value = result.data.records || []
      } else {
        userMoments.value = result.data || []
      }
    }
  } catch (error) {
    console.error('Ëé∑ÂèñÁî®Êà∑Âä®ÊÄÅÂ§±Ë¥•:', error)
    userMoments.value = []
  }
}

// Âä†ËΩΩÂÖ≥Ê≥®Áä∂ÊÄÅ
async function loadFollowStatus(targetUserId) {
  try {
    // Ê£ÄÊü•ÊòØÂê¶ÊúâtokenÔºàÊòØÂê¶Â∑≤ÁôªÂΩïÔºâ
    const token = getToken()
    if (!token) {
      console.log('Áî®Êà∑Êú™ÁôªÂΩïÔºåË∑≥ËøáÂÖ≥Ê≥®Áä∂ÊÄÅÊ£ÄÊü•')
      userInfo.value.isFollowed = false
      return
    }

    const result = await checkUserFollow(targetUserId)
    console.log('ÂÖ≥Ê≥®Áä∂ÊÄÅÂìçÂ∫î:', result)

    if (result.code === 200) {
      userInfo.value.isFollowed = result.data || false
      console.log('ÂÖ≥Ê≥®Áä∂ÊÄÅ:', userInfo.value.isFollowed)
    } else if (result.code === 401) {
      console.log('Áî®Êà∑Êú™ÁôªÂΩïÊàñtokenËøáÊúü')
      userInfo.value.isFollowed = false
    }
  } catch (error) {
    console.error('Ëé∑ÂèñÂÖ≥Ê≥®Áä∂ÊÄÅÂ§±Ë¥•:', error)
    userInfo.value.isFollowed = false
  }
}

// ËÆ°ÁÆóÂπ¥ÈæÑ
function calculateAge(birthDate) {
  if (!birthDate) return 'Êú™Áü•'
  try {
    const birth = new Date(birthDate)
    if (isNaN(birth.getTime())) return 'Êú™Áü•'

    const today = new Date()
    let age = today.getFullYear() - birth.getFullYear()
    const monthDiff = today.getMonth() - birth.getMonth()
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
      age--
    }
    return age > 0 ? age : 'Êú™Áü•'
  } catch (error) {
    console.error('ËÆ°ÁÆóÂπ¥ÈæÑÂ§±Ë¥•:', error)
    return 'Êú™Áü•'
  }
}

// Ëé∑ÂèñÊòæÁ§∫Âπ¥ÈæÑ
function getDisplayAge() {
  try {
    if (userProfile.value && userProfile.value.age) {
      return userProfile.value.age
    }
    if (userInfo.value && userInfo.value.birthDate) {
      return calculateAge(userInfo.value.birthDate)
    }
    return 'Êú™Áü•'
  } catch (error) {
    console.error('Ëé∑ÂèñÂπ¥ÈæÑÂ§±Ë¥•:', error)
    return 'Êú™Áü•'
  }
}

// Ëé∑ÂèñÊòæÁ§∫ÊÄßÂà´
function getDisplayGender() {
  try {
    if (userInfo.value && userInfo.value.gender !== undefined) {
      switch (userInfo.value.gender) {
        case 1:
          return 'Áî∑'
        case 2:
          return 'Â•≥'
        default:
          return ''
      }
    }
    return ''
  } catch (error) {
    console.error('Ëé∑ÂèñÊÄßÂà´Â§±Ë¥•:', error)
    return ''
  }
}

// Ëé∑ÂèñÊÄßÂà´ÂõæÊ†á
function getGenderIcon() {
  try {
    if (userInfo.value && userInfo.value.gender !== undefined) {
      switch (userInfo.value.gender) {
        case 1:
          return '‚ôÇ'
        case 2:
          return '‚ôÄ'
        default:
          return ''
      }
    }
    return ''
  } catch (error) {
    console.error('Ëé∑ÂèñÊÄßÂà´ÂõæÊ†áÂ§±Ë¥•:', error)
    return ''
  }
}

// Ëé∑ÂèñÊÄßÂà´ÂíåÂπ¥ÈæÑÁªÑÂêàÊòæÁ§∫
function getGenderAndAge() {
  try {
    const gender = getDisplayGender()
    const genderIcon = getGenderIcon()
    const age = getDisplayAge()

    let result = ''

    // Ê∑ªÂä†ÊÄßÂà´ÂõæÊ†áÂíåÊñáÂ≠ó
    if (gender && genderIcon) {
      result += `${genderIcon}`
    }

    // Ê∑ªÂä†Âπ¥ÈæÑ
    if (age && age !== 'Êú™Áü•') {
      if (result) {
        result += `${age}Â≤Å`
      } else {
        result = `${age}Â≤Å`
      }
    }

    return result || '‰ø°ÊÅØÊú™ÂÆåÂñÑ'
  } catch (error) {
    console.error('Ëé∑ÂèñÊÄßÂà´Âπ¥ÈæÑÂ§±Ë¥•:', error)
    return '‰ø°ÊÅØÊú™ÂÆåÂñÑ'
  }
}

// ÂàáÊç¢Ê†áÁ≠æÈ°µ
function switchTab(tab) {
  currentTab.value = tab
}



// ÂÖ≥Ê≥®/ÂèñÊ∂àÂÖ≥Ê≥®
async function toggleFollow() {
  try {
    const targetUserId = pageParams.value.userId || pageParams.value.id

    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï
    const token = getToken()
    if (!token) {
      uni.showToast({ title: 'ËØ∑ÂÖàÁôªÂΩï', icon: 'none' })
      // ÂèØ‰ª•Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
      // uni.navigateTo({ url: '/pages/login/login' })
      return
    }

    // Â¶ÇÊûúÂΩìÂâçÊòØÂ∑≤ÂÖ≥Ê≥®Áä∂ÊÄÅÔºåÊòæÁ§∫ÂèñÊ∂àÂÖ≥Ê≥®Á°ÆËÆ§ÊèêÁ§∫
    if (userInfo.value.isFollowed) {
      uni.showModal({
        title: 'ÂèñÊ∂àÂÖ≥Ê≥®',
        content: `Á°ÆÂÆöË¶ÅÂèñÊ∂àÂÖ≥Ê≥® ${userInfo.value.nickname || 'ËØ•Áî®Êà∑'} ÂêóÔºü`,
        confirmText: 'ÂèñÊ∂àÂÖ≥Ê≥®',
        cancelText: 'ÊàëÂÜçÊÉ≥ÊÉ≥',
        confirmColor: '#ff4757',
        success: async (res) => {
          if (res.confirm) {
            await performFollowAction(targetUserId)
          }
        }
      })
    } else {
      // Áõ¥Êé•ÊâßË°åÂÖ≥Ê≥®Êìç‰Ωú
      await performFollowAction(targetUserId)
    }
  } catch (error) {
    console.error('ÂÖ≥Ê≥®Êìç‰ΩúÂ§±Ë¥•:', error)
    uni.showToast({ title: 'Êìç‰ΩúÂ§±Ë¥•', icon: 'none' })
  }
}

// ÊâßË°åÂÖ≥Ê≥®/ÂèñÊ∂àÂÖ≥Ê≥®Êìç‰Ωú
async function performFollowAction(targetUserId) {
  try {
    const result = await toggleUserFollow(targetUserId)
    console.log('ÂÖ≥Ê≥®Êìç‰ΩúÂìçÂ∫î:', result)

    if (result.code === 200) {
      // Êõ¥Êñ∞ÂÖ≥Ê≥®Áä∂ÊÄÅ
      userInfo.value.isFollowed = !userInfo.value.isFollowed

      // Êõ¥Êñ∞Á≤â‰∏ùÊï∞ÈáèÔºàÊú¨Âú∞ËÆ°ÁÆóÔºâ
      if (userInfo.value.isFollowed) {
        // ÂÖ≥Ê≥®ÊàêÂäüÔºåÁ≤â‰∏ùÊï∞+1
        userInfo.value.fan = (userInfo.value.fan || 0) + 1
      } else {
        // ÂèñÊ∂àÂÖ≥Ê≥®ÔºåÁ≤â‰∏ùÊï∞-1
        userInfo.value.fan = Math.max((userInfo.value.fan || 0) - 1, 0)
      }

      uni.showToast({
        title: result.message || (userInfo.value.isFollowed ? 'ÂÖ≥Ê≥®ÊàêÂäü' : 'ÂèñÊ∂àÂÖ≥Ê≥®ÊàêÂäü'),
        icon: 'success'
      })

      // ÂèØÈÄâÔºöÈáçÊñ∞Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖ‰ª•Á°Æ‰øùÊï∞ÊçÆÂáÜÁ°ÆÊÄßÔºàÊé®ËçêÂºÄÂêØÔºâ
      await refreshUserDetail(targetUserId)

    } else if (result.code === 401) {
      uni.showToast({ title: 'ÁôªÂΩïÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï', icon: 'none' })
      // ÂèØ‰ª•Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
      // uni.navigateTo({ url: '/pages/login/login' })
    } else {
      uni.showToast({ title: result.message || 'Êìç‰ΩúÂ§±Ë¥•', icon: 'none' })
    }
  } catch (error) {
    console.error('ÂÖ≥Ê≥®Êìç‰ΩúÂ§±Ë¥•:', error)
    uni.showToast({ title: 'Êìç‰ΩúÂ§±Ë¥•', icon: 'none' })
  }
}

// Âà∑Êñ∞Áî®Êà∑ËØ¶ÊÉÖÊï∞ÊçÆÔºàÂèØÈÄâÔºåÁ°Æ‰øùÊï∞ÊçÆÂáÜÁ°ÆÊÄßÔºâ
async function refreshUserDetail(targetUserId) {
  try {
    console.log('Âà∑Êñ∞Áî®Êà∑ËØ¶ÊÉÖÊï∞ÊçÆ...')
    const result = await getUserDetail(targetUserId)

    if (result.code === 200 && result.data && result.data.records) {
      const targetUser = result.data.records.find(user => user.userId == targetUserId)

      if (targetUser) {
        // Âè™Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆÔºå‰øùÊåÅÂΩìÂâçÁöÑÂÖ≥Ê≥®Áä∂ÊÄÅ
        const currentFollowStatus = userInfo.value.isFollowed

        userInfo.value = {
          ...targetUser,
          isLiked: targetUser.isLiked || false,
          isFollowed: currentFollowStatus, // ‰øùÊåÅÂΩìÂâçÂÖ≥Ê≥®Áä∂ÊÄÅ
          isOnline: targetUser.isOnline || false,
          // Á°Æ‰øùÁªüËÆ°Êï∞ÊçÆ‰ΩøÁî®Êï∞ÊçÆÂ∫ìÁöÑÊúÄÊñ∞ÂÄº
          countLike: targetUser.countLike || 0,
          fan: targetUser.fan || 0,
          countFollow: targetUser.countFollow || 0
        }

        console.log('Áî®Êà∑ËØ¶ÊÉÖÊï∞ÊçÆÂà∑Êñ∞ÊàêÂäüÔºåÊúÄÊñ∞Á≤â‰∏ùÊï∞:', userInfo.value.fan)
        console.log('Áî®Êà∑ËØ¶ÊÉÖÊï∞ÊçÆÂà∑Êñ∞ÊàêÂäüÔºåÊúÄÊñ∞ÁÇπËµûÊï∞:', userInfo.value.countLike)
      }
    }
  } catch (error) {
    console.error('Âà∑Êñ∞Áî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•:', error)
  }
}

// ËøîÂõû‰∏ä‰∏ÄÈ°µ
function goBack() {
  uni.navigateBack()
}

// ÊòæÁ§∫Êõ¥Â§öÊìç‰Ωú
function showMoreActions() {
  uni.showActionSheet({
    itemList: ['‰∏æÊä•', 'ÊãâÈªë'],
    success: (res) => {
      if (res.tapIndex === 0) {
        // ‰∏æÊä•
        uni.showToast({ title: '‰∏æÊä•ÂäüËÉΩÂºÄÂèë‰∏≠', icon: 'none' })
      } else if (res.tapIndex === 1) {
        // ÊãâÈªë
        uni.showToast({ title: 'ÊãâÈªëÂäüËÉΩÂºÄÂèë‰∏≠', icon: 'none' })
      }
    }
  })
}

// È¢ÑËßàÁÖßÁâá
function previewPhoto(index) {
  const urls = userPhotos.value.map(photo => photo.photoUrl)
  uni.previewImage({
    current: index,
    urls: urls
  })
}

// Â§ÑÁêÜÁÖßÁâáÂä†ËΩΩÈîôËØØ
function handlePhotoError(index) {
  photoErrors[index] = true
}

// Â§ÑÁêÜÂ§¥ÂÉèÂä†ËΩΩÈîôËØØ
function handleImageError() {
  userInfo.value.avatarUrl = '/static/common/default-avatar.png'
}

// Ê†ºÂºèÂåñÊó∂Èó¥
function formatTime(timestamp) {
  const date = new Date(timestamp)
  const now = new Date()
  const diff = now - date

  if (diff < 60000) return 'ÂàöÂàö'
  if (diff < 3600000) return Math.floor(diff / 60000) + 'ÂàÜÈíüÂâç'
  if (diff < 86400000) return Math.floor(diff / 3600000) + 'Â∞èÊó∂Ââç'
  return Math.floor(diff / 86400000) + 'Â§©Ââç'
}

// Ëé∑ÂèñÂ™í‰ΩìÁΩëÊ†ºÊ†∑ÂºèÁ±ª
function getMediaGridClass(count) {
  if (count === 1) return 'single'
  if (count <= 4) return 'quad'
  return 'nine'
}

// È¢ÑËßàÂä®ÊÄÅÂ™í‰Ωì
function previewMomentMedia(mediaList, index) {
  const urls = mediaList.map(media => media.mediaUrl)
  uni.previewImage({
    current: index,
    urls: urls
  })
}

// ÂàáÊç¢Âä®ÊÄÅÁÇπËµû
async function toggleMomentLike(moment) {
  try {
    // ËøôÈáåÂ∫îËØ•Ë∞ÉÁî®Âä®ÊÄÅÁÇπËµûAPI
    moment.isLiked = !moment.isLiked
    moment.likeCount = moment.isLiked ? (moment.likeCount || 0) + 1 : Math.max((moment.likeCount || 0) - 1, 0)
  } catch (error) {
    console.error('Âä®ÊÄÅÁÇπËµûÂ§±Ë¥•:', error)
  }
}

// Êü•ÁúãÂä®ÊÄÅËØÑËÆ∫
function viewMomentComments() {
  uni.showToast({ title: 'ËØÑËÆ∫ÂäüËÉΩÂºÄÂèë‰∏≠', icon: 'none' })
}

// ÂèëÈÄÅÊ∂àÊÅØ
async function sendMessage() {
  if (!userInfo.value.userId) {
    uni.showToast({
      title: 'Áî®Êà∑‰ø°ÊÅØÈîôËØØ',
      icon: 'none'
    })
    return
  }

  try {
    // ÂØºÂÖ•ËÅäÂ§©API
    const chatApi = await import('@/api/chat.js')

    // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ËÅäÂ§©ÔºàÊòØÂê¶‰∫íÁõ∏ÂÖ≥Ê≥®Ôºâ
    const result = await chatApi.canChat(userInfo.value.userId)

    if (result.code === 200) {
      if (result.data === true) {
        // ÂèØ‰ª•ËÅäÂ§©ÔºåË∑≥ËΩ¨Âà∞ËÅäÂ§©È°µÈù¢
        uni.navigateTo({
          url: `/pages/message/chat?userId=${userInfo.value.userId}&name=${encodeURIComponent(userInfo.value.nickname)}&avatar=${encodeURIComponent(userInfo.value.avatarUrl || '/static/message/default-avatar.png')}`
        })
      } else {
        // ‰∏çËÉΩËÅäÂ§©ÔºåÊèêÁ§∫ÈúÄË¶Å‰∫íÁõ∏ÂÖ≥Ê≥®
        uni.showModal({
          title: 'ÊèêÁ§∫',
          content: 'ÈúÄË¶Å‰∫íÁõ∏ÂÖ≥Ê≥®ÊâçËÉΩËÅäÂ§©Âì¶ÔΩû',
          showCancel: false,
          confirmText: 'Áü•ÈÅì‰∫Ü'
        })
      }
    } else {
      uni.showToast({
        title: result.message || 'Ê£ÄÊü•ËÅäÂ§©ÊùÉÈôêÂ§±Ë¥•',
        icon: 'none'
      })
    }
  } catch (error) {
    console.error('Ê£ÄÊü•ËÅäÂ§©ÊùÉÈôêÂ§±Ë¥•:', error)
    uni.showToast({
      title: 'ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï',
      icon: 'none'
    })
  }
}

// Áî≥ËØ∑‰ªãÁªçÔºàÁâµÁ∫øÁî≥ËØ∑Ôºâ
function requestIntroduction() {
  // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï
  const token = getToken()
  if (!token) {
    uni.showToast({ title: 'ËØ∑ÂÖàÁôªÂΩï', icon: 'none' })
    // ÂèØ‰ª•Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
    // uni.navigateTo({ url: '/pages/login/login' })
    return
  }

  // Ê£ÄÊü•ÊòØÂê¶ÊòØËá™Â∑±
  const targetUserId = pageParams.value.userId || pageParams.value.id
  const currentUserId = getCurrentUserId() // ÈúÄË¶ÅÂÆûÁé∞Ëé∑ÂèñÂΩìÂâçÁî®Êà∑IDÁöÑÊñπÊ≥ï

  if (targetUserId == currentUserId) {
    uni.showToast({ title: '‰∏çËÉΩÂêëËá™Â∑±ÂèëËµ∑ÁâµÁ∫øÁî≥ËØ∑', icon: 'none' })
    return
  }

  // Ë∑≥ËΩ¨Âà∞ÁâµÁ∫øÁî≥ËØ∑È°µÈù¢
  uni.navigateTo({
    url: `/pages/matchmaker/request?targetUserId=${targetUserId}`
  })
}

// Ëé∑ÂèñÂ≠¶ÂéÜÊñáÊú¨
function getEducationText(education) {
  const educationMap = {
    1: 'È´ò‰∏≠Âèä‰ª•‰∏ã',
    2: 'Â§ß‰∏ì',
    3: 'Êú¨Áßë',
    4: 'Á°ïÂ£´',
    5: 'ÂçöÂ£´'
  }
  return educationMap[education] || 'Êú™Áü•'
}

// Ëé∑ÂèñÊî∂ÂÖ•Ê∞¥Âπ≥ÊñáÊú¨
function getIncomeLevelText(level) {
  const levelMap = {
    1: '5K‰ª•‰∏ã',
    2: '5K-10K',
    3: '10K-20K',
    4: '20K-50K',
    5: '50K‰ª•‰∏ä'
  }
  return levelMap[level] || 'Êú™Áü•'
}

// Ëé∑ÂèñÂ©öÂßªÁä∂ÂÜµÊñáÊú¨
function getMaritalStatusText(status) {
  const statusMap = {
    1: 'Êú™Â©ö',
    2: 'Á¶ªÂºÇ',
    3: '‰∏ßÂÅ∂'
  }
  return statusMap[status] || 'Êú™Áü•'
}

// Ëé∑ÂèñÊàø‰∫ßÁä∂ÂÜµÊñáÊú¨
function getHouseStatusText(status) {
  const statusMap = {
    1: 'ÁßüÊàø',
    2: 'ÊúâÊàøË¥∑Ê¨æ',
    3: 'ÊúâÊàøÊó†Ë¥∑Ê¨æ',
    4: 'ÂíåÂÆ∂‰∫∫Âêå‰Ωè'
  }
  return statusMap[status] || 'Êú™Áü•'
}

// Ëé∑ÂèñËΩ¶‰∫ßÁä∂ÂÜµÊñáÊú¨
function getCarStatusText(status) {
  const statusMap = {
    1: 'Êó†ËΩ¶',
    2: 'ÊúâËΩ¶ÊúâË¥∑Ê¨æ',
    3: 'ÊúâËΩ¶Êó†Ë¥∑Ê¨æ'
  }
  return statusMap[status] || 'Êú™Áü•'
}

// Ëé∑ÂèñÁî®Êà∑token
function getToken() {
  try {
    // ‰ªéÊú¨Âú∞Â≠òÂÇ®Ëé∑Âèñtoken
    const token = uni.getStorageSync('token')
    if (token) {
      return token
    }

    // Â¶ÇÊûúÊ≤°ÊúâtokenÔºåËØ¥ÊòéÁî®Êà∑Êú™ÁôªÂΩï
    console.log('Êú™ÊâæÂà∞Áî®Êà∑tokenÔºåÁî®Êà∑ÂèØËÉΩÊú™ÁôªÂΩï')
    return null
  } catch (error) {
    console.error('Ëé∑ÂèñtokenÂ§±Ë¥•:', error)
    return null
  }
}

// Ëé∑ÂèñÂΩìÂâçÁî®Êà∑ID
function getCurrentUserId() {
  try {
    const token = getToken()
    if (!token) {
      return null
    }

    // Â¶ÇÊûúÊòØJWT tokenÔºåÂ∞ùËØïËß£Êûê
    const parts = token.split('.')
    if (parts.length === 3) {
      const payload = JSON.parse(atob(parts[1]))
      return payload.userId
    }

    // Â¶ÇÊûú‰∏çÊòØJWTÊ†ºÂºèÔºåÂ∞ùËØï‰ªéÊú¨Âú∞Â≠òÂÇ®Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
    const userInfo = uni.getStorageSync('userInfo')
    if (userInfo && userInfo.userId) {
      return userInfo.userId
    }

    return null
  } catch (error) {
    console.error('Ëé∑ÂèñÂΩìÂâçÁî®Êà∑IDÂ§±Ë¥•:', error)
    return null
  }
}
</script>

<style lang="scss" scoped>
.user-detail-page {
  width: 100vw;
  min-height: 100vh;
  background: linear-gradient(45deg, #12C2E9, #C471ED, #F64F59);
  background-size: 300% 300%;
  animation: gradientAnimation 15s ease infinite;
  position: relative;
  overflow-x: hidden;

  @keyframes gradientAnimation {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }
}

.main-wrapper {
  width: 100vw;
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
  z-index: 2;
}

.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background: linear-gradient(135deg,
    rgba(99, 102, 241, 0.05) 0%,
    rgba(139, 92, 246, 0.03) 25%,
    rgba(236, 72, 153, 0.02) 50%,
    rgba(59, 130, 246, 0.03) 75%,
    rgba(16, 185, 129, 0.05) 100%
  );
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 400rpx;
    height: 400rpx;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    animation: pulse 2s ease-in-out infinite;
  }

  .loading-spinner {
    width: 80rpx;
    height: 80rpx;
    border: 6rpx solid rgba(255, 255, 255, 0.3);
    border-top: 6rpx solid #6366f1;
    border-right: 6rpx solid #ec4899;
    border-radius: 50%;
    animation: spin 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
    margin-bottom: 32rpx;
    position: relative;
    z-index: 1;
    box-shadow: 0 8rpx 32rpx rgba(99, 102, 241, 0.2);

    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 40rpx;
      height: 40rpx;
      background: linear-gradient(135deg, #6366f1, #ec4899);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: innerSpin 0.8s linear infinite reverse;
    }
  }

  .loading-text {
    font-size: 32rpx;
    color: #64748b;
    font-weight: 600;
    position: relative;
    z-index: 1;
    text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);
    animation: fadeInOut 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.3;
    }
    50% {
      transform: translate(-50%, -50%) scale(1.1);
      opacity: 0.1;
    }
  }

  @keyframes innerSpin {
    0% {
      transform: translate(-50%, -50%) rotate(0deg);
    }
    100% {
      transform: translate(-50%, -50%) rotate(360deg);
    }
  }

  @keyframes fadeInOut {
    0%, 100% {
      opacity: 0.6;
    }
    50% {
      opacity: 1;
    }
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// ËÉåÊôØÊ∏êÂèòÊ†∑Âºè - ‰∏éÈ¶ñÈ°µÂÆåÂÖ®‰∏ÄËá¥



.custom-navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px);
  z-index: 1000;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.2);

  .navbar-content {
    height: 96rpx;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 32rpx;
    width: 100%;
    box-sizing: border-box;

    .nav-left, .nav-right {
      width: 68rpx;
      height: 68rpx;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 34rpx;
      background: rgba(255, 255, 255, 0.15);
      border: 1rpx solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;

      &:active {
        transform: scale(0.95);
        background: rgba(255, 255, 255, 0.25);
      }

      .nav-icon {
        font-size: 36rpx;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 600;
      }
    }

    .nav-center {
      flex: 1;
      text-align: center;
      padding: 0 20rpx;

      .nav-title {
        font-size: 34rpx;
        font-weight: 700;
        color: white;
        letter-spacing: 0.8rpx;
        max-width: 400rpx;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
    }
  }
}

.scroll-container {
  width: 100vw;
  height: 100vh;
  background: transparent;
  box-sizing: border-box;
  position: relative;
  z-index: 2;
}

// Áî®Êà∑ËµÑÊñôÂå∫Âüü
.user-profile {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40rpx 40rpx 30rpx;
  text-align: center;





  .avatar-container {
    position: relative;
    margin-bottom: 20rpx;

    .user-avatar {
      width: 180rpx;
      height: 180rpx;
      border-radius: 90rpx;
      border: 4rpx solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 6rpx 24rpx rgba(0, 0, 0, 0.3);
    }

    .online-indicator {
      position: absolute;
      bottom: 20rpx;
      right: 20rpx;
      width: 32rpx;
      height: 32rpx;
      background: #00ff7f;
      border-radius: 50%;
      border: 4rpx solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 2rpx 8rpx rgba(0, 255, 127, 0.4);
    }

    .badges {
      position: absolute;
      top: -10rpx;
      right: -10rpx;
      display: flex;
      flex-direction: column;
      gap: 8rpx;

      .vip-badge, .verified-badge, .matchmaker-badge {
        padding: 6rpx 12rpx;
        border-radius: 12rpx;
        font-size: 20rpx;
        font-weight: 700;
        color: white;
        text-align: center;
        box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.3);
      }

      .vip-badge {
        background: linear-gradient(135deg, #FFD700, #FFA500);
      }

      .matchmaker-badge {
        background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      }

      .verified-badge {
        background: linear-gradient(135deg, #10b981, #059669);
      }
    }
  }

  // Áî®Êà∑ÂêçÂå∫Âüü
  .username-section {
    margin-bottom: 16rpx;

    .user-name {
      font-size: 44rpx;
      font-weight: 700;
      color: white;
      line-height: 1.2;
      text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.3);
    }
  }



  // ÊÄßÂà´ÂíåÂπ¥ÈæÑÂå∫Âüü
  .gender-age-section {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16rpx;
    padding: 8rpx 16rpx;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20rpx;
    border: 1rpx solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    max-width: 200rpx;
    margin-left: auto;
    margin-right: auto;

    .gender-age-text {
      font-size: 26rpx;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 500;
      text-align: center;
      line-height: 1.2;
    }
  }

  // ÁªüËÆ°Êï∞ÊçÆË°å
  .stats-row {
    display: flex;
    justify-content: center;
    gap: 60rpx;
    margin-bottom: 20rpx;

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8rpx;

      .stat-count {
        font-size: 32rpx;
        font-weight: 700;
        color: white;
        line-height: 1.2;
        text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.3);
      }

      .stat-label {
        font-size: 24rpx;
        color: rgba(255, 255, 255, 0.8);
        font-weight: 500;
      }
    }
  }

  // ‰∏™‰∫∫ÁÆÄ‰ªã
  .bio-section {
    margin-bottom: 24rpx;
    max-width: 500rpx;

    .bio-text {
      font-size: 28rpx;
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
      text-align: center;
      font-weight: 400;
      letter-spacing: 0.5rpx;
      text-shadow: 0 1rpx 4rpx rgba(0, 0, 0, 0.3);
    }
  }

  // ÂÖ≥Ê≥®ÊåâÈíÆÂÆπÂô®
  .follow-button-container {
    width: 100%;
    max-width: 400rpx;

    .follow-button {
      width: 100%;
      height: 80rpx;
      border-radius: 40rpx;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.9);
      border: 2rpx solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
      box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.2);

      &:active {
        transform: scale(0.95);
      }

      &.followed {
        background: rgba(16, 185, 129, 0.8);
        border-color: rgba(16, 185, 129, 0.6);
      }

      .follow-text {
        font-size: 32rpx;
        color: #333;
        font-weight: 600;
      }

      &.followed .follow-text {
        color: white;
      }
    }
  }
}

// Ê†áÁ≠æÂå∫ÂüüÊ†∑Âºè

.tags-section {
  padding: 16rpx 32rpx 24rpx;
  display: flex;
  flex-wrap: wrap;
  gap: 16rpx;
  justify-content: center;
  align-items: center;

  .tag-item {
    padding: 10rpx 20rpx;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 20rpx;
    border: 1rpx solid rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;

    &:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2rpx);
    }

    .tag-text {
      font-size: 26rpx;
      color: rgba(255, 255, 255, 0.95);
      font-weight: 500;
      text-shadow: 0 1rpx 3rpx rgba(0, 0, 0, 0.2);
      line-height: 1.2;
    }
  }
}

.tab-bar {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px);
  display: flex;
  border-radius: 20rpx 20rpx 0 0;
  margin: 16rpx 0 0 0;
  width: 100%;
  box-sizing: border-box;
  border: 1rpx solid rgba(255, 255, 255, 0.2);

  .tab-item {
    flex: 1;
    height: 72rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: all 0.3s ease;

    &.active {
      .tab-text {
        color: white;
        font-weight: 700;
      }

      &::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 60rpx;
        height: 4rpx;
        background: rgba(196, 113, 237, 0.8);
        border-radius: 2rpx;
      }
    }

    .tab-text {
      font-size: 30rpx;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 600;
      transition: all 0.3s ease;
    }
  }
}

.content-container {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  min-height: 400rpx;
  padding: 20rpx;
  width: 100%;
  box-sizing: border-box;
  margin: 0;
  border: 1rpx solid rgba(255, 255, 255, 0.1);


}

.photos-content {
  .photo-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24rpx;

    .photo-item {
      aspect-ratio: 1;
      border-radius: 16rpx;
      overflow: hidden;
      transition: all 0.3s ease;
      position: relative;
      border: 1rpx solid rgba(255, 255, 255, 0.3);

      &:active {
        transform: scale(0.98);
      }

      .photo-image {
        width: 100%;
        height: 100%;
      }
    }
  }
}

.moments-content {
  .moment-list {
    .moment-item {
      padding: 24rpx 0;
      border-bottom: 1rpx solid rgba(255, 255, 255, 0.1);

      &:last-child {
        border-bottom: none;
      }

      .moment-header {
        margin-bottom: 16rpx;

        .moment-info {
          display: flex;
          align-items: center;
          gap: 16rpx;

          .moment-time {
            font-size: 24rpx;
            color: rgba(255, 255, 255, 0.9);
          }

          .moment-location {
            font-size: 24rpx;
            color: rgba(255, 255, 255, 0.8);
          }
        }
      }

      .moment-content {
        margin-bottom: 16rpx;

        .moment-text {
          font-size: 28rpx;
          color: rgba(255, 255, 255, 0.95);
          line-height: 1.6;
        }
      }

      .moment-media {
        margin-bottom: 16rpx;

        .media-grid {
          display: grid;
          gap: 8rpx;

          &.single {
            grid-template-columns: 1fr;
            max-width: 400rpx;
          }

          &.quad {
            grid-template-columns: repeat(2, 1fr);
          }

          &.nine {
            grid-template-columns: repeat(3, 1fr);
          }

          .media-item {
            aspect-ratio: 1;
            border-radius: 8rpx;
            overflow: hidden;

            .media-image {
              width: 100%;
              height: 100%;
            }
          }
        }
      }

      .moment-actions {
        display: flex;
        gap: 32rpx;

        .action-item {
          display: flex;
          align-items: center;
          gap: 8rpx;

          .action-icon {
            font-size: 28rpx;

            &.liked {
              color: #ff69b4;
            }
          }

          .action-count {
            font-size: 24rpx;
            color: rgba(255, 255, 255, 0.8);
          }
        }
      }
    }
  }
}

.info-content {
  .info-section {
    margin-bottom: 48rpx;

    .section-title {
      font-size: 36rpx;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.95);
      margin-bottom: 24rpx;
      position: relative;
      padding-left: 20rpx;

      &::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4rpx;
        height: 24rpx;
        background: rgba(196, 113, 237, 0.8);
        border-radius: 2rpx;
      }
    }

    .intro-text {
      font-size: 30rpx;
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
      padding: 24rpx;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16rpx;
      border: 1rpx solid rgba(255, 255, 255, 0.2);
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 32rpx;

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 12rpx;
        padding: 20rpx;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 16rpx;
        border: 1rpx solid rgba(255, 255, 255, 0.2);

        .info-label {
          font-size: 26rpx;
          color: rgba(255, 255, 255, 0.7);
          font-weight: 500;
        }

        .info-value {
          font-size: 30rpx;
          color: rgba(255, 255, 255, 0.9);
          font-weight: 600;
        }
      }
    }

    .cert-item {
      display: flex;
      align-items: center;
      gap: 16rpx;
      padding: 20rpx;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 16rpx;
      border: 1rpx solid rgba(255, 255, 255, 0.15);

      .cert-icon {
        font-size: 36rpx;
        color: rgba(255, 255, 255, 0.8);
      }

      .cert-text {
        flex: 1;
        font-size: 30rpx;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 500;
      }

      .cert-status {
        font-size: 26rpx;
        font-weight: 600;

        &.verified {
          color: #10b981;
        }
      }
    }
  }
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 120rpx 48rpx;

  .empty-icon {
    font-size: 120rpx;
    margin-bottom: 32rpx;
    opacity: 0.6;
  }

  .empty-text {
    font-size: 32rpx;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
    text-align: center;
    line-height: 1.5;
  }
}

.bottom-placeholder {
  height: 80rpx;
}

.bottom-actions {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100vw;
  padding: 16rpx 24rpx;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px);
  border-top: 1rpx solid rgba(255, 255, 255, 0.2);
  display: flex;
  gap: 16rpx;
  box-sizing: border-box;
  z-index: 999;

  .action-btn {
    height: 80rpx;
    border-radius: 40rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12rpx;
    transition: all 0.3s ease;

    &:active {
      transform: scale(0.98);
    }

    &.secondary {
      flex: 1;
      background: rgba(255, 255, 255, 0.15);
      border: 1rpx solid rgba(255, 255, 255, 0.2);

      .btn-icon, .btn-text {
        color: rgba(255, 255, 255, 0.9);
      }
    }

    &.primary {
      flex: 2;
      background: rgba(196, 113, 237, 0.8);
      border: 1rpx solid rgba(196, 113, 237, 0.4);

      .btn-icon, .btn-text {
        color: white;
      }
    }

    .btn-icon {
      font-size: 32rpx;
    }

    .btn-text {
      font-size: 28rpx;
      font-weight: 600;
    }
  }
}


</style>