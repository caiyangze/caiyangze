# ç”¨æˆ·ç•Œé¢å’Œæ¨èåŠŸèƒ½ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ¯ è§£å†³çš„é—®é¢˜

### 1. è¾“å…¥æ¡†ç‚¹å‡»ä¸äº†
**é—®é¢˜**ï¼šé¼ æ ‡ç‚¹å‡»è¾“å…¥æ¡†æ²¡æœ‰ååº”ï¼Œæ— æ³•è¾“å…¥å†…å®¹

### 2. ç”¨æˆ·å¤´åƒå’Œç”¨æˆ·åä¸æ˜¾ç¤º
**é—®é¢˜**ï¼šé¡µé¢ä¸Šçœ‹ä¸åˆ°å½“å‰ç”¨æˆ·çš„å¤´åƒå’Œç”¨æˆ·åä¿¡æ¯

### 3. æ ¹æ®ç”¨æˆ·è§’è‰²æ¨èä¸åŒå†…å®¹
**é—®é¢˜**ï¼šéœ€è¦æ ¹æ®ç”¨æˆ·è§’è‰²ï¼ˆæ™®é€šç”¨æˆ·/çº¢å¨˜ï¼‰æ¨èä¸åŒçš„å†…å®¹

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. è¾“å…¥æ¡†ç‚¹å‡»é—®é¢˜ä¿®å¤

#### å‰ç«¯ä¿®å¤
```vue
<!-- æ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç† -->
<input
    class="message-input"
    v-model="inputMessage"
    @tap="onInputTap"
    @focus="onInputFocus"
    @blur="onInputBlur"
    @confirm="sendMessage"
/>
```

```javascript
// è¾“å…¥æ¡†ç‚¹å‡»äº‹ä»¶
function onInputTap() {
    console.log('è¾“å…¥æ¡†è¢«ç‚¹å‡»');
    // ç¡®ä¿åŠŸèƒ½æŒ‰é’®æ”¶èµ·ï¼Œè®©è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹
    showFunctions.value = false;
}

// è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹
function onInputFocus() {
    console.log('è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹');
    // æ”¶èµ·åŠŸèƒ½æŒ‰é’®ï¼Œä¸“æ³¨è¾“å…¥
    showFunctions.value = false;
}
```

### 2. ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºä¿®å¤

#### ç”¨æˆ·ä¿¡æ¯ç»“æ„ä¼˜åŒ–
```javascript
// ç”¨æˆ·ä¿¡æ¯
const userInfo = ref({
    userId: null,
    nickname: null,        // æ·»åŠ æ˜µç§°
    gender: null,
    age: null,
    location: null,
    avatar: '/static/default-avatar.png',
    userRole: null         // æ·»åŠ ç”¨æˆ·è§’è‰²ï¼š1-æ™®é€šç”¨æˆ·ï¼Œ2-çº¢å¨˜
});
```

#### ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ–ä¼˜åŒ–
```javascript
function initUserInfo() {
    try {
        const userInfoStr = uni.getStorageSync('userInfo');
        if (userInfoStr) {
            const userData = JSON.parse(userInfoStr);
            userInfo.value = {
                userId: userData.userId || Date.now(),
                nickname: userData.nickname || userData.name || 'ç”¨æˆ·' + (userData.userId || Date.now()).toString().slice(-4),
                gender: userData.gender,
                age: userData.age,
                location: userData.location || userData.city,
                avatar: userData.avatarUrl || userData.avatar || '/static/default-avatar.png',
                userRole: userData.userRole || 1  // é»˜è®¤ä¸ºæ™®é€šç”¨æˆ·
            };
        } else {
            // åˆ›å»ºé»˜è®¤ç”¨æˆ·ä¿¡æ¯
            const defaultUserId = Date.now();
            userInfo.value = {
                userId: defaultUserId,
                nickname: 'ç”¨æˆ·' + defaultUserId.toString().slice(-4),
                gender: 1,
                age: 25,
                location: 'åŒ—äº¬',
                avatar: '/static/default-avatar.png',
                userRole: 1
            };
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            uni.setStorageSync('userInfo', JSON.stringify(userInfo.value));
        }
    } catch (error) {
        // å…œåº•å¤„ç†
        console.error('åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
    }
}
```

#### é¡µé¢å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
```vue
<view class="nav-right">
    <view class="user-info-mini" @tap="showUserInfo">
        <image class="user-mini-avatar" :src="userAvatar" mode="aspectFill"></image>
        <text class="user-mini-name">{{ userInfo.nickname || 'ç”¨æˆ·' }}</text>
    </view>
</view>
```

```javascript
// æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
function showUserInfo() {
    uni.showModal({
        title: 'å½“å‰ç”¨æˆ·ä¿¡æ¯',
        content: `æ˜µç§°ï¼š${userInfo.value.nickname}\næ€§åˆ«ï¼š${userInfo.value.gender === 0 ? 'å¥³' : 'ç”·'}\nå¹´é¾„ï¼š${userInfo.value.age}\nåœ°åŒºï¼š${userInfo.value.location}\nè§’è‰²ï¼š${userInfo.value.userRole === 2 ? 'çº¢å¨˜' : 'æ™®é€šç”¨æˆ·'}`,
        showCancel: false,
        confirmText: 'ç¡®å®š'
    });
}
```

### 3. æ ¹æ®ç”¨æˆ·è§’è‰²æ¨èä¸åŒå†…å®¹

#### åç«¯æ•°æ®ç»“æ„ä¼˜åŒ–
```java
// ChatForm.java æ·»åŠ ç”¨æˆ·è§’è‰²å­—æ®µ
private Integer userRole;//ç”¨æˆ·è§’è‰²ï¼š1-æ™®é€šç”¨æˆ·ï¼Œ2-çº¢å¨˜
```

#### å·¥å…·æ¥å£ä¼˜åŒ–
```java
@Tool(name = "æ¨èç”¨æˆ·", value = "æ ¹æ®ç”¨æˆ·è§’è‰²å’ŒåŸºæœ¬ä¿¡æ¯ï¼Œæ™ºèƒ½æ¨èåˆé€‚çš„ç”¨æˆ·ï¼šæ™®é€šç”¨æˆ·æ¨èå¼‚æ€§ï¼Œçº¢å¨˜æ¨èæ‰€æœ‰ç”¨æˆ·")
public String recommendUsers(
    @ToolMemoryId Long memoryId,
    @P(value = "ç”¨æˆ·ID", required = true) Long userId,
    @P(value = "ç”¨æˆ·æ€§åˆ«ï¼š0-å¥³ï¼Œ1-ç”·", required = true) Integer userGender,
    @P(value = "ç”¨æˆ·è§’è‰²ï¼š1-æ™®é€šç”¨æˆ·ï¼Œ2-çº¢å¨˜", required = false) Integer userRole,
    @P(value = "ç”¨æˆ·å¹´é¾„", required = false) Integer userAge,
    @P(value = "ç”¨æˆ·æ‰€åœ¨åœ°åŒº", required = false) String userLocation,
    @P(value = "æ¨èæ•°é‡ï¼Œé»˜è®¤5ä¸ª", required = false) Integer limit) {
```

#### æ¨èé€»è¾‘ä¼˜åŒ–
```java
// æ ¹æ®ç”¨æˆ·è§’è‰²ç¡®å®šæ¨èç­–ç•¥
Integer targetGender = null;
if (userRole != null && userRole == 2) {
    // çº¢å¨˜ç”¨æˆ·ï¼šæ¨èæ‰€æœ‰ç”¨æˆ·ï¼ˆä¸é™æ€§åˆ«ï¼‰
    targetGender = null;
    System.out.println("çº¢å¨˜ç”¨æˆ·ï¼Œæ¨èæ‰€æœ‰ç”¨æˆ·");
} else {
    // æ™®é€šç”¨æˆ·ï¼šæ¨èå¼‚æ€§ç”¨æˆ·
    targetGender = (userGender == 0) ? 1 : 0;
    System.out.println("æ™®é€šç”¨æˆ·ï¼Œæ¨èå¼‚æ€§ç”¨æˆ·ï¼Œç›®æ ‡æ€§åˆ«: " + targetGender);
}

// ä½¿ç”¨Serviceå±‚çš„æ–¹æ³•æŸ¥è¯¢å€™é€‰ç”¨æˆ·
List<TbUser> candidateUsers = tbUserService.findRecommendedUsers(userId, targetGender, userLocation, limit);
```

#### æ¨èç»“æœå±•ç¤ºä¼˜åŒ–
```java
// æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤ºä¸åŒçš„æ¨èæ ‡é¢˜
if (userRole != null && userRole == 2) {
    response.append("ğŸŒ¹ ä¸ºæ‚¨æ¨èäº† ").append(result.getUserRecommendations().size()).append(" ä½å¹³å°ç”¨æˆ·ï¼ˆçº¢å¨˜ä¸“ç”¨ï¼‰ï¼š\n\n");
} else {
    response.append("ğŸ’• ä¸ºæ‚¨æ¨èäº† ").append(result.getUserRecommendations().size()).append(" ä½ä¼˜è´¨å¼‚æ€§ç”¨æˆ·ï¼š\n\n");
}
```

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. å‰ç«¯æ•°æ®æµ
```
ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ– â†’ æœ¬åœ°å­˜å‚¨è¯»å– â†’ é»˜è®¤å€¼è®¾ç½® â†’ é¡µé¢æ˜¾ç¤º â†’ å‘é€è¯·æ±‚æ—¶æºå¸¦
```

### 2. åç«¯æ•°æ®æµ
```
æ¥æ”¶ChatForm â†’ æå–ç”¨æˆ·è§’è‰² â†’ ä¼ é€’ç»™å·¥å…·æ–¹æ³• â†’ æ ¹æ®è§’è‰²è°ƒæ•´æ¨èç­–ç•¥ â†’ è¿”å›ç»“æœ
```

### 3. æ¨èç­–ç•¥
- **æ™®é€šç”¨æˆ·**ï¼šæ¨èå¼‚æ€§ç”¨æˆ·ï¼Œç”¨äºäº¤å‹é…å¯¹
- **çº¢å¨˜ç”¨æˆ·**ï¼šæ¨èæ‰€æœ‰ç”¨æˆ·ï¼Œç”¨äºçº¢å¨˜ä¸šåŠ¡ç®¡ç†

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| ç”¨æˆ·è§’è‰² | æ¨èå†…å®¹ | æ¨èæ ‡é¢˜ | ä¸šåŠ¡åœºæ™¯ |
|---------|---------|---------|---------|
| æ™®é€šç”¨æˆ·(1) | å¼‚æ€§ç”¨æˆ· | "ä¼˜è´¨å¼‚æ€§ç”¨æˆ·" | äº¤å‹é…å¯¹ |
| çº¢å¨˜(2) | æ‰€æœ‰ç”¨æˆ· | "å¹³å°ç”¨æˆ·ï¼ˆçº¢å¨˜ä¸“ç”¨ï¼‰" | ä¸šåŠ¡ç®¡ç† |

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. è¾“å…¥æ¡†æµ‹è¯•
- âœ… ç‚¹å‡»è¾“å…¥æ¡†èƒ½æ­£å¸¸è·å¾—ç„¦ç‚¹
- âœ… èƒ½æ­£å¸¸è¾“å…¥æ–‡å­—
- âœ… å›è½¦å‘é€æ¶ˆæ¯æ­£å¸¸

### 2. ç”¨æˆ·ä¿¡æ¯æµ‹è¯•
- âœ… é¡µé¢å³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œæ˜µç§°
- âœ… ç‚¹å‡»ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯å¼¹çª—
- âœ… ç”¨æˆ·ä¿¡æ¯æ­£ç¡®ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨

### 3. æ¨èåŠŸèƒ½æµ‹è¯•
- âœ… æ™®é€šç”¨æˆ·ç‚¹å‡»"æ¨èç”¨æˆ·"è¿”å›å¼‚æ€§ç”¨æˆ·
- âœ… çº¢å¨˜ç”¨æˆ·ç‚¹å‡»"æ¨èç”¨æˆ·"è¿”å›æ‰€æœ‰ç”¨æˆ·
- âœ… æ¨èæ ‡é¢˜æ ¹æ®ç”¨æˆ·è§’è‰²æ­£ç¡®æ˜¾ç¤º

## ğŸ’¡ ç”¨æˆ·ä½“éªŒæå‡

1. **è¾“å…¥ä½“éªŒ**ï¼šè§£å†³äº†è¾“å…¥æ¡†ç‚¹å‡»é—®é¢˜ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸è¾“å…¥
2. **èº«ä»½è¯†åˆ«**ï¼šç”¨æˆ·å¯ä»¥æ¸…æ¥šçœ‹åˆ°è‡ªå·±çš„èº«ä»½ä¿¡æ¯
3. **ä¸ªæ€§åŒ–æ¨è**ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²æä¾›ä¸åŒçš„æ¨èå†…å®¹
4. **ç•Œé¢å‹å¥½**ï¼šç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºç¾è§‚ï¼Œäº¤äº’æµç•…

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **ç”¨æˆ·è§’è‰²åˆ‡æ¢**ï¼šæ”¯æŒç”¨æˆ·åœ¨æ™®é€šç”¨æˆ·å’Œçº¢å¨˜ä¹‹é—´åˆ‡æ¢
2. **æ¨èç®—æ³•ä¼˜åŒ–**ï¼šæ ¹æ®ç”¨æˆ·è¡Œä¸ºå’Œåå¥½è¿›ä¸€æ­¥ä¼˜åŒ–æ¨è
3. **ç•Œé¢ä¸ªæ€§åŒ–**ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤ºä¸åŒçš„ç•Œé¢ä¸»é¢˜
4. **åŠŸèƒ½æƒé™**ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²å¼€æ”¾ä¸åŒçš„åŠŸèƒ½æƒé™

ç°åœ¨æ‰€æœ‰é—®é¢˜éƒ½å·²ä¿®å¤ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨è¾“å…¥æ¡†ï¼Œçœ‹åˆ°è‡ªå·±çš„å¤´åƒå’Œç”¨æˆ·åï¼Œå¹¶æ ¹æ®è§’è‰²è·å¾—ä¸ªæ€§åŒ–çš„æ¨èå†…å®¹ï¼
