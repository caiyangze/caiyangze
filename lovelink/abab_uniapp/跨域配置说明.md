# è·¨åŸŸé…ç½®è¯´æ˜

## ğŸ¯ ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜ï¼Ÿ

å½“å‰ç«¯å’Œåç«¯è¿è¡Œåœ¨ä¸åŒçš„ç«¯å£æ—¶ï¼Œæµè§ˆå™¨ä¼šé˜»æ­¢å‰ç«¯è®¿é—®åç«¯APIï¼Œè¿™å°±æ˜¯è·¨åŸŸé—®é¢˜ã€‚

### å½“å‰æƒ…å†µï¼š
- **åç«¯æœåŠ¡**ï¼šè¿è¡Œåœ¨ `http://localhost:8084`
- **å‰ç«¯åº”ç”¨**ï¼šè¿è¡Œåœ¨ `http://localhost:5173` ï¼ˆæˆ–å…¶ä»–ç«¯å£ï¼‰
- **é—®é¢˜**ï¼šå‰ç«¯æ— æ³•ç›´æ¥è®¿é—®åç«¯API

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. åç«¯è·¨åŸŸé…ç½® (å·²ä¿®å¤)

åœ¨ `langchain4j-ai/src/main/java/com/zhentao/config/CorsConfig.java` ä¸­ï¼š

```java
@Configuration
public class CorsConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                // å…è®¸è¿™äº›å‰ç«¯åœ°å€è®¿é—®åç«¯
                .allowedOrigins(
                    "http://localhost:5173",    // ä½ çš„å‰ç«¯åœ°å€
                    "http://127.0.0.1:5173",
                    "http://localhost:8080",    // å…¶ä»–å¯èƒ½çš„å‰ç«¯ç«¯å£
                    "http://127.0.0.1:8080"
                )
                // å…è®¸çš„HTTPæ–¹æ³•
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                // å…è®¸çš„è¯·æ±‚å¤´
                .allowedHeaders("*")
                // ä¸ä½¿ç”¨å‡­è¯ï¼ˆé¿å…å¤æ‚çš„è·¨åŸŸé—®é¢˜ï¼‰
                .allowCredentials(false);
    }
}
```

### 2. å‰ç«¯è¯·æ±‚é…ç½® (å·²ä¿®å¤)

åœ¨å‰ç«¯å‘é€è¯·æ±‚æ—¶ï¼š

```javascript
const response = await fetch('http://localhost:8084/xiaozhi/chat', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(data),
    credentials: 'omit'  // ä¸å‘é€å‡­è¯ï¼Œé¿å…è·¨åŸŸé—®é¢˜
});
```

## ğŸ“‹ ç«¯å£è¯´æ˜

### åç«¯ç«¯å£ï¼š8084
- è¿™æ˜¯ä½ çš„Spring Bootåº”ç”¨è¿è¡Œçš„ç«¯å£
- APIåœ°å€ï¼š`http://localhost:8084/xiaozhi/chat`

### å‰ç«¯ç«¯å£ï¼š5173 (æˆ–å…¶ä»–)
- è¿™æ˜¯ä½ çš„å‰ç«¯åº”ç”¨è¿è¡Œçš„ç«¯å£
- å¸¸è§çš„å‰ç«¯ç«¯å£ï¼š
  - `5173` - Vite é»˜è®¤ç«¯å£
  - `8080` - uni-app H5 å¸¸ç”¨ç«¯å£
  - `3000` - React/Next.js é»˜è®¤ç«¯å£

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. é‡å¯åç«¯æœåŠ¡
```bash
cd langchain4j-ai
mvn spring-boot:run
```

### 2. ç¡®è®¤åç«¯å¯åŠ¨æˆåŠŸ
çœ‹åˆ°è¿™æ ·çš„æ—¥å¿—è¡¨ç¤ºæˆåŠŸï¼š
```
âœ“ æœåŠ¡ç«¯å£: 8084
âœ“ è·¨åŸŸé…ç½®: å·²å¯ç”¨å…¨å±€CORSæ”¯æŒ
ğŸš€ AIçº¢å¨˜æœåŠ¡å·²å¯åŠ¨ï¼Œè®¿é—®åœ°å€: http://localhost:8084/xiaozhi/chat
```

### 3. æµ‹è¯•å‰ç«¯è¿æ¥
è®¿é—®ï¼š`/pages/test/simple-chat`
- ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
- å¦‚æœæ˜¾ç¤º"åç«¯è¿æ¥æ­£å¸¸"ï¼Œè¯´æ˜è·¨åŸŸé—®é¢˜å·²è§£å†³

### 4. æµ‹è¯•AIèŠå¤©
- è¾“å…¥æµ‹è¯•æ¶ˆæ¯
- ç‚¹å‡»"å‘é€"æˆ–"å¿«é€Ÿæµ‹è¯•"
- æŸ¥çœ‹æ˜¯å¦èƒ½æ”¶åˆ°AIå›å¤

## âŒ å¸¸è§é”™è¯¯

### é”™è¯¯1ï¼šCORS policy blocked
```
Access to fetch at 'http://localhost:8084/xiaozhi/chat' from origin 'http://localhost:5173' has been blocked by CORS policy
```
**è§£å†³**ï¼šç¡®è®¤åç«¯è·¨åŸŸé…ç½®åŒ…å«äº†ä½ çš„å‰ç«¯ç«¯å£

### é”™è¯¯2ï¼šallowCredentials é”™è¯¯
```
When allowCredentials is true, allowedOrigins cannot contain the special value "*"
```
**è§£å†³**ï¼šå·²ä¿®å¤ï¼Œè®¾ç½® `allowCredentials(false)`

### é”™è¯¯3ï¼š500 Internal Server Error
è¿™é€šå¸¸ä¸æ˜¯è·¨åŸŸé—®é¢˜ï¼Œè€Œæ˜¯åç«¯é€»è¾‘é”™è¯¯ï¼Œéœ€è¦æŸ¥çœ‹åç«¯æ—¥å¿—

## ğŸ” è°ƒè¯•æ–¹æ³•

### 1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
- æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
- æŸ¥çœ‹Consoleé¢æ¿çš„é”™è¯¯ä¿¡æ¯
- æŸ¥çœ‹Networké¢æ¿çš„è¯·æ±‚çŠ¶æ€

### 2. æ£€æŸ¥åç«¯æ—¥å¿—
- æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
- ç¡®è®¤æ²¡æœ‰è·¨åŸŸç›¸å…³çš„é”™è¯¯

### 3. æ‰‹åŠ¨æµ‹è¯•API
ä½¿ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼š
```
http://localhost:8084/xiaozhi/chat
```
å¦‚æœçœ‹åˆ°405é”™è¯¯ï¼ˆMethod Not Allowedï¼‰ï¼Œè¯´æ˜åç«¯æ­£å¸¸è¿è¡Œ

## ğŸ’¡ é‡è¦æç¤º

1. **æ¯æ¬¡ä¿®æ”¹è·¨åŸŸé…ç½®åï¼Œå¿…é¡»é‡å¯åç«¯æœåŠ¡**
2. **å‰ç«¯ç«¯å£å˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–°åç«¯çš„è·¨åŸŸé…ç½®**
3. **å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶è®¾ç½® `allowedOrigins("*")` å’Œ `allowCredentials(false)` è¿›è¡Œæµ‹è¯•**

## ğŸ†˜ ç´§æ€¥è§£å†³æ–¹æ¡ˆ

å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œå¯ä»¥ä¸´æ—¶ä½¿ç”¨è¿™ä¸ªé…ç½®ï¼š

```java
@Override
public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
            .allowedOrigins("*")
            .allowedMethods("*")
            .allowedHeaders("*")
            .allowCredentials(false);
}
```

è¿™ä¸ªé…ç½®å…è®¸æ‰€æœ‰æ¥æºè®¿é—®ï¼Œä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼
