# ç™»å½•çŠ¶æ€é—®é¢˜ä¿®å¤æŒ‡å—

## ğŸš¨ **é—®é¢˜ç°è±¡**
APIè¯·æ±‚è¿”å› `{code: 400, message: "ç”¨æˆ·æœªç™»å½•", data: null}`

## ğŸ” **é—®é¢˜æ’æŸ¥æ­¥éª¤**

### 1. æ£€æŸ¥TokençŠ¶æ€
åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š
```javascript
// å¯¼å…¥è°ƒè¯•å·¥å…·
import { checkTokenStatus, diagnoseLoginStatus } from '@/utils/token-debug';

// æ£€æŸ¥tokençŠ¶æ€
checkTokenStatus();

// å®Œæ•´è¯Šæ–­
diagnoseLoginStatus();
```

### 2. æ‰‹åŠ¨æ£€æŸ¥å­˜å‚¨
```javascript
// æ£€æŸ¥æœ¬åœ°å­˜å‚¨
console.log('Token:', uni.getStorageSync('token'));
console.log('RefreshToken:', uni.getStorageSync('refreshToken'));
console.log('UserInfo:', uni.getStorageSync('userInfo'));
```

### 3. æ£€æŸ¥è¯·æ±‚å¤´
åœ¨Networkæ ‡ç­¾ä¸­æŸ¥çœ‹è¯·æ±‚å¤´æ˜¯å¦åŒ…å«ï¼š
- `token: your_token_here`
- `Authorization: Bearer your_token_here`

## ğŸ› ï¸ **å¸¸è§è§£å†³æ–¹æ¡ˆ**

### æ–¹æ¡ˆ1: é‡æ–°ç™»å½•
```javascript
// æ¸…é™¤ç™»å½•ä¿¡æ¯
uni.removeStorageSync('token');
uni.removeStorageSync('refreshToken');
uni.removeStorageSync('userInfo');

// è·³è½¬åˆ°ç™»å½•é¡µ
uni.reLaunch({
  url: '/pages/login/login'
});
```

### æ–¹æ¡ˆ2: æ£€æŸ¥Tokenæ ¼å¼
```javascript
const token = uni.getStorageSync('token');
if (token) {
  console.log('Tokené•¿åº¦:', token.length);
  console.log('Tokenå‰20ä½:', token.substring(0, 20));
  
  // å¦‚æœæ˜¯JWTï¼Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸ
  try {
    const parts = token.split('.');
    if (parts.length === 3) {
      const payload = JSON.parse(atob(parts[1]));
      console.log('Tokenè¿‡æœŸæ—¶é—´:', new Date(payload.exp * 1000));
      console.log('æ˜¯å¦è¿‡æœŸ:', payload.exp * 1000 < Date.now());
    }
  } catch (e) {
    console.log('Tokenä¸æ˜¯JWTæ ¼å¼');
  }
}
```

### æ–¹æ¡ˆ3: æ‰‹åŠ¨è®¾ç½®Token
å¦‚æœç¡®å®šæœ‰æœ‰æ•ˆçš„tokenï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼š
```javascript
// è®¾ç½®tokenï¼ˆæ›¿æ¢ä¸ºå®é™…çš„tokenï¼‰
const validToken = 'your_actual_token_here';
uni.setStorageSync('token', validToken);

// é‡æ–°åŠ è½½é¡µé¢
location.reload();
```

### æ–¹æ¡ˆ4: æ£€æŸ¥åç«¯TokenéªŒè¯
ç¡®ä¿åç«¯æ¥å£èƒ½æ­£ç¡®è¯†åˆ«ä»¥ä¸‹è¯·æ±‚å¤´æ ¼å¼ï¼š
- `token: xxx`
- `Authorization: Bearer xxx`

## ğŸ”§ **å·²æ·»åŠ çš„ä¿®å¤æªæ–½**

### 1. åŒé‡Tokenå¤´è®¾ç½®
```javascript
// åœ¨http.jsä¸­åŒæ—¶è®¾ç½®ä¸¤ç§æ ¼å¼
if (token) {
  config.header['token'] = token;
  config.header['Authorization'] = `Bearer ${token}`;
}
```

### 2. è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
```javascript
// è¯·æ±‚å‰è®°å½•tokençŠ¶æ€
console.log('å½“å‰token:', token ? token.substring(0, 20) + '...' : 'null');
console.log('è¯·æ±‚URL:', config.url);
```

### 3. æ™ºèƒ½é”™è¯¯å¤„ç†
```javascript
// æ£€æµ‹åˆ°ç™»å½•é”™è¯¯æ—¶è‡ªåŠ¨è¯Šæ–­
if (error.code === 400 && error.message.includes('ç”¨æˆ·æœªç™»å½•')) {
  await diagnoseLoginStatus();
  // æç¤ºç”¨æˆ·é‡æ–°ç™»å½•
}
```

## ğŸ§ª **æµ‹è¯•æ­¥éª¤**

### 1. åŸºç¡€æµ‹è¯•
1. æ‰“å¼€å¼€å‘è€…å·¥å…·æ§åˆ¶å°
2. è¿›å…¥æ¶ˆæ¯é¡µé¢
3. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„tokenä¿¡æ¯
4. æ£€æŸ¥Networkæ ‡ç­¾ä¸­çš„è¯·æ±‚å¤´

### 2. APIæµ‹è¯•
```javascript
// ç›´æ¥æµ‹è¯•API
import { testApiRequest } from '@/utils/token-debug';
testApiRequest();
```

### 3. ç™»å½•æµç¨‹æµ‹è¯•
1. æ¸…é™¤æ‰€æœ‰å­˜å‚¨ï¼š`uni.clearStorageSync()`
2. é‡æ–°ç™»å½•
3. æ£€æŸ¥tokenæ˜¯å¦æ­£ç¡®ä¿å­˜
4. æµ‹è¯•APIè°ƒç”¨

## ğŸ¯ **é¢„æœŸç»“æœ**

ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š
- âœ… æ§åˆ¶å°æ˜¾ç¤ºæœ‰æ•ˆçš„tokenä¿¡æ¯
- âœ… è¯·æ±‚å¤´åŒ…å«æ­£ç¡®çš„token
- âœ… APIè¿”å›æ­£å¸¸æ•°æ®è€Œä¸æ˜¯"ç”¨æˆ·æœªç™»å½•"é”™è¯¯
- âœ… å¥½å‹åˆ—è¡¨æ­£å¸¸åŠ è½½

## ğŸš¨ **ç´§æ€¥ä¿®å¤æ–¹æ¡ˆ**

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥å°è¯•ï¼š

### 1. å¼ºåˆ¶é‡æ–°ç™»å½•
```javascript
// åœ¨ä»»ä½•é¡µé¢çš„æ§åˆ¶å°æ‰§è¡Œ
uni.removeStorageSync('token');
uni.removeStorageSync('refreshToken');
uni.removeStorageSync('userInfo');
uni.reLaunch({ url: '/pages/login/login' });
```

### 2. æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸
curl -H "token: your_token" http://localhost:9001/follow/mutual
```

### 3. ä¸´æ—¶ç»•è¿‡éªŒè¯ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
åœ¨åç«¯ä¸´æ—¶å…³é—­tokenéªŒè¯ï¼Œç¡®è®¤æ˜¯tokené—®é¢˜è¿˜æ˜¯å…¶ä»–é—®é¢˜ã€‚

## ğŸ“ **è”ç³»æ”¯æŒ**

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ•ˆï¼Œè¯·æä¾›ï¼š
1. æ§åˆ¶å°å®Œæ•´é”™è¯¯æ—¥å¿—
2. Networkæ ‡ç­¾ä¸­çš„è¯·æ±‚è¯¦æƒ…
3. å½“å‰tokenå€¼ï¼ˆè„±æ•åçš„å‰20ä½ï¼‰
4. ç™»å½•æ—¶é—´å’Œæ–¹å¼

---

**æ³¨æ„**ï¼šæ­¤é—®é¢˜é€šå¸¸æ˜¯tokenè¿‡æœŸã€æ ¼å¼é”™è¯¯æˆ–è¯·æ±‚å¤´è®¾ç½®é—®é¢˜å¯¼è‡´çš„ï¼ŒæŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ’æŸ¥é€šå¸¸èƒ½è§£å†³ã€‚
