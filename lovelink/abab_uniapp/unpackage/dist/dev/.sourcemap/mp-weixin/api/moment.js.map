{"version":3,"file":"moment.js","sources":["api/moment.js"],"sourcesContent":["import http from './http.js'\r\n\r\n// 动态服务基础URL\r\nconst SOCIAL_BASE_URL = 'http://localhost:9002';\r\n\r\nconst momentApi = {\r\n  /**\r\n   * 发布动态\r\n   * @param {Object} data - 动态数据\r\n   * @param {Array} mediaFiles - 媒体文件数组\r\n   */\r\n  createMoment(data, mediaFiles = []) {\r\n    const formData = new FormData();\r\n    formData.append('content', data.content);\r\n    if (data.location) formData.append('location', data.location);\r\n    if (data.visibility) formData.append('visibility', data.visibility);\r\n\r\n    // 添加媒体文件\r\n    mediaFiles.forEach((file, index) => {\r\n      formData.append('mediaFiles', file);\r\n    });\r\n\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/create`,\r\n      method: 'POST',\r\n      data: formData,\r\n      header: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 上传动态图片（使用MinIO）\r\n   * @param {String} filePath - 本地文件路径\r\n   */\r\n  uploadMomentImage(filePath) {\r\n    return new Promise((resolve, reject) => {\r\n      const token = uni.getStorageSync('token') || '';\r\n\r\n      uni.uploadFile({\r\n        url: SOCIAL_BASE_URL + '/api/social/file/upload/moment',\r\n        filePath: filePath,\r\n        name: 'file',\r\n        header: {\r\n          'token': token\r\n        },\r\n        success: (res) => {\r\n          try {\r\n            const data = JSON.parse(res.data);\r\n            resolve(data);\r\n          } catch (e) {\r\n            reject(e);\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 批量上传动态图片\r\n   * @param {Array} filePaths - 本地文件路径数组\r\n   */\r\n  uploadMomentImages: async function(filePaths) {\r\n    const uploadPromises = filePaths.map(filePath => this.uploadMomentImage(filePath));\r\n    return Promise.all(uploadPromises);\r\n  },\r\n\r\n  /**\r\n   * 查询公开动态列表\r\n   * @param {Number} pageNum - 页码\r\n   * @param {Number} pageSize - 页大小\r\n   */\r\n  getPublicMoments(pageNum = 1, pageSize = 10) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/public?pageNum=${pageNum}&pageSize=${pageSize}`,\r\n      method: 'GET'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 查询我的动态列表\r\n   * @param {Number} pageNum - 页码\r\n   * @param {Number} pageSize - 页大小\r\n   */\r\n  getMyMoments(pageNum = 1, pageSize = 10) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/mine?pageNum=${pageNum}&pageSize=${pageSize}`,\r\n      method: 'GET'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 查询动态详情\r\n   * @param {Number} momentId - 动态ID\r\n   */\r\n  getMomentDetail(momentId) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/detail/${momentId}`,\r\n      method: 'GET'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 更新动态\r\n   * @param {Object} data - 更新数据\r\n   */\r\n  updateMoment(data) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/update`,\r\n      method: 'PUT',\r\n      data: data\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 删除动态\r\n   * @param {Number} momentId - 动态ID\r\n   */\r\n  deleteMoment(momentId) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/delete/${momentId}`,\r\n      method: 'DELETE'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 更新动态可见性\r\n   * @param {Number} momentId - 动态ID\r\n   * @param {Number} visibility - 可见性\r\n   */\r\n  updateMomentVisibility(momentId, visibility) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/visibility/${momentId}?visibility=${visibility}`,\r\n      method: 'PUT'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 点赞/取消点赞动态\r\n   * @param {Number} momentId - 动态ID\r\n   */\r\n  likeMoment(momentId) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/like/${momentId}`,\r\n      method: 'POST'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 获取动态评论列表\r\n   * @param {Number} momentId - 动态ID\r\n   * @param {Number} pageNum - 页码\r\n   * @param {Number} pageSize - 页大小\r\n   */\r\n  getMomentComments(momentId, pageNum = 1, pageSize = 10) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/comments/${momentId}?pageNum=${pageNum}&pageSize=${pageSize}`,\r\n      method: 'GET'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 添加动态评论\r\n   * @param {Number} momentId - 动态ID\r\n   * @param {String} content - 评论内容\r\n   */\r\n  addMomentComment(momentId, content) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/comment`,\r\n      method: 'POST',\r\n      data: {\r\n        momentId,\r\n        content\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 增加动态浏览次数\r\n   * @param {Number} momentId - 动态ID\r\n   */\r\n  incrementViewCount(momentId) {\r\n    return http.request({\r\n      url: `${SOCIAL_BASE_URL}/api/social/moment/view/${momentId}`,\r\n      method: 'POST'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 获取评论列表（简化方法名）\r\n   * @param {Number} momentId - 动态ID\r\n   * @param {Number} pageNum - 页码\r\n   * @param {Number} pageSize - 页大小\r\n   */\r\n  getCommentList(momentId, pageNum = 1, pageSize = 20) {\r\n    return this.getMomentComments(momentId, pageNum, pageSize);\r\n  },\r\n\r\n  /**\r\n   * 添加评论（简化方法名）\r\n   * @param {Number} momentId - 动态ID\r\n   * @param {String} content - 评论内容\r\n   */\r\n  addComment(momentId, content) {\r\n    return this.addMomentComment(momentId, content);\r\n  }\r\n};\r\n\r\nexport default momentApi;\r\n"],"names":["http","uni"],"mappings":"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"}