import{_ as e,r as a,a as s,o as l,Q as o,s as t,I as n,d as r,w as c,i,f as d,h as u,j as f,k as g,A as p,R as _,T as v,U as m,V as k,N as h,O as U,q as b,u as x,M as y,K as I}from"./index-BpPI9udZ.js";import{_ as w}from"./logo.BZddfDCa.js";const R=e({__name:"user-info",setup(e){const R=a({phone:"",password:"",nickname:"",gender:0,userId:"",avatar:"",avatarUrl:""}),C=a({logo:!1}),L=s(!1);function T(e){R.gender=e}function j(){_({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{const a=e.tempFilePaths[0];var s;console.log("选择的本地图片路径(blob):",a),R.avatar=a,s=a,v({title:"上传中..."}),m({url:"http://localhost:9001/upload/avatar",filePath:s,name:"file",formData:{},success:e=>{k();const a=e.data;if(console.log("服务器返回的URL:",a),!a||-1===a.indexOf("http"))return console.error("服务器返回的URL格式不正确:",a),void t({title:"头像上传失败，请重试",icon:"none"});R.avatarUrl=a,R.avatar=a,console.log("设置后的头像URL:",R.avatarUrl),console.log("设置后的显示头像:",R.avatar),t({title:"上传成功",icon:"success"})},fail:e=>{k(),console.error("上传失败:",e),t({title:"上传失败",icon:"none"})}})},fail:e=>{console.error("选择图片失败:",e),t({title:"选择图片失败",icon:"none"})}})}async function V(){if(!R.nickname)return void t({title:"请输入昵称",icon:"none"});if(0===R.gender)return void t({title:"请选择性别",icon:"none"});console.log("提交前检查头像URL:",R.avatarUrl),R.avatarUrl&&!R.avatarUrl.startsWith("blob:")||(console.error("检测到头像URL仍然是blob URL或为空:",R.avatarUrl),R.avatarUrl="http://182.254.244.209:9000/lovelink/avatar/2025/07/14/a1f1457c03284f3b9980e616d7b1ad4f.jpg",console.log("已设置默认头像URL:",R.avatarUrl),t({title:"使用默认头像继续",icon:"none"})),L.value=!0;const e={phone:R.phone,password:R.password,nickname:R.nickname,gender:R.gender,avatarUrl:R.avatarUrl};R.userId&&""!==R.userId.trim()&&(e.id=R.userId),console.log("最终提交的注册数据:",e);try{const a=await h.post("/user/register",e);a.data&&a.data.token&&U("token",a.data.token),t({title:"注册成功",icon:"success",duration:1500}),setTimeout((()=>{console.log("准备跳转到首页..."),n({url:"/pages/index/index",success:()=>{console.log("跳转首页成功")},fail:e=>{console.error("跳转失败:",e),t({title:"跳转失败，请稍后重试",icon:"none"})}})}),1500)}catch(a){console.error("注册失败:",a)}finally{L.value=!1}}function D(e){t({title:("user"===e?"用户协议":"隐私政策")+"查看功能开发中",icon:"none"})}function F(){R.phone&&R.password&&U("lastLoginPhone",R.phone),t({title:"跳过信息完善",icon:"none",duration:1500,success:()=>{setTimeout((()=>{n({url:"/pages/login/login",fail:e=>{console.error("跳转失败:",e),t({title:"跳转失败，请稍后重试",icon:"none"})}})}),1500)}})}return l((()=>{const e=o(),a=e[e.length-1].options||{};console.log("页面参数:",a),a.phone?(R.phone=a.phone,console.log("设置手机号:",R.phone)):t({title:"未获取到手机号，请重新注册",icon:"none",complete:()=>{setTimeout((()=>{n({url:"/pages/register/register"})}),1500)}}),a.password&&(R.password=decodeURIComponent(a.password),console.log("设置密码:","已获取(不显示)")),a.userId?(R.userId=a.userId,console.log("设置用户ID:",R.userId)):console.warn("未获取到用户ID")})),(e,a)=>{const s=i,l=b,o=x,t=y,n=I;return d(),r(s,{class:"user-info-page"},{default:c((()=>[u(s,{class:"bg-layer"},{default:c((()=>[u(s,{class:"bg-gradient"}),u(s,{class:"overlay-gradient"})])),_:1}),u(s,{class:"content-container"},{default:c((()=>[u(s,{class:"header"},{default:c((()=>[u(o,{class:"logo",src:w,mode:"aspectFit",onError:a[0]||(a[0]=e=>{C["logo"]=!0})},{default:c((()=>[C.logo?(d(),r(s,{key:0,class:"logo-placeholder"},{default:c((()=>[u(l,{class:"logo-text"},{default:c((()=>[f("缘来如此")])),_:1})])),_:1})):g("",!0)])),_:1}),u(s,{class:"slogan"},{default:c((()=>[f("遇见美好，从心开始")])),_:1})])),_:1}),u(s,{class:"user-info-card"},{default:c((()=>[u(s,{class:"form-title"},{default:c((()=>[f("完善个人信息")])),_:1}),u(s,{class:"avatar-upload"},{default:c((()=>[u(s,{class:"avatar-wrapper",onClick:j},{default:c((()=>[R.avatar?(d(),r(o,{key:0,class:"avatar-preview",src:R.avatar,mode:"aspectFill"},null,8,["src"])):(d(),r(s,{key:1,class:"avatar-placeholder"},{default:c((()=>[u(l,{class:"upload-icon"},{default:c((()=>[f("+")])),_:1}),u(l,{class:"upload-text"},{default:c((()=>[f("上传头像")])),_:1})])),_:1}))])),_:1})])),_:1}),u(s,{class:"form-container"},{default:c((()=>[u(s,{class:"input-group"},{default:c((()=>[u(s,{class:"input-prefix"},{default:c((()=>[u(l,{class:"prefix-icon user-icon"})])),_:1}),u(t,{class:"input-field",type:"text",modelValue:R.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>R.nickname=e),placeholder:"请输入昵称",maxlength:"20"},null,8,["modelValue"])])),_:1}),u(s,{class:"gender-group"},{default:c((()=>[u(l,{class:"gender-title"},{default:c((()=>[f("性别")])),_:1}),u(s,{class:"gender-options"},{default:c((()=>[u(s,{class:p(["gender-option",{active:1===R.gender}]),onClick:a[2]||(a[2]=e=>T(1))},{default:c((()=>[u(l,{class:"gender-icon"},{default:c((()=>[f("♂")])),_:1}),u(l,{class:"gender-text"},{default:c((()=>[f("男")])),_:1})])),_:1},8,["class"]),u(s,{class:p(["gender-option",{active:2===R.gender}]),onClick:a[3]||(a[3]=e=>T(2))},{default:c((()=>[u(l,{class:"gender-icon"},{default:c((()=>[f("♀")])),_:1}),u(l,{class:"gender-text"},{default:c((()=>[f("女")])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),u(n,{class:p(["submit-btn",{loading:L.value}]),onClick:V,disabled:L.value},{default:c((()=>[L.value?(d(),r(s,{key:1,class:"btn-loading"})):(d(),r(l,{key:0},{default:c((()=>[f("完成注册")])),_:1}))])),_:1},8,["class","disabled"])])),_:1})])),_:1}),u(s,{class:"agreement"},{default:c((()=>[u(s,{class:"skip-btn",onClick:F},{default:c((()=>[f("跳过，直接登录")])),_:1}),u(l,{class:"agreement-text"},{default:c((()=>[f("注册即表示您已同意")])),_:1}),u(l,{class:"agreement-link",onClick:a[4]||(a[4]=e=>D("user"))},{default:c((()=>[f("《用户协议》")])),_:1}),u(l,{class:"agreement-text"},{default:c((()=>[f("和")])),_:1}),u(l,{class:"agreement-link",onClick:a[5]||(a[5]=e=>D("privacy"))},{default:c((()=>[f("《隐私政策》")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-c40d8d3c"]]);export{R as default};
