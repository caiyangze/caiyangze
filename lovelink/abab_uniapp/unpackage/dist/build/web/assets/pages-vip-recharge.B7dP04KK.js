import{_ as e,X as a,s,af as t,d as c,w as l,i as o,f as i,h as n,j as d,l as r,m as u,F as p,k as g,t as f,q as y,K as k,A as P}from"./index-BpPI9udZ.js";import{g as h,a as _,c as m,p as v}from"./vip.Ckwwy0Q7.js";const M=e({data:()=>({vipPackages:[],payMethods:[],selectedPackage:null,selectedPayMethod:null,isProcessing:!1,currentOrder:null}),onLoad(){this.loadVipPackages(),this.loadPayMethods()},methods:{goBack(){a()},async loadVipPackages(){try{const e=await h();200===e.code?(this.vipPackages=e.data,console.log("VIP套餐加载成功:",this.vipPackages)):s({title:e.message||"加载套餐失败",icon:"none"})}catch(e){console.error("加载VIP套餐失败:",e),s({title:"网络错误",icon:"none"})}},async loadPayMethods(){try{const e=await _();200===e.code?(this.payMethods=e.data,console.log("支付方式加载成功:",this.payMethods)):s({title:e.message||"加载支付方式失败",icon:"none"})}catch(e){console.error("加载支付方式失败:",e),s({title:"网络错误",icon:"none"})}},selectPackage(e){this.selectedPackage=e.vipType,console.log("选择套餐:",e)},selectPayMethod(e){this.selectedPayMethod=e,console.log("选择支付方式:",e)},getCurrentPrice(){const e=this.vipPackages.find((e=>e.vipType===this.selectedPackage));return e?e.currentPrice:"0.00"},getPayIcon(e){switch(e){case 1:return"💬";case 2:return"💰";case 3:return"🍎";default:return"💳"}},getPackageIcon:e=>["🌟","💎","👑"][e]||"⭐",async processPayment(){if(this.selectedPackage&&this.selectedPayMethod){this.isProcessing=!0;try{const e=await m({vipType:this.selectedPackage});if(200!==e.code)throw new Error(e.message||"创建订单失败");this.currentOrder=e.data,console.log("订单创建成功:",this.currentOrder);const a=await v({orderId:this.currentOrder.orderId,payType:this.selectedPayMethod});if(200!==a.code)throw new Error(a.message||"支付失败");console.log("支付成功:",a.data),s({title:"开通成功！",icon:"success",duration:2e3}),setTimeout((()=>{t({url:`/pages/vip/success?orderData=${encodeURIComponent(JSON.stringify(a.data))}`})}),2e3)}catch(e){console.error("支付处理失败:",e),s({title:e.message||"支付失败",icon:"none"})}finally{this.isProcessing=!1}}else s({title:"请选择套餐和支付方式",icon:"none"})}}},[["render",function(e,a,s,t,h,_){const m=y,v=o,M=k;return i(),c(v,{class:"vip-recharge-page"},{default:l((()=>[n(v,{class:"nav-bar"},{default:l((()=>[n(v,{class:"nav-left",onClick:_.goBack},{default:l((()=>[n(m,{class:"nav-icon"},{default:l((()=>[d("←")])),_:1})])),_:1},8,["onClick"]),n(m,{class:"nav-title"},{default:l((()=>[d("开通VIP")])),_:1}),n(v,{class:"nav-right"})])),_:1}),n(v,{class:"vip-intro"},{default:l((()=>[n(v,{class:"vip-logo"},{default:l((()=>[n(m,{class:"vip-text"},{default:l((()=>[d("VIP")])),_:1}),n(m,{class:"crown-icon"},{default:l((()=>[d("👑")])),_:1})])),_:1}),n(m,{class:"vip-slogan"},{default:l((()=>[d("解锁更多特权，遇见更好的TA")])),_:1})])),_:1}),n(v,{class:"package-section"},{default:l((()=>[n(m,{class:"section-title"},{default:l((()=>[d("💎 选择套餐")])),_:1}),n(v,{class:"package-grid"},{default:l((()=>[(i(!0),r(p,null,u(h.vipPackages,((e,a)=>(i(),c(v,{key:e.vipType,class:P(["package-card",["package-"+(a+1),{selected:h.selectedPackage===e.vipType},{recommended:1===a}]]),onClick:a=>_.selectPackage(e)},{default:l((()=>[e.discount?(i(),c(v,{key:0,class:"package-badge"},{default:l((()=>[n(m,{class:"badge-text"},{default:l((()=>[d(f(e.discount),1)])),_:2},1024)])),_:2},1024)):g("",!0),n(v,{class:"package-icon"},{default:l((()=>[n(m,{class:"icon-text"},{default:l((()=>[d(f(_.getPackageIcon(a)),1)])),_:2},1024)])),_:2},1024),n(v,{class:"package-title"},{default:l((()=>[n(m,{class:"package-name"},{default:l((()=>[d(f(e.name),1)])),_:2},1024),n(m,{class:"package-duration"},{default:l((()=>[d(f(e.duration),1)])),_:2},1024)])),_:2},1024),n(v,{class:"package-pricing"},{default:l((()=>[n(m,{class:"current-price"},{default:l((()=>[d("¥"+f(e.currentPrice),1)])),_:2},1024),e.originalPrice!==e.currentPrice?(i(),c(m,{key:0,class:"original-price"},{default:l((()=>[d("¥"+f(e.originalPrice),1)])),_:2},1024)):g("",!0)])),_:2},1024),n(v,{class:"package-features"},{default:l((()=>[(i(!0),r(p,null,u(e.features.slice(0,2),((e,a)=>(i(),c(m,{key:a,class:"feature-item"},{default:l((()=>[d(f(e),1)])),_:2},1024)))),128)),e.features.length>2?(i(),c(m,{key:0,class:"more-features"},{default:l((()=>[d("+"+f(e.features.length-2)+"项特权",1)])),_:2},1024)):g("",!0)])),_:2},1024),h.selectedPackage===e.vipType?(i(),c(v,{key:1,class:"select-indicator"},{default:l((()=>[n(m,{class:"check-icon"},{default:l((()=>[d("✓")])),_:1})])),_:1})):g("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),h.selectedPackage?(i(),c(v,{key:0,class:"payment-section"},{default:l((()=>[n(m,{class:"section-title"},{default:l((()=>[d("💳 支付方式")])),_:1}),n(v,{class:"payment-grid"},{default:l((()=>[(i(!0),r(p,null,u(h.payMethods,(e=>(i(),c(v,{key:e.payType,class:P(["payment-card",{selected:h.selectedPayMethod===e.payType}]),onClick:a=>_.selectPayMethod(e.payType)},{default:l((()=>[n(v,{class:"payment-icon"},{default:l((()=>[n(m,{class:"pay-icon"},{default:l((()=>[d(f(_.getPayIcon(e.payType)),1)])),_:2},1024)])),_:2},1024),n(m,{class:"payment-name"},{default:l((()=>[d(f(e.name),1)])),_:2},1024),h.selectedPayMethod===e.payType?(i(),c(v,{key:0,class:"payment-check"},{default:l((()=>[n(m,{class:"check-icon"},{default:l((()=>[d("✓")])),_:1})])),_:1})):g("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})):g("",!0),h.selectedPackage&&h.selectedPayMethod?(i(),c(v,{key:1,class:"bottom-section"},{default:l((()=>[n(v,{class:"price-summary"},{default:l((()=>[n(m,{class:"total-text"},{default:l((()=>[d("总计：")])),_:1}),n(m,{class:"total-price"},{default:l((()=>[d("¥"+f(_.getCurrentPrice()),1)])),_:1})])),_:1}),n(M,{class:"pay-button",onClick:_.processPayment,disabled:h.isProcessing},{default:l((()=>[d(f(h.isProcessing?"处理中...":"立即开通VIP"),1)])),_:1},8,["onClick","disabled"])])),_:1})):g("",!0)])),_:1})}],["__scopeId","data-v-9dcd34f3"]]);export{M as default};
