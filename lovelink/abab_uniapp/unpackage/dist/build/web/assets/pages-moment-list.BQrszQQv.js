import{_ as a,a as e,o as l,s as t,d as s,w as n,i as c,f as o,h as i,j as u,t as r,l as d,m as f,F as m,k as _,p as v,X as k,q as g,v as p,B as h,A as b,D as y,C,H as w,u as x}from"./index-BpPI9udZ.js";import{c as I}from"./uni-app.es.BvOIZWhW.js";import M from"./api-moment.C6FdyTFv.js";const L=a({__name:"list",setup(a){const L=e([]),j=e(!1),D=e(!1),U=e(!1),A=e(1),E=e("public");async function q(a=!1){if(!j.value){j.value=!0;try{const e=a?1:A.value;let l;if(l="mine"===E.value?await M.getMyMoments(e,10):await M.getPublicMoments(e,10),200!==l.code)throw new Error(l.message||"加载失败");{const e=l.data.records||[];a?(L.value=e,A.value=1,U.value=!1):L.value.push(...e),e.length<10?U.value=!0:A.value++}}catch(e){console.error("加载动态列表失败:",e),t({title:e.message||"加载失败",icon:"none"})}finally{j.value=!1,D.value=!1}}}function z(){D.value=!0,q(!0)}function B(){U.value||q()}function F(a){const e=new Date(a),l=new Date-e;return l<6e4?"刚刚":l<36e5?Math.floor(l/6e4)+"分钟前":l<864e5?Math.floor(l/36e5)+"小时前":Math.floor(l/864e5)+"天前"}function H(){v({url:"/pages/moment/publish"})}function P(){k()}function R(a){C({itemList:["删除"],success:e=>{0===e.tapIndex&&async function(a){w({title:"确认删除",content:"确定要删除这条动态吗？",success:async e=>{if(e.confirm)try{const e=await M.deleteMoment(a.momentId);if(200!==e.code)throw new Error(e.message||"删除失败");{const e=L.value.findIndex((e=>e.momentId===a.momentId));e>-1&&L.value.splice(e,1),t({title:"删除成功",icon:"success"})}}catch(l){t({title:l.message||"删除失败",icon:"none"})}}})}(a)}})}return I((a=>{"mine"===a.type&&(E.value="mine")})),l((()=>{q()})),(a,e)=>{const l=c,t=g,v=x,k=p;return o(),s(l,{class:"moment-list-page"},{default:n((()=>[i(l,{class:"bg-layer"},{default:n((()=>[i(l,{class:"bg-gradient"})])),_:1}),i(l,{class:"content-container"},{default:n((()=>[i(l,{class:"custom-navbar"},{default:n((()=>[i(l,{class:"navbar-left",onClick:P},{default:n((()=>[i(t,{class:"back-icon"},{default:n((()=>[u("‹")])),_:1}),i(t,{class:"back-text"},{default:n((()=>[u("返回")])),_:1})])),_:1}),i(l,{class:"navbar-center"},{default:n((()=>[i(t,{class:"navbar-title"},{default:n((()=>[u(r("mine"===E.value?"我的动态":"动态广场"),1)])),_:1})])),_:1}),i(l,{class:"navbar-right",onClick:H},{default:n((()=>[i(t,{class:"publish-btn"},{default:n((()=>[u("发布")])),_:1})])),_:1})])),_:1}),i(k,{"scroll-y":"",class:"scroll-area",onScrolltolower:B,"refresher-enabled":"",onRefresherrefresh:z,"refresher-triggered":D.value},{default:n((()=>[(o(!0),d(m,null,f(L.value,(a=>(o(),s(l,{key:a.momentId,class:"moment-item",onClick:e=>function(a){console.log("查看动态详情:",a)}(a)},{default:n((()=>[i(l,{class:"user-info"},{default:n((()=>[i(v,{src:a.avatarUrl||"/static/default-avatar.png",class:"avatar"},null,8,["src"]),i(l,{class:"user-details"},{default:n((()=>[i(t,{class:"nickname"},{default:n((()=>[u(r(a.nickname||"匿名用户"),1)])),_:2},1024),i(t,{class:"time"},{default:n((()=>[u(r(F(a.createdAt)),1)])),_:2},1024)])),_:2},1024),a.isMine?(o(),s(l,{key:0,class:"more-btn",onClick:h((e=>R(a)),["stop"])},{default:n((()=>[i(t,null,{default:n((()=>[u("⋯")])),_:1})])),_:2},1032,["onClick"])):_("",!0)])),_:2},1024),i(l,{class:"content"},{default:n((()=>[i(t,null,{default:n((()=>[u(r(a.content),1)])),_:2},1024)])),_:2},1024),a.location?(o(),s(l,{key:0,class:"location"},{default:n((()=>[i(t,{class:"location-icon"},{default:n((()=>[u("📍")])),_:1}),i(t,{class:"location-text"},{default:n((()=>[u(r(a.location),1)])),_:2},1024)])),_:2},1024)):_("",!0),a.mediaList&&a.mediaList.length>0?(o(),s(l,{key:1,class:"media-grid"},{default:n((()=>[(o(!0),d(m,null,f(a.mediaList,((e,l)=>(o(),s(v,{key:e.mediaId,src:e.mediaUrl,class:"media-image",onClick:h((e=>function(a,e){const l=a.map((a=>a.mediaUrl));y({current:e,urls:l})}(a.mediaList,l)),["stop"])},null,8,["src","onClick"])))),128))])),_:2},1024)):_("",!0),i(l,{class:"actions"},{default:n((()=>[i(l,{class:"action-item",onClick:h((e=>function(a){console.log("点赞:",a)}(a)),["stop"])},{default:n((()=>[i(t,{class:b(["action-icon",a.isLiked?"liked":""])},{default:n((()=>[u("❤️")])),_:2},1032,["class"]),i(t,{class:"action-text"},{default:n((()=>[u(r(a.likeCount||0),1)])),_:2},1024)])),_:2},1032,["onClick"]),i(l,{class:"action-item",onClick:h((e=>function(a){console.log("查看评论:",a)}(a)),["stop"])},{default:n((()=>[i(t,{class:"action-icon"},{default:n((()=>[u("💬")])),_:1}),i(t,{class:"action-text"},{default:n((()=>[u(r(a.commentCount||0),1)])),_:2},1024)])),_:2},1032,["onClick"]),i(l,{class:"action-item"},{default:n((()=>[i(t,{class:"action-icon"},{default:n((()=>[u("👁️")])),_:1}),i(t,{class:"action-text"},{default:n((()=>[u(r(a.viewCount||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),j.value?(o(),s(l,{key:0,class:"loading"},{default:n((()=>[i(t,null,{default:n((()=>[u("加载中...")])),_:1})])),_:1})):_("",!0),U.value&&L.value.length>0?(o(),s(l,{key:1,class:"no-more"},{default:n((()=>[i(t,null,{default:n((()=>[u("没有更多了")])),_:1})])),_:1})):_("",!0),0!==L.value.length||j.value?_("",!0):(o(),s(l,{key:2,class:"empty"},{default:n((()=>[i(t,null,{default:n((()=>[u("暂无动态")])),_:1})])),_:1}))])),_:1},8,["refresher-triggered"]),i(l,{class:"fab",onClick:H},{default:n((()=>[i(t,{class:"fab-icon"},{default:n((()=>[u("+")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-b29391c9"]]);export{L as default};
