import{_ as a,r as t,a as e,a4 as s,d as l,w as n,i as o,f as c,h as i,j as u,A as d,l as r,m as f,F as m,k as p,t as _,R as h,s as v,H as g,C as b,g as k,p as y,T as w,V as C,e as x,X as T,q as j,W as P,D as V,u as E}from"./index-BpPI9udZ.js";import I from"./api-moment.C6FdyTFv.js";const z=a({__name:"publish",setup(a){const z=t({content:"",location:"",visibility:1}),F=e([]),U=e(!1),q=s((()=>z.content.trim().length>0&&!U.value)),A=s((()=>({1:"ÂÖ¨ÂºÄ",2:"‰ªÖÂÖ≥Ê≥®ËÄÖÂèØËßÅ",3:"‰ªÖËá™Â∑±ÂèØËßÅ"}[z.visibility])));function D(){const a=9-F.value.length;h({count:a,sizeType:["compressed"],sourceType:["album","camera"],success:a=>{a.tempFilePaths.forEach((a=>{F.value.push({url:a,path:a})}))},fail:a=>{console.error("ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•:",a),v({title:"ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•",icon:"none"})}})}function H(){g({title:"Ê∑ªÂä†‰ΩçÁΩÆ",editable:!0,placeholderText:"ËØ∑ËæìÂÖ•‰ΩçÁΩÆ‰ø°ÊÅØ",success:a=>{a.confirm&&a.content&&(z.location=a.content)}})}function L(){b({itemList:["ÂÖ¨ÂºÄ","‰ªÖÂÖ≥Ê≥®ËÄÖÂèØËßÅ","‰ªÖËá™Â∑±ÂèØËßÅ"],success:a=>{z.visibility=a.tapIndex+1}})}async function M(){if(!q.value)return void v({title:"ËØ∑ËæìÂÖ•Âä®ÊÄÅÂÜÖÂÆπ",icon:"none"});if(k("token")){U.value=!0;try{let a=[];if(F.value.length>0){w({title:"‰∏ä‰º†ÂõæÁâá‰∏≠..."});const t=F.value.map((async a=>{const t=await I.uploadMomentImage(a.path);if(200===t.code)return t.data;throw new Error(t.message||"ÂõæÁâá‰∏ä‰º†Â§±Ë¥•")}));a=await Promise.all(t),C()}w({title:"ÂèëÂ∏É‰∏≠..."});const t=k("token"),e=await new Promise(((e,s)=>{x({url:"http://localhost:9002/api/social/moment/create",method:"POST",header:{"Content-Type":"application/json",token:t},data:{content:z.content,location:z.location,visibility:z.visibility,imageUrls:a},success:a=>{e(a.data)},fail:a=>{s(a)}})}));if(C(),200!==e.code)throw new Error(e.message||"ÂèëÂ∏ÉÂ§±Ë¥•");v({title:"ÂèëÂ∏ÉÊàêÂäü",icon:"success"}),setTimeout((()=>{T()}),1500)}catch(a){C(),console.error("ÂèëÂ∏ÉÂ§±Ë¥•:",a),v({title:a.message||"ÂèëÂ∏ÉÂ§±Ë¥•ÔºåËØ∑ÈáçËØï",icon:"none"})}finally{U.value=!1}}else g({title:"ÊèêÁ§∫",content:"ËØ∑ÂÖàÁôªÂΩï",success:a=>{a.confirm&&y({url:"/pages/login/login"})}})}function O(){z.content.trim()||F.value.length>0?g({title:"ÊèêÁ§∫",content:"Á°ÆÂÆöË¶ÅÊîæÂºÉÁºñËæëÂêóÔºü",success:a=>{a.confirm&&T()}}):T()}return(a,t)=>{const e=o,s=j,h=P,v=E;return c(),l(e,{class:"publish-page"},{default:n((()=>[i(e,{class:"bg-layer"},{default:n((()=>[i(e,{class:"bg-gradient"})])),_:1}),i(e,{class:"content-container"},{default:n((()=>[i(e,{class:"custom-navbar"},{default:n((()=>[i(e,{class:"navbar-left",onClick:O},{default:n((()=>[i(s,{class:"back-icon"},{default:n((()=>[u("‚Äπ")])),_:1}),i(s,{class:"back-text"},{default:n((()=>[u("ËøîÂõû")])),_:1})])),_:1}),i(e,{class:"navbar-center"},{default:n((()=>[i(s,{class:"navbar-title"},{default:n((()=>[u("ÂèëÂ∏ÉÂä®ÊÄÅ")])),_:1})])),_:1}),i(e,{class:"navbar-right",onClick:M},{default:n((()=>[i(s,{class:d(["publish-btn",{disabled:!q.value}])},{default:n((()=>[u("ÂèëÂ∏É")])),_:1},8,["class"])])),_:1})])),_:1}),i(e,{class:"main-content"},{default:n((()=>[i(e,{class:"content-section"},{default:n((()=>[i(h,{modelValue:z.content,"onUpdate:modelValue":t[0]||(t[0]=a=>z.content=a),placeholder:"ÂàÜ‰∫´‰Ω†ÁöÑÁîüÊ¥ª...",class:"content-input",maxlength:"1000","show-count":!0,"auto-height":""},null,8,["modelValue"])])),_:1}),i(e,{class:"media-section"},{default:n((()=>[i(e,{class:"media-grid"},{default:n((()=>[(c(!0),r(m,null,f(F.value,((a,t)=>(c(),l(e,{key:t,class:"media-item"},{default:n((()=>[i(v,{src:a.url,class:"media-image",onClick:a=>function(a){const t=F.value.map((a=>a.url));V({current:a,urls:t})}(t)},null,8,["src","onClick"]),i(e,{class:"delete-btn",onClick:a=>function(a){F.value.splice(a,1)}(t)},{default:n((()=>[u("√ó")])),_:2},1032,["onClick"])])),_:2},1024)))),128)),F.value.length<9?(c(),l(e,{key:0,class:"add-media-btn",onClick:D},{default:n((()=>[i(s,{class:"add-icon"},{default:n((()=>[u("+")])),_:1}),i(s,{class:"add-text"},{default:n((()=>[u("Ê∑ªÂä†ÂõæÁâá")])),_:1})])),_:1})):p("",!0)])),_:1})])),_:1}),i(e,{class:"options-section"},{default:n((()=>[i(e,{class:"option-item",onClick:H},{default:n((()=>[i(e,{class:"option-left"},{default:n((()=>[i(s,{class:"option-icon"},{default:n((()=>[u("üìç")])),_:1}),i(s,{class:"option-label"},{default:n((()=>[u("‰ΩçÁΩÆ")])),_:1})])),_:1}),i(e,{class:"option-right"},{default:n((()=>[i(s,{class:"option-value"},{default:n((()=>[u(_(z.location||"Ê∑ªÂä†‰ΩçÁΩÆ"),1)])),_:1}),i(s,{class:"arrow-icon"},{default:n((()=>[u("‚Ä∫")])),_:1})])),_:1})])),_:1}),i(e,{class:"option-item",onClick:L},{default:n((()=>[i(e,{class:"option-left"},{default:n((()=>[i(s,{class:"option-icon"},{default:n((()=>[u("üëÅÔ∏è")])),_:1}),i(s,{class:"option-label"},{default:n((()=>[u("ÂèØËßÅËåÉÂõ¥")])),_:1})])),_:1}),i(e,{class:"option-right"},{default:n((()=>[i(s,{class:"option-value"},{default:n((()=>[u(_(A.value),1)])),_:1}),i(s,{class:"arrow-icon"},{default:n((()=>[u("‚Ä∫")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),U.value?(c(),l(e,{key:0,class:"loading-mask"},{default:n((()=>[i(e,{class:"loading-content"},{default:n((()=>[i(e,{class:"loading-spinner"}),i(s,{class:"loading-text"},{default:n((()=>[u("ÂèëÂ∏É‰∏≠...")])),_:1})])),_:1})])),_:1})):p("",!0)])),_:1})}}},[["__scopeId","data-v-2e864c6b"]]);export{z as default};
