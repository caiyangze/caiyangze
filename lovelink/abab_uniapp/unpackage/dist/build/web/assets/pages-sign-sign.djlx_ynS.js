import{N as a,_ as t,X as e,g as s,s as n,ae as l,J as d,d as i,w as o,i as r,f as c,h as g,j as u,t as h,A as f,l as y,m as _,F as S,q as w,K as D,k as m}from"./index-BpPI9udZ.js";const T=t({data:()=>({signCount:0,hasSignedToday:!1,signing:!1,currentMonth:"",todayDate:"",calendarDays:[],weekDays:["日","一","二","三","四","五","六"]}),onLoad(){this.clearLocalSignStorage(),this.initPage()},onShow(){this.loadSignData()},methods:{initPage(){const a=new Date;this.currentMonth=`${a.getFullYear()}年${a.getMonth()+1}月`,this.todayDate=`${a.getMonth()+1}/${a.getDate()}`,this.generateCalendar()},goBack(){e()},async loadSignData(){try{const t=await a.request({url:"/sign/count",method:"GET",hideErrorToast:!0});200===t.code&&(this.signCount=t.data||0),await this.checkTodaySignStatus(),await this.loadMonthSignRecord()}catch(t){console.error("获取签到数据失败:",t)}},async checkTodaySignStatus(){try{const t=await a.request({url:"/sign/today",method:"GET",hideErrorToast:!0});200===t.code&&(this.hasSignedToday=!0===t.data)}catch(t){console.error("检查今天签到状态失败:",t);const a=new Date,e=`sign_${a.getFullYear()}_${a.getMonth()+1}_${a.getDate()}`;this.hasSignedToday="true"===s(e)}},async loadMonthSignRecord(){try{const t=await a.request({url:"/sign/month",method:"GET",hideErrorToast:!0});if(200===t.code){const a=t.data||0;this.updateCalendarWithSignRecord(a)}else this.clearCalendarSignStatus()}catch(t){console.error("获取本月签到记录失败:",t),this.clearCalendarSignStatus()}},async handleSign(){if(!this.hasSignedToday&&!this.signing){this.signing=!0;try{const t=await a.request({url:"/sign",method:"POST",hideErrorToast:!0});200===t.code?(this.hasSignedToday=!0,this.signCount+=1,await this.loadMonthSignRecord(),n({title:t.message||"签到成功，获得5个金币！",icon:"success",duration:3e3})):n({title:t.message||"签到失败",icon:"none"})}catch(t){console.error("签到失败:",t);let a="签到失败";t&&t.message&&(a=t.message),n({title:a,icon:"none"})}finally{this.signing=!1}}},generateCalendar(){const a=new Date,t=a.getFullYear(),e=a.getMonth(),s=a.getDate(),n=new Date(t,e,1),l=new Date(t,e+1,0),d=n.getDay(),i=[];if(d>0){const a=new Date(t,e,0).getDate();for(let s=d-1;s>=0;s--){const n=a-s;i.push({date:new Date(t,e-1,n).getTime(),day:n,signed:!1,isToday:!1,inCurrentMonth:!1})}}for(let r=1;r<=l.getDate();r++){const a=new Date(t,e,r);i.push({date:a.getTime(),day:r,signed:!1,isToday:r===s,inCurrentMonth:!0})}const o=42-i.length;for(let r=1;r<=o;r++)i.push({date:new Date(t,e+1,r).getTime(),day:r,signed:!1,isToday:!1,inCurrentMonth:!1});this.calendarDays=i},updateCalendarWithSignRecord(a){if(!a)return void this.clearCalendarSignStatus();const t=(new Date).getDate();for(let e=1;e<=t;e++){const t=0!=(a&1<<e-1);this.calendarDays.forEach((a=>{a.day===e&&a.inCurrentMonth&&(a.signed=t)}))}},clearCalendarSignStatus(){this.calendarDays.forEach((a=>{a.inCurrentMonth&&(a.signed=!1)}))},clearLocalSignStorage(){try{const a=l();(a.keys||[]).forEach((a=>{a.startsWith("sign_")&&d(a)})),console.log("已清理本地签到存储记录")}catch(a){console.error("清理本地存储失败:",a)}}}},[["render",function(a,t,e,s,n,l){const d=r,T=w,C=D;return c(),i(d,{class:"sign-page"},{default:o((()=>[g(d,{class:"bg-layer"},{default:o((()=>[g(d,{class:"bg-gradient"})])),_:1}),g(d,{class:"content-container"},{default:o((()=>[g(d,{class:"nav-bar"},{default:o((()=>[g(d,{class:"nav-left",onClick:l.goBack},{default:o((()=>[g(T,{class:"nav-icon"},{default:o((()=>[u("←")])),_:1})])),_:1},8,["onClick"]),g(T,{class:"nav-title"},{default:o((()=>[u("每日签到")])),_:1}),g(d,{class:"nav-right"})])),_:1}),g(d,{class:"stats-card"},{default:o((()=>[g(d,{class:"stats-item"},{default:o((()=>[g(T,{class:"stats-number"},{default:o((()=>[u(h(n.signCount),1)])),_:1}),g(T,{class:"stats-label"},{default:o((()=>[u("连续签到")])),_:1})])),_:1}),g(d,{class:"stats-divider"}),g(d,{class:"stats-item"},{default:o((()=>[g(T,{class:"stats-number"},{default:o((()=>[u(h(n.todayDate),1)])),_:1}),g(T,{class:"stats-label"},{default:o((()=>[u("今日日期")])),_:1})])),_:1})])),_:1}),g(d,{class:"sign-button-container"},{default:o((()=>[g(C,{class:f(["sign-button",{signed:n.hasSignedToday,loading:n.signing}]),onClick:l.handleSign,disabled:n.hasSignedToday||n.signing},{default:o((()=>[g(d,{class:"button-content"},{default:o((()=>[g(T,{class:"button-icon"},{default:o((()=>[u(h(n.hasSignedToday?"✓":"📅"),1)])),_:1}),g(T,{class:"button-text"},{default:o((()=>[u(h(n.signing?"签到中...":n.hasSignedToday?"今日已签到":"立即签到"),1)])),_:1})])),_:1})])),_:1},8,["class","onClick","disabled"])])),_:1}),g(d,{class:"reward-section"},{default:o((()=>[g(T,{class:"section-title"},{default:o((()=>[u("签到奖励")])),_:1}),g(d,{class:"reward-list"},{default:o((()=>[g(d,{class:"reward-item"},{default:o((()=>[g(T,{class:"reward-icon"},{default:o((()=>[u("🪙")])),_:1}),g(T,{class:"reward-text"},{default:o((()=>[u("每日签到获得5金币")])),_:1})])),_:1}),g(d,{class:"reward-item"},{default:o((()=>[g(T,{class:"reward-icon"},{default:o((()=>[u("🎁")])),_:1}),g(T,{class:"reward-text"},{default:o((()=>[u("连续7天额外获得优惠券")])),_:1})])),_:1}),g(d,{class:"reward-item"},{default:o((()=>[g(T,{class:"reward-icon"},{default:o((()=>[u("💎")])),_:1}),g(T,{class:"reward-text"},{default:o((()=>[u("连续30天获得VIP体验")])),_:1})])),_:1})])),_:1})])),_:1}),g(d,{class:"history-section"},{default:o((()=>[g(T,{class:"section-title"},{default:o((()=>[u("本月签到记录")])),_:1}),g(d,{class:"calendar-container"},{default:o((()=>[g(d,{class:"calendar-header"},{default:o((()=>[g(T,{class:"month-text"},{default:o((()=>[u(h(n.currentMonth),1)])),_:1})])),_:1}),g(d,{class:"week-header"},{default:o((()=>[(c(!0),y(S,null,_(n.weekDays,(a=>(c(),i(d,{class:"week-item",key:a},{default:o((()=>[g(T,{class:"week-text"},{default:o((()=>[u(h(a),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),g(d,{class:"calendar-grid"},{default:o((()=>[(c(!0),y(S,null,_(n.calendarDays,(a=>(c(),i(d,{key:a.date,class:f(["calendar-day",{signed:a.signed,today:a.isToday,disabled:!a.inCurrentMonth}])},{default:o((()=>[g(T,{class:"day-number"},{default:o((()=>[u(h(a.day),1)])),_:2},1024),a.signed&&a.inCurrentMonth?(c(),i(d,{key:0,class:"sign-mark"},{default:o((()=>[u("✓")])),_:1})):m("",!0)])),_:2},1032,["class"])))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-259f371d"]]);export{T as default};
