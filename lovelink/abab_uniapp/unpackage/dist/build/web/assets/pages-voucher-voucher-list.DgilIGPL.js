import{N as e,_ as t,X as s,s as a,T as r,V as i,d as u,w as c,i as l,f as o,h as n,j as h,l as d,m as f,F as g,t as m,k as p,q as T,v,A as k,K as y}from"./index-BpPI9udZ.js";const b=t({data:()=>({currentTab:0,tabs:[{name:"å¯é¢†å–",key:"available"},{name:"æˆ‘çš„åˆ¸",key:"my"}],voucherList:[],loading:!1,refreshing:!1,hasMore:!0,pageNum:1,pageSize:10}),onLoad(){this.loadVoucherList()},methods:{goBack(){s()},switchTab(e){this.currentTab=e,this.resetList(),this.loadVoucherList()},resetList(){this.voucherList=[],this.pageNum=1,this.hasMore=!0},async loadVoucherList(){if(!this.loading){this.loading=!0;try{let t;if(t=0===this.currentTab?await function(t={}){return e.request({url:"/voucher/list",method:"POST",data:Object.assign({pageNum:t.pageNum||1,pageSize:t.pageSize||10},t),hideErrorToast:!0})}({pageNum:this.pageNum,pageSize:this.pageSize}):await function(t={}){return e.request({url:"/voucher/getMyVoucherList",method:"POST",data:{pageNum:t.pageNum||1,pageSize:t.pageSize||10,status:t.status,...t},hideErrorToast:!0})}({pageNum:this.pageNum,pageSize:this.pageSize}),200===t.code){const e=t.data;let s=e.records||e||[];1===this.currentTab&&(s=s.map((e=>({...e.voucher||{},orderId:e.id,orderStatus:e.status,payTime:e.payTime,useTime:e.useTime,createTime:e.createTime,voucherStatus:this.getVoucherStatusFromOrder(e.status)})))),1===this.pageNum?this.voucherList=s:this.voucherList.push(...s),e.records?this.hasMore=e.current<e.pages:this.hasMore=s.length>=this.pageSize}}catch(t){console.error("åŠ è½½ä¼˜æƒ åˆ¸åˆ—è¡¨å¤±è´¥:",t);let e="åŠ è½½å¤±è´¥";t&&t.message?e=t.message:t&&"string"==typeof t?e=t:t&&t.data&&t.data.message&&(e=t.data.message),a({title:e,icon:"none"})}finally{this.loading=!1,this.refreshing=!1}}},onRefresh(){this.refreshing=!0,this.resetList(),this.loadVoucherList()},loadMore(){this.hasMore&&!this.loading&&(this.pageNum++,this.loadVoucherList())},async handleVoucherAction(e){0===this.currentTab&&await this.seckillVoucher(e)},async seckillVoucher(t){try{r({title:"é¢†å–ä¸­..."});const u=await(s=t.id,e.request({url:`/voucher/seckill?voucherId=${s}`,method:"POST",hideErrorToast:!0}));200===u.code?(a({title:"é¢†å–æˆåŠŸ",icon:"success"}),this.onRefresh()):a({title:u.message||"é¢†å–å¤±è´¥",icon:"none"})}catch(u){console.error("é¢†å–ä¼˜æƒ åˆ¸å¤±è´¥:",u);let e="é¢†å–å¤±è´¥";u&&u.message?e=u.message:u&&"string"==typeof u?e=u:u&&u.data&&u.data.message&&(e=u.data.message),a({title:e,icon:"none",duration:3e3})}finally{i()}var s},getVoucherClass(e){const t=[];return 1===e.type&&t.push("seckill-voucher"),this.isVoucherExpired(e)&&t.push("expired"),this.isVoucherUsed(e)&&t.push("used"),t.join(" ")},getVoucherTypeText:e=>({0:"æ™®é€šåˆ¸",1:"ç§’æ€åˆ¸",2:"ä»£é‡‘åˆ¸"}[e]||"ä¼˜æƒ åˆ¸"),getTimeText(e){if(!e)return"";const t=new Date,s=new Date(e.beginTime),a=new Date(e.endTime);return t<s?`${this.formatTime(s)} å¼€å§‹`:t>a?"å·²ç»“æŸ":`${this.formatTime(a)} ç»“æŸ`},getBtnClass(e){if(1===this.currentTab&&e.voucherStatus)switch(e.voucherStatus){case"unused":return"available";case"used":case"cancelled":case"refunded":default:return"disabled";case"unpaid":case"refunding":return"warning"}return this.isVoucherDisabled(e)?"disabled":1===e.type?"seckill":"normal"},getBtnText(e){if(1===this.currentTab){if(e.voucherStatus)switch(e.voucherStatus){case"unpaid":return"æœªæ”¯ä»˜";case"unused":return"æœªä½¿ç”¨";case"used":return"å·²ä½¿ç”¨";case"cancelled":return"å·²å–æ¶ˆ";case"refunding":return"é€€æ¬¾ä¸­";case"refunded":return"å·²é€€æ¬¾";default:return"æœªçŸ¥çŠ¶æ€"}return this.isVoucherUsed(e)?"å·²ä½¿ç”¨":this.isVoucherExpired(e)?"å·²è¿‡æœŸ":"æœªä½¿ç”¨"}return this.isVoucherExpired(e)?"å·²è¿‡æœŸ":e.seckilVoucher&&e.seckilVoucher.stock<=0?"å·²æŠ¢å®Œ":1===e.type?"ç«‹å³æŠ¢è´­":"ç«‹å³é¢†å–"},isVoucherDisabled(e){return 1===this.currentTab||(this.isVoucherExpired(e)||e.seckilVoucher&&e.seckilVoucher.stock<=0)},isVoucherExpired(e){if(!e.seckilVoucher)return!1;return new Date>new Date(e.seckilVoucher.endTime)},isVoucherUsed(e){return 1===this.currentTab&&e.voucherStatus?"used"===e.voucherStatus:3===e.status},getVoucherStatusFromOrder(e){switch(e){case 1:return"unpaid";case 2:return"unused";case 3:return"used";case 4:return"cancelled";case 5:return"refunding";case 6:return"refunded";default:return"unknown"}},formatTime(e){const t=new Date(e);return`${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}}},[["render",function(e,t,s,a,r,i){const b=T,_=l,V=y,S=v;return o(),u(_,{class:"voucher-page"},{default:c((()=>[n(_,{class:"nav-bar"},{default:c((()=>[n(_,{class:"nav-left",onClick:i.goBack},{default:c((()=>[n(b,{class:"nav-icon"},{default:c((()=>[h("â†")])),_:1})])),_:1},8,["onClick"]),n(b,{class:"nav-title"},{default:c((()=>[h("ä¼˜æƒ åˆ¸ä¸­å¿ƒ")])),_:1}),n(_,{class:"nav-right"})])),_:1}),n(_,{class:"tab-bar"},{default:c((()=>[(o(!0),d(g,null,f(r.tabs,((e,t)=>(o(),u(_,{key:t,class:k(["tab-item",{active:r.currentTab===t}]),onClick:e=>i.switchTab(t)},{default:c((()=>[n(b,{class:"tab-text"},{default:c((()=>[h(m(e.name),1)])),_:2},1024),r.currentTab===t?(o(),u(_,{key:0,class:"tab-indicator"})):p("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),n(S,{"scroll-y":"",class:"voucher-list",onScrolltolower:i.loadMore,"refresher-enabled":"",onRefresherrefresh:i.onRefresh,"refresher-triggered":r.refreshing},{default:c((()=>[n(_,{class:"voucher-container"},{default:c((()=>[(o(!0),d(g,null,f(r.voucherList,((e,t)=>(o(),u(_,{key:e.id,class:k(["voucher-card",i.getVoucherClass(e)])},{default:c((()=>[n(_,{class:"voucher-main"},{default:c((()=>[n(_,{class:"voucher-left"},{default:c((()=>[n(_,{class:"voucher-value"},{default:c((()=>[n(b,{class:"value-number"},{default:c((()=>[h(m(e.actualValue),1)])),_:2},1024),n(b,{class:"value-unit"},{default:c((()=>[h("å¸")])),_:1})])),_:2},1024),n(b,{class:"voucher-type"},{default:c((()=>[h(m(i.getVoucherTypeText(e.type)),1)])),_:2},1024)])),_:2},1024),n(_,{class:"voucher-divider"}),n(_,{class:"voucher-right"},{default:c((()=>[n(_,{class:"voucher-info"},{default:c((()=>[n(b,{class:"voucher-title"},{default:c((()=>[h(m(e.title),1)])),_:2},1024),n(b,{class:"voucher-subtitle"},{default:c((()=>[h(m(e.subTitle),1)])),_:2},1024),e.seckilVoucher&&0===r.currentTab?(o(),u(_,{key:0,class:"seckill-info"},{default:c((()=>[n(b,{class:"stock-text"},{default:c((()=>[h("å‰©ä½™: "+m(e.seckilVoucher.stock)+"å¼ ",1)])),_:2},1024),n(b,{class:"time-text"},{default:c((()=>[h(m(i.getTimeText(e.seckilVoucher)),1)])),_:2},1024)])),_:2},1024)):p("",!0),1===r.currentTab?(o(),u(_,{key:1,class:"my-voucher-info"},{default:c((()=>[e.payTime?(o(),u(b,{key:0,class:"info-text"},{default:c((()=>[h("è·å–æ—¶é—´: "+m(i.formatTime(e.payTime)),1)])),_:2},1024)):p("",!0),e.useTime?(o(),u(b,{key:1,class:"info-text"},{default:c((()=>[h("ä½¿ç”¨æ—¶é—´: "+m(i.formatTime(e.useTime)),1)])),_:2},1024)):p("",!0),e.orderId?(o(),u(b,{key:2,class:"info-text"},{default:c((()=>[h("è®¢å•å·: "+m(e.orderId),1)])),_:2},1024)):p("",!0)])),_:2},1024)):p("",!0)])),_:2},1024),n(V,{class:k(["voucher-btn",i.getBtnClass(e)]),onClick:t=>i.handleVoucherAction(e),disabled:i.isVoucherDisabled(e)},{default:c((()=>[h(m(i.getBtnText(e)),1)])),_:2},1032,["class","onClick","disabled"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128)),0!==r.voucherList.length||r.loading?p("",!0):(o(),u(_,{key:0,class:"empty-state"},{default:c((()=>[n(b,{class:"empty-icon"},{default:c((()=>[h("ğŸ«")])),_:1}),n(b,{class:"empty-text"},{default:c((()=>[h("æš‚æ— ä¼˜æƒ åˆ¸")])),_:1}),n(b,{class:"empty-desc"},{default:c((()=>[h(m(0===r.currentTab?"æš‚æ—¶æ²¡æœ‰å¯é¢†å–çš„ä¼˜æƒ åˆ¸":"æ‚¨è¿˜æ²¡æœ‰ä¼˜æƒ åˆ¸"),1)])),_:1})])),_:1})),r.loading?(o(),u(_,{key:1,class:"loading-state"},{default:c((()=>[n(b,null,{default:c((()=>[h("åŠ è½½ä¸­...")])),_:1})])),_:1})):p("",!0),r.hasMore&&r.voucherList.length>0?(o(),u(_,{key:2,class:"load-more"},{default:c((()=>[n(b,null,{default:c((()=>[h("ä¸Šæ‹‰åŠ è½½æ›´å¤š")])),_:1})])),_:1})):p("",!0)])),_:1})])),_:1},8,["onScrolltolower","onRefresherrefresh","refresher-triggered"])])),_:1})}],["__scopeId","data-v-8c820d68"]]);export{b as default};
