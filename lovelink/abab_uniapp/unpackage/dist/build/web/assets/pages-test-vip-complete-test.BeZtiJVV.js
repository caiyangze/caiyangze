import{_ as t,H as s,p as e,d as a,w as l,i,f as c,h as r,j as d,A as u,t as o,k as n,l as h,m as p,F as f,q as _,K as m}from"./index-BpPI9udZ.js";import{d as R,g as T,c as v,p as y}from"./vip.Ckwwy0Q7.js";const V=t({data:()=>({vipStatus:null,testResults:[],currentOrder:null}),onLoad(){this.checkVipStatus()},methods:{async checkVipStatus(){try{const t=await R();200===t.code?(this.vipStatus=t.data,this.addTestResult("VIP状态查询","成功获取VIP状态",!0)):this.addTestResult("VIP状态查询",t.message||"查询失败",!1)}catch(t){console.error("查询VIP状态失败:",t),this.addTestResult("VIP状态查询","网络错误",!1)}},async testCompleteFlow(){this.addTestResult("完整流程测试","开始测试完整VIP购买流程...",!0);try{if(200!==(await T()).code)throw new Error("获取套餐列表失败");this.addTestResult("获取套餐","成功获取套餐列表",!0);const t=await v({vipType:2});if(200!==t.code)throw new Error("创建订单失败");this.currentOrder=t.data,this.addTestResult("创建订单",`订单创建成功，订单号：${this.currentOrder.orderNo}`,!0);const e=await y({orderId:this.currentOrder.orderId,payType:1});if(200!==e.code)throw new Error("支付处理失败");this.addTestResult("支付处理",`支付成功，交易号：${e.data.transactionId}`,!0),await this.checkVipStatus(),this.addTestResult("完整流程","✅ VIP购买流程测试完成！请检查数据库记录",!0),s({title:"测试完成",content:"完整VIP购买流程测试成功！\n\n请检查数据库：\n1. tb_vip_order 表的订单记录\n2. tb_user 表的用户角色更新\n3. tb_wallet_transaction 表的交易记录",showCancel:!1})}catch(t){console.error("完整流程测试失败:",t),this.addTestResult("完整流程",`测试失败：${t.message}`,!1)}},testVipRecharge(){e({url:"/pages/vip/recharge"})},async testCreateOrder(){try{const t=await v({vipType:1});200===t.code?(this.currentOrder=t.data,this.addTestResult("创建订单",`订单创建成功，金额：¥${t.data.payAmount}`,!0)):this.addTestResult("创建订单",t.message||"创建失败",!1)}catch(t){console.error("创建订单失败:",t),this.addTestResult("创建订单","网络错误",!1)}},async testPayment(){if(this.currentOrder)try{const t=await y({orderId:this.currentOrder.orderId,payType:2});200===t.code?(this.addTestResult("支付测试",`支付成功，交易号：${t.data.transactionId}`,!0),await this.checkVipStatus()):this.addTestResult("支付测试",t.message||"支付失败",!1)}catch(t){console.error("支付测试失败:",t),this.addTestResult("支付测试","网络错误",!1)}else this.addTestResult("支付测试","请先创建订单",!1)},addTestResult(t,s,e){this.testResults.unshift({title:t,message:s,success:e,time:(new Date).toLocaleTimeString()}),this.testResults.length>10&&this.testResults.pop()},formatDate(t){if(!t)return"无";return new Date(t).toLocaleString("zh-CN")}}},[["render",function(t,s,e,R,T,v){const y=_,V=i,w=m;return c(),a(V,{class:"test-page"},{default:l((()=>[r(V,{class:"test-header"},{default:l((()=>[r(y,{class:"test-title"},{default:l((()=>[d("VIP完整功能测试")])),_:1})])),_:1}),r(V,{class:"test-content"},{default:l((()=>[r(V,{class:"status-section"},{default:l((()=>[r(y,{class:"section-title"},{default:l((()=>[d("当前VIP状态")])),_:1}),T.vipStatus?(c(),a(V,{key:0,class:"status-card"},{default:l((()=>[r(V,{class:"status-item"},{default:l((()=>[r(y,{class:"label"},{default:l((()=>[d("用户角色：")])),_:1}),r(y,{class:u(["value",2===T.vipStatus.userRole?"vip":"normal"])},{default:l((()=>[d(o(T.vipStatus.userRoleName),1)])),_:1},8,["class"])])),_:1}),r(V,{class:"status-item"},{default:l((()=>[r(y,{class:"label"},{default:l((()=>[d("VIP状态：")])),_:1}),r(y,{class:u(["value",T.vipStatus.isVip?"active":"inactive"])},{default:l((()=>[d(o(T.vipStatus.isVip?"已开通":"未开通"),1)])),_:1},8,["class"])])),_:1}),T.vipStatus.vipExpireTime?(c(),a(V,{key:0,class:"status-item"},{default:l((()=>[r(y,{class:"label"},{default:l((()=>[d("过期时间：")])),_:1}),r(y,{class:"value"},{default:l((()=>[d(o(v.formatDate(T.vipStatus.vipExpireTime)),1)])),_:1})])),_:1})):n("",!0)])),_:1})):n("",!0),r(w,{class:"test-button",onClick:v.checkVipStatus},{default:l((()=>[d("刷新VIP状态")])),_:1},8,["onClick"])])),_:1}),r(V,{class:"test-section"},{default:l((()=>[r(y,{class:"section-title"},{default:l((()=>[d("功能测试")])),_:1}),r(w,{class:"test-button primary",onClick:v.testCompleteFlow},{default:l((()=>[d("🎯 测试完整VIP购买流程")])),_:1},8,["onClick"]),r(w,{class:"test-button secondary",onClick:v.testVipRecharge},{default:l((()=>[d("💎 测试VIP充值页面")])),_:1},8,["onClick"]),r(w,{class:"test-button",onClick:v.testCreateOrder},{default:l((()=>[d("📝 测试创建订单")])),_:1},8,["onClick"]),r(w,{class:"test-button",onClick:v.testPayment},{default:l((()=>[d("💳 测试支付流程")])),_:1},8,["onClick"])])),_:1}),T.testResults.length>0?(c(),a(V,{key:0,class:"result-section"},{default:l((()=>[r(y,{class:"section-title"},{default:l((()=>[d("测试结果")])),_:1}),r(V,{class:"result-list"},{default:l((()=>[(c(!0),h(f,null,p(T.testResults,((t,s)=>(c(),a(V,{key:s,class:u(["result-item",t.success?"success":"error"])},{default:l((()=>[r(y,{class:"result-title"},{default:l((()=>[d(o(t.title),1)])),_:2},1024),r(y,{class:"result-message"},{default:l((()=>[d(o(t.message),1)])),_:2},1024),r(y,{class:"result-time"},{default:l((()=>[d(o(t.time),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})])),_:1})):n("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-63acd3e3"]]);export{V as default};
