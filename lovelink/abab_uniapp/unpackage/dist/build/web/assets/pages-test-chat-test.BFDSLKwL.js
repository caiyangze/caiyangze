import{_ as t,a,d as e,w as s,i as n,f as c,h as l,j as o,t as i,g as u,p as d,q as f,K as r,M as g,v as m}from"./index-BpPI9udZ.js";import{getMutualFollowList as _,canChat as v}from"./api-chat.BF5K77Hj.js";import{w as C}from"./websocket.DvBY1wJ6.js";const h=t({__name:"chat-test",setup(t){const h=a("等待测试...\n"),p=a("");function y(t){h.value+=(new Date).toLocaleTimeString()+": "+t+"\n"}async function k(){try{y("开始测试获取好友列表...");const t=await _();y("API响应: "+JSON.stringify(t,null,2))}catch(t){y("测试失败: "+t.message)}}async function b(){try{y("开始测试canChat接口（默认用户ID: 1）...");const t=await v(1);y("canChat响应: "+JSON.stringify(t,null,2)),200===t.code?!0===t.data?y("✅ 可以与用户1聊天（互相关注）"):y("❌ 不能与用户1聊天（未互相关注）"):y("❌ 检查失败: "+t.message)}catch(t){y("测试失败: "+t.message)}}async function S(){if(p.value)try{y(`开始测试canChat接口（用户ID: ${p.value}）...`);const t=await v(p.value);y("canChat响应: "+JSON.stringify(t,null,2)),200===t.code?!0===t.data?y(`✅ 可以与用户${p.value}聊天（互相关注）`):y(`❌ 不能与用户${p.value}聊天（未互相关注）`):y("❌ 检查失败: "+t.message)}catch(t){y("测试失败: "+t.message)}else y("❌ 请输入目标用户ID")}async function w(){try{y("开始测试WebSocket连接...");const t=u("token");if(!t)return void y("错误: 未找到token，请先登录");await C.connect(t),y("WebSocket连接成功"),C.onMessage("CONNECTED",(t=>{y("收到连接确认: "+JSON.stringify(t))})),C.onMessage("HEARTBEAT",(t=>{y("收到心跳响应: "+JSON.stringify(t))}))}catch(t){y("WebSocket连接失败: "+t.message)}}function I(){try{if(y("开始测试发送消息..."),!C.getConnectionStatus().isConnected)return void y("错误: WebSocket未连接");y(C.sendChatMessage(1,"这是一条测试消息",1)?"消息发送成功":"消息发送失败")}catch(t){y("发送消息失败: "+t.message)}}function N(){d({url:"/pages/message/message"})}function D(){d({url:"/pages/message/chat?conversationId=new&userId=1&name=测试用户&avatar=/static/message/default-avatar.png"})}return(t,a)=>{const u=f,d=n,_=r,v=g,C=m;return c(),e(d,{class:"test-page"},{default:s((()=>[l(d,{class:"header"},{default:s((()=>[l(u,{class:"title"},{default:s((()=>[o("聊天功能测试")])),_:1})])),_:1}),l(d,{class:"test-section"},{default:s((()=>[l(u,{class:"section-title"},{default:s((()=>[o("API测试")])),_:1}),l(_,{onClick:k,class:"test-btn"},{default:s((()=>[o("测试获取好友列表")])),_:1}),l(_,{onClick:b,class:"test-btn"},{default:s((()=>[o("测试canChat接口")])),_:1}),l(_,{onClick:w,class:"test-btn"},{default:s((()=>[o("测试WebSocket连接")])),_:1}),l(_,{onClick:I,class:"test-btn"},{default:s((()=>[o("测试发送消息")])),_:1})])),_:1}),l(d,{class:"test-section"},{default:s((()=>[l(u,{class:"section-title"},{default:s((()=>[o("canChat测试")])),_:1}),l(v,{class:"test-input",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=t=>p.value=t),placeholder:"输入目标用户ID",type:"number"},null,8,["modelValue"]),l(_,{onClick:S,class:"test-btn"},{default:s((()=>[o("测试指定用户")])),_:1})])),_:1}),l(d,{class:"result-section"},{default:s((()=>[l(u,{class:"section-title"},{default:s((()=>[o("测试结果")])),_:1}),l(C,{class:"result-content","scroll-y":""},{default:s((()=>[l(u,{class:"result-text"},{default:s((()=>[o(i(h.value),1)])),_:1})])),_:1})])),_:1}),l(d,{class:"navigation"},{default:s((()=>[l(_,{onClick:N,class:"nav-btn"},{default:s((()=>[o("进入消息页面")])),_:1}),l(_,{onClick:D,class:"nav-btn"},{default:s((()=>[o("进入聊天页面")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-19e174d3"]]);export{h as default};
