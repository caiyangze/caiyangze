import{_ as e,r as a,a as l,G as s,d as o,w as t,i as n,f as i,h as c,j as d,k as r,A as u,t as p,s as f,p as g,I as m,q as _,u as h,M as v,K as w}from"./index-BpPI9udZ.js";import{_ as y}from"./logo.BZddfDCa.js";import{sendRegisterCode as x,verifyCode as k}from"./api-user-auth.CC_RESsW.js";const b=e({__name:"register",setup(e){const b=a({phone:"",password:"",confirmPassword:"",code:""}),V=a({bg:!1,logo:!1}),I=l(!1),$=l(!1),C=l(!1),j=l(60);let A=null;async function U(){if(!C.value&&!$.value)if(b.phone)if(/^1[3-9]\d{9}$/.test(b.phone))try{$.value=!0;const e=await x(b.phone);C.value=!0,j.value=60,A=setInterval((()=>{j.value--,j.value<=0&&(clearInterval(A),C.value=!1)}),1e3),f({title:e.message||"验证码发送成功",icon:"success"})}catch(e){console.error("发送验证码失败:",e)}finally{$.value=!1}else f({title:"手机号格式不正确",icon:"none"});else f({title:"请输入手机号",icon:"none"})}async function P(){if(b.phone)if(b.password)if(b.password.length<6)f({title:"密码长度不能少于6位",icon:"none"});else if(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/.test(b.password))if(b.password===b.confirmPassword)if(b.code)if(/^1[3-9]\d{9}$/.test(b.phone)){I.value=!0;try{const e=await k(b.phone,b.code,b.password);console.log("验证码验证完整响应:",e);let a="";if(e&&e.data&&(a=e.data.id||e.data.userId||e.data.user_id||"",a||"string"!=typeof e.data||""===e.data.trim()||(a=e.data),!a&&Array.isArray(e.data)&&e.data.length>0)){const l=e.data[0];l&&"object"==typeof l&&(a=l.id||l.userId||l.user_id||"")}console.log("提取的用户ID:",a),g({url:`/pages/register/user-info?phone=${b.phone}&password=${encodeURIComponent(b.password)}&userId=${a}`,success:()=>{console.log("成功跳转到用户信息页面")},fail:e=>{console.error("跳转失败:",e),f({title:"跳转失败，请稍后重试",icon:"none"})}})}catch(e){console.error("验证码验证失败:",e)}finally{I.value=!1}}else f({title:"手机号格式不正确",icon:"none"});else f({title:"请输入验证码",icon:"none"});else f({title:"两次输入的密码不一致",icon:"none"});else f({title:"密码必须包含英文和数字",icon:"none"});else f({title:"请设置密码",icon:"none"});else f({title:"请输入手机号",icon:"none"})}function z(){m({url:"/pages/login/login",fail:e=>{console.error("跳转到登录页面失败:",e),f({title:"跳转失败，请稍后重试",icon:"none"})}})}function D(e){f({title:("user"===e?"用户协议":"隐私政策")+"查看功能开发中",icon:"none"})}return s((()=>{A&&clearInterval(A)})),(e,a)=>{const l=n,s=_,f=h,g=v,m=w;return i(),o(l,{class:"register-page"},{default:t((()=>[c(l,{class:"bg-layer"},{default:t((()=>[c(l,{class:"bg-gradient"}),c(l,{class:"overlay-gradient"})])),_:1}),c(l,{class:"content-container"},{default:t((()=>[c(l,{class:"header"},{default:t((()=>[c(f,{class:"logo",src:y,mode:"aspectFit",onError:a[0]||(a[0]=e=>{V["logo"]=!0})},{default:t((()=>[V.logo?(i(),o(l,{key:0,class:"logo-placeholder"},{default:t((()=>[c(s,{class:"logo-text"},{default:t((()=>[d("缘来如此")])),_:1})])),_:1})):r("",!0)])),_:1}),c(l,{class:"slogan"},{default:t((()=>[d("遇见美好，从心开始")])),_:1})])),_:1}),c(l,{class:"register-card"},{default:t((()=>[c(l,{class:"form-title"},{default:t((()=>[d("手机号注册")])),_:1}),c(l,{class:"form-container"},{default:t((()=>[c(l,{class:"input-group"},{default:t((()=>[c(l,{class:"input-prefix"},{default:t((()=>[c(s,{class:"prefix-icon phone-icon"},{default:t((()=>[d("+86")])),_:1})])),_:1}),c(g,{class:"input-field",type:"number",modelValue:b.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>b.phone=e),placeholder:"请输入手机号",maxlength:"11"},null,8,["modelValue"])])),_:1}),c(l,{class:"input-group"},{default:t((()=>[c(l,{class:"input-prefix"},{default:t((()=>[c(s,{class:"prefix-icon lock-icon"})])),_:1}),c(g,{class:"input-field",type:"password",modelValue:b.password,"onUpdate:modelValue":a[2]||(a[2]=e=>b.password=e),placeholder:"请设置密码",password:""},null,8,["modelValue"])])),_:1}),c(l,{class:"input-group"},{default:t((()=>[c(l,{class:"input-prefix"},{default:t((()=>[c(s,{class:"prefix-icon lock-icon"})])),_:1}),c(g,{class:"input-field",type:"password",modelValue:b.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>b.confirmPassword=e),placeholder:"请确认密码",password:""},null,8,["modelValue"])])),_:1}),c(l,{class:"input-group"},{default:t((()=>[c(l,{class:"input-prefix"},{default:t((()=>[c(s,{class:"prefix-icon code-icon"})])),_:1}),c(g,{class:"input-field",type:"number",modelValue:b.code,"onUpdate:modelValue":a[4]||(a[4]=e=>b.code=e),placeholder:"请输入验证码",maxlength:"6"},null,8,["modelValue"]),c(l,{class:"input-suffix"},{default:t((()=>[c(s,{class:u(["code-btn",{disabled:C.value}]),onClick:U},{default:t((()=>[d(p(C.value?`${j.value}s后重新获取`:"获取验证码"),1)])),_:1},8,["class"])])),_:1})])),_:1}),c(m,{class:u(["submit-btn",{loading:I.value}]),onClick:P,disabled:I.value},{default:t((()=>[I.value?(i(),o(l,{key:1,class:"btn-loading"})):(i(),o(s,{key:0},{default:t((()=>[d("下一步")])),_:1}))])),_:1},8,["class","disabled"])])),_:1}),c(l,{class:"login-link"},{default:t((()=>[d(" 已有账号？"),c(s,{class:"link-text",onClick:z},{default:t((()=>[d("立即登录")])),_:1})])),_:1})])),_:1}),c(l,{class:"agreement"},{default:t((()=>[c(s,{class:"agreement-text"},{default:t((()=>[d("注册即表示您已同意")])),_:1}),c(s,{class:"agreement-link",onClick:a[5]||(a[5]=e=>D("user"))},{default:t((()=>[d("《用户协议》")])),_:1}),c(s,{class:"agreement-text"},{default:t((()=>[d("和")])),_:1}),c(s,{class:"agreement-link",onClick:a[6]||(a[6]=e=>D("privacy"))},{default:t((()=>[d("《隐私政策》")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-4c7ab9ea"]]);export{b as default};
