import{_ as a,z as e,s as t,c as s,d as l,w as n,v as o,f as c,h as i,j as r,A as d,t as u,l as h,m as f,F as m,k as p,q as g,i as w,K as _,L as y,M as k}from"./index-BpPI9udZ.js";import{g as b,a as P,b as C,r as I,w as T,f as A}from"./wallet.j0ZDQvx-.js";const M=a({name:"Wallet",data:()=>({walletInfo:{},walletStatus:1,transactions:[],loading:!1,refreshing:!1,currentPage:1,pageSize:20,hasMore:!0,typeIndex:0,typeOptions:["å…¨éƒ¨","å……å€¼","æ¶ˆè´¹","æ”¶å…¥","æç°","é€€æ¬¾"],rechargePackages:[],selectedPackage:-1,selectedPayment:0,paymentMethods:[{id:1,name:"æ”¯ä»˜å®"},{id:2,name:"å¾®ä¿¡æ”¯ä»˜"},{id:3,name:"é“¶è¡Œå¡"}],withdrawForm:{amount:"",account:"",name:""},withdrawTypeIndex:0,withdrawTypes:["æ”¯ä»˜å®","å¾®ä¿¡æ”¯ä»˜","é“¶è¡Œå¡"]}),onLoad(){this.initData()},onPullDownRefresh(){this.refreshData()},methods:{async initData(){await this.loadWalletInfo(),await this.loadTransactions(),this.loadRechargePackages()},async refreshData(){this.currentPage=1,this.transactions=[],this.hasMore=!0,await this.initData(),e(),this.refreshing=!1},async onRefresh(){this.refreshing=!0,await this.refreshData()},async loadWalletInfo(){try{const a=await b();200===a.code&&(this.walletInfo=a.data,this.walletStatus=a.data.walletStatus)}catch(a){console.error("è·å–é’±åŒ…ä¿¡æ¯å¤±è´¥:",a),t({title:"è·å–é’±åŒ…ä¿¡æ¯å¤±è´¥",icon:"none"})}},async loadTransactions(){if(!this.loading&&this.hasMore){this.loading=!0;try{const a=0===this.typeIndex?null:this.typeIndex;console.log("æ­£åœ¨åŠ è½½äº¤æ˜“è®°å½•...",{page:this.currentPage,type:a});const e=await P(this.currentPage,this.pageSize,a);if(console.log("äº¤æ˜“è®°å½•APIå“åº”:",e),200===e.code){const a=e.data.records||[];console.log("è·å–åˆ°äº¤æ˜“è®°å½•:",a.length,"æ¡"),1===this.currentPage?this.transactions=a:this.transactions.push(...a),this.hasMore=a.length===this.pageSize,this.currentPage++}else console.warn("äº¤æ˜“è®°å½•APIè¿”å›é”™è¯¯:",e.message),t({title:e.message||"è·å–äº¤æ˜“è®°å½•å¤±è´¥",icon:"none"})}catch(a){console.error("è·å–äº¤æ˜“è®°å½•å¤±è´¥:",a),t({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•",icon:"none"})}finally{this.loading=!1}}},loadMoreTransactions(){this.loadTransactions()},loadRechargePackages(){this.rechargePackages=C()},onTypeChange(a){this.typeIndex=a.detail.value,this.currentPage=1,this.transactions=[],this.hasMore=!0,this.loadTransactions()},showRechargeModal(){this.$refs.rechargePopup.open()},hideRechargeModal(){this.$refs.rechargePopup.close(),this.selectedPackage=-1},showWithdrawModal(){this.walletInfo.cashBalance<=0?t({title:"ç°é‡‘ä½™é¢ä¸è¶³",icon:"none"}):this.$refs.withdrawPopup.open()},hideWithdrawModal(){this.$refs.withdrawPopup.close(),this.withdrawForm={amount:"",account:"",name:""}},selectPackage(a){this.selectedPackage=a},selectPayment(a){this.selectedPayment=a},async confirmRecharge(){if(-1===this.selectedPackage)return void t({title:"è¯·é€‰æ‹©å……å€¼å¥—é¤",icon:"none"});const a=this.rechargePackages[this.selectedPackage],e=this.paymentMethods[this.selectedPayment];try{const s=await I({coinAmount:a.coinAmount+(a.bonus||0),transactionDesc:`å……å€¼${a.coinAmount}è™šæ‹Ÿå¸`,paymentMethod:e.id});200===s.code?(t({title:"å……å€¼æˆåŠŸ",icon:"success"}),this.hideRechargeModal(),this.refreshData()):t({title:s.message||"å……å€¼å¤±è´¥",icon:"none"})}catch(s){console.error("å……å€¼å¤±è´¥:",s),t({title:"å……å€¼å¤±è´¥",icon:"none"})}},onWithdrawTypeChange(a){this.withdrawTypeIndex=a.detail.value},async confirmWithdraw(){const{amount:a,account:e,name:s}=this.withdrawForm;if(!a||a<10)t({title:"æç°é‡‘é¢ä¸èƒ½å°‘äº10å…ƒ",icon:"none"});else if(e&&s)if(parseFloat(a)>parseFloat(this.walletInfo.cashBalance))t({title:"æç°é‡‘é¢ä¸èƒ½è¶…è¿‡ä½™é¢",icon:"none"});else try{const l=await T({transactionAmount:parseFloat(a),withdrawAccount:e,withdrawAccountType:this.withdrawTypeIndex+1,withdrawAccountName:s,transactionDesc:"ç°é‡‘æç°"});200===l.code?(t({title:"æç°ç”³è¯·æˆåŠŸ",icon:"success"}),this.hideWithdrawModal(),this.refreshData()):t({title:l.message||"æç°ç”³è¯·å¤±è´¥",icon:"none"})}catch(l){console.error("æç°ç”³è¯·å¤±è´¥:",l),t({title:"æç°ç”³è¯·å¤±è´¥",icon:"none"})}else t({title:"è¯·å¡«å†™å®Œæ•´çš„è´¦æˆ·ä¿¡æ¯",icon:"none"})},formatAmount:a=>A(a,"å…ƒ").replace("å…ƒ",""),formatTime(a){if(!a)return"";const e=new Date(a);return`${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`},getAmountClass:a=>1===a||3===a?"amount-positive":"amount-negative",getAmountText(a){const e=1===a.transactionType||3===a.transactionType?"+":"-";return a.coinAmount?`${e}${a.coinAmount}å¸`:a.transactionAmount?`${e}Â¥${this.formatAmount(a.transactionAmount)}`:""}}},[["render",function(a,e,t,b,P,C){const I=g,T=w,A=_,M=y,v=s("uni-popup"),x=k,D=o;return c(),l(D,{"scroll-y":"",class:"wallet-page","refresher-enabled":"",onRefresherrefresh:C.onRefresh,"refresher-triggered":P.refreshing},{default:n((()=>[i(T,{class:"wallet-container"},{default:n((()=>[i(T,{class:"balance-card"},{default:n((()=>[i(T,{class:"balance-header"},{default:n((()=>[i(I,{class:"balance-title"},{default:n((()=>[r("æˆ‘çš„é’±åŒ…")])),_:1}),i(I,{class:d(["balance-status",1===P.walletStatus?"status-normal":"status-frozen"])},{default:n((()=>[r(u(1===P.walletStatus?"æ­£å¸¸":"å†»ç»“"),1)])),_:1},8,["class"])])),_:1}),i(T,{class:"balance-content"},{default:n((()=>[i(T,{class:"balance-item"},{default:n((()=>[i(I,{class:"balance-label"},{default:n((()=>[r("è™šæ‹Ÿå¸ä½™é¢")])),_:1}),i(I,{class:"balance-value coin"},{default:n((()=>[r(u(P.walletInfo.coinBalance||0)+"å¸",1)])),_:1})])),_:1}),i(T,{class:"balance-item"},{default:n((()=>[i(I,{class:"balance-label"},{default:n((()=>[r("ç°é‡‘ä½™é¢")])),_:1}),i(I,{class:"balance-value cash"},{default:n((()=>[r("Â¥"+u(C.formatAmount(P.walletInfo.cashBalance)),1)])),_:1})])),_:1})])),_:1}),i(T,{class:"balance-actions"},{default:n((()=>[i(A,{class:"action-btn recharge-btn",onClick:C.showRechargeModal},{default:n((()=>[r("å……å€¼")])),_:1},8,["onClick"]),i(A,{class:"action-btn withdraw-btn",onClick:C.showWithdrawModal},{default:n((()=>[r("æç°")])),_:1},8,["onClick"])])),_:1})])),_:1}),i(T,{class:"stats-card"},{default:n((()=>[i(T,{class:"stats-title"},{default:n((()=>[r("ç»Ÿè®¡ä¿¡æ¯")])),_:1}),i(T,{class:"stats-grid"},{default:n((()=>[i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r(u(P.walletInfo.totalRecharge||0),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("ç´¯è®¡å……å€¼")])),_:1})])),_:1}),i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r(u(P.walletInfo.totalConsume||0),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("ç´¯è®¡æ¶ˆè´¹")])),_:1})])),_:1}),i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r("Â¥"+u(C.formatAmount(P.walletInfo.totalIncome)),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("ç´¯è®¡æ”¶å…¥")])),_:1})])),_:1}),i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r("Â¥"+u(C.formatAmount(P.walletInfo.totalWithdraw)),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("ç´¯è®¡æç°")])),_:1})])),_:1})])),_:1})])),_:1}),i(T,{class:"transactions-card"},{default:n((()=>[i(T,{class:"transactions-header"},{default:n((()=>[i(I,{class:"transactions-title"},{default:n((()=>[r("äº¤æ˜“è®°å½•")])),_:1}),i(M,{onChange:C.onTypeChange,value:P.typeIndex,range:P.typeOptions},{default:n((()=>[i(T,{class:"filter-btn"},{default:n((()=>[r(u(P.typeOptions[P.typeIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),i(T,{class:"transactions-list"},{default:n((()=>[(c(!0),h(m,null,f(P.transactions,((a,e)=>(c(),l(T,{key:e,class:"transaction-item"},{default:n((()=>[i(T,{class:"transaction-info"},{default:n((()=>[i(I,{class:"transaction-desc"},{default:n((()=>[r(u(a.transactionDesc),1)])),_:2},1024),i(I,{class:"transaction-time"},{default:n((()=>[r(u(C.formatTime(a.createdAt)),1)])),_:2},1024)])),_:2},1024),i(T,{class:d(["transaction-amount",C.getAmountClass(a.transactionType)])},{default:n((()=>[r(u(C.getAmountText(a)),1)])),_:2},1032,["class"])])),_:2},1024)))),128)),0!==P.transactions.length||P.loading?p("",!0):(c(),l(T,{key:0,class:"empty-state"},{default:n((()=>[i(I,{class:"empty-icon"},{default:n((()=>[r("ğŸ“")])),_:1}),i(I,{class:"empty-text"},{default:n((()=>[r("æš‚æ— äº¤æ˜“è®°å½•")])),_:1}),i(I,{class:"empty-desc"},{default:n((()=>[r("æ‚¨è¿˜æ²¡æœ‰ä»»ä½•äº¤æ˜“è®°å½•")])),_:1}),i(A,{class:"retry-btn",onClick:C.refreshData},{default:n((()=>[r("åˆ·æ–°")])),_:1},8,["onClick"])])),_:1})),P.loading?(c(),l(T,{key:1,class:"loading-state"},{default:n((()=>[i(I,null,{default:n((()=>[r("åŠ è½½ä¸­...")])),_:1})])),_:1})):p("",!0),P.hasMore&&P.transactions.length>0?(c(),l(T,{key:2,class:"load-more",onClick:C.loadMoreTransactions},{default:n((()=>[i(I,null,{default:n((()=>[r("ç‚¹å‡»åŠ è½½æ›´å¤š")])),_:1})])),_:1},8,["onClick"])):p("",!0)])),_:1})])),_:1}),i(v,{ref:"rechargePopup",type:"bottom"},{default:n((()=>[i(T,{class:"popup-content"},{default:n((()=>[i(T,{class:"popup-header"},{default:n((()=>[i(I,{class:"popup-title"},{default:n((()=>[r("è™šæ‹Ÿå¸å……å€¼")])),_:1}),i(I,{class:"popup-close",onClick:C.hideRechargeModal},{default:n((()=>[r("Ã—")])),_:1},8,["onClick"])])),_:1}),i(T,{class:"recharge-packages"},{default:n((()=>[(c(!0),h(m,null,f(P.rechargePackages,((a,e)=>(c(),l(T,{key:e,class:d(["package-item",P.selectedPackage===e?"selected":""]),onClick:a=>C.selectPackage(e)},{default:n((()=>[i(I,{class:"package-amount"},{default:n((()=>[r(u(a.coinAmount)+"å¸",1)])),_:2},1024),i(I,{class:"package-price"},{default:n((()=>[r("Â¥"+u(a.price),1)])),_:2},1024),a.bonus>0?(c(),l(I,{key:0,class:"package-bonus"},{default:n((()=>[r("+"+u(a.bonus)+"èµ é€",1)])),_:2},1024)):p("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),i(T,{class:"payment-methods"},{default:n((()=>[i(I,{class:"section-title"},{default:n((()=>[r("æ”¯ä»˜æ–¹å¼")])),_:1}),i(T,{class:"payment-options"},{default:n((()=>[(c(!0),h(m,null,f(P.paymentMethods,((a,e)=>(c(),l(T,{key:e,class:d(["payment-item",P.selectedPayment===e?"selected":""]),onClick:a=>C.selectPayment(e)},{default:n((()=>[i(I,{class:"payment-name"},{default:n((()=>[r(u(a.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),i(A,{class:"confirm-btn",onClick:C.confirmRecharge,disabled:-1===P.selectedPackage},{default:n((()=>[r(" ç¡®è®¤å……å€¼ ")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},512),i(v,{ref:"withdrawPopup",type:"bottom"},{default:n((()=>[i(T,{class:"popup-content"},{default:n((()=>[i(T,{class:"popup-header"},{default:n((()=>[i(I,{class:"popup-title"},{default:n((()=>[r("ç°é‡‘æç°")])),_:1}),i(I,{class:"popup-close",onClick:C.hideWithdrawModal},{default:n((()=>[r("Ã—")])),_:1},8,["onClick"])])),_:1}),i(T,{class:"withdraw-form"},{default:n((()=>[i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("æç°é‡‘é¢")])),_:1}),i(x,{class:"form-input",type:"number",modelValue:P.withdrawForm.amount,"onUpdate:modelValue":e[0]||(e[0]=a=>P.withdrawForm.amount=a),placeholder:"æœ€å°‘10å…ƒ"},null,8,["modelValue"])])),_:1}),i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("æç°æ–¹å¼")])),_:1}),i(M,{onChange:C.onWithdrawTypeChange,value:P.withdrawTypeIndex,range:P.withdrawTypes},{default:n((()=>[i(T,{class:"form-picker"},{default:n((()=>[r(u(P.withdrawTypes[P.withdrawTypeIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("è´¦æˆ·ä¿¡æ¯")])),_:1}),i(x,{class:"form-input",modelValue:P.withdrawForm.account,"onUpdate:modelValue":e[1]||(e[1]=a=>P.withdrawForm.account=a),placeholder:"è¯·è¾“å…¥è´¦æˆ·å·ç "},null,8,["modelValue"])])),_:1}),i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("è´¦æˆ·å§“å")])),_:1}),i(x,{class:"form-input",modelValue:P.withdrawForm.name,"onUpdate:modelValue":e[2]||(e[2]=a=>P.withdrawForm.name=a),placeholder:"è¯·è¾“å…¥è´¦æˆ·å§“å"},null,8,["modelValue"])])),_:1})])),_:1}),i(A,{class:"confirm-btn",onClick:C.confirmWithdraw},{default:n((()=>[r(" ç”³è¯·æç° ")])),_:1},8,["onClick"])])),_:1})])),_:1},512)])),_:1})])),_:1},8,["onRefresherrefresh","refresher-triggered"])}],["__scopeId","data-v-e9840f87"]]);export{M as default};
