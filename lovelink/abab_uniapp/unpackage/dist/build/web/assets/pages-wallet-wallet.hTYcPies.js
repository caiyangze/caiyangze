import{_ as a,z as e,s as t,c as s,d as l,w as n,v as o,f as c,h as i,j as r,A as d,t as u,l as h,m as f,F as m,k as p,q as g,i as w,K as _,L as y,M as k}from"./index-BpPI9udZ.js";import{g as b,a as P,b as C,r as I,w as T,f as A}from"./wallet.j0ZDQvx-.js";const M=a({name:"Wallet",data:()=>({walletInfo:{},walletStatus:1,transactions:[],loading:!1,refreshing:!1,currentPage:1,pageSize:20,hasMore:!0,typeIndex:0,typeOptions:["全部","充值","消费","收入","提现","退款"],rechargePackages:[],selectedPackage:-1,selectedPayment:0,paymentMethods:[{id:1,name:"支付宝"},{id:2,name:"微信支付"},{id:3,name:"银行卡"}],withdrawForm:{amount:"",account:"",name:""},withdrawTypeIndex:0,withdrawTypes:["支付宝","微信支付","银行卡"]}),onLoad(){this.initData()},onPullDownRefresh(){this.refreshData()},methods:{async initData(){await this.loadWalletInfo(),await this.loadTransactions(),this.loadRechargePackages()},async refreshData(){this.currentPage=1,this.transactions=[],this.hasMore=!0,await this.initData(),e(),this.refreshing=!1},async onRefresh(){this.refreshing=!0,await this.refreshData()},async loadWalletInfo(){try{const a=await b();200===a.code&&(this.walletInfo=a.data,this.walletStatus=a.data.walletStatus)}catch(a){console.error("获取钱包信息失败:",a),t({title:"获取钱包信息失败",icon:"none"})}},async loadTransactions(){if(!this.loading&&this.hasMore){this.loading=!0;try{const a=0===this.typeIndex?null:this.typeIndex;console.log("正在加载交易记录...",{page:this.currentPage,type:a});const e=await P(this.currentPage,this.pageSize,a);if(console.log("交易记录API响应:",e),200===e.code){const a=e.data.records||[];console.log("获取到交易记录:",a.length,"条"),1===this.currentPage?this.transactions=a:this.transactions.push(...a),this.hasMore=a.length===this.pageSize,this.currentPage++}else console.warn("交易记录API返回错误:",e.message),t({title:e.message||"获取交易记录失败",icon:"none"})}catch(a){console.error("获取交易记录失败:",a),t({title:"网络错误，请稍后重试",icon:"none"})}finally{this.loading=!1}}},loadMoreTransactions(){this.loadTransactions()},loadRechargePackages(){this.rechargePackages=C()},onTypeChange(a){this.typeIndex=a.detail.value,this.currentPage=1,this.transactions=[],this.hasMore=!0,this.loadTransactions()},showRechargeModal(){this.$refs.rechargePopup.open()},hideRechargeModal(){this.$refs.rechargePopup.close(),this.selectedPackage=-1},showWithdrawModal(){this.walletInfo.cashBalance<=0?t({title:"现金余额不足",icon:"none"}):this.$refs.withdrawPopup.open()},hideWithdrawModal(){this.$refs.withdrawPopup.close(),this.withdrawForm={amount:"",account:"",name:""}},selectPackage(a){this.selectedPackage=a},selectPayment(a){this.selectedPayment=a},async confirmRecharge(){if(-1===this.selectedPackage)return void t({title:"请选择充值套餐",icon:"none"});const a=this.rechargePackages[this.selectedPackage],e=this.paymentMethods[this.selectedPayment];try{const s=await I({coinAmount:a.coinAmount+(a.bonus||0),transactionDesc:`充值${a.coinAmount}虚拟币`,paymentMethod:e.id});200===s.code?(t({title:"充值成功",icon:"success"}),this.hideRechargeModal(),this.refreshData()):t({title:s.message||"充值失败",icon:"none"})}catch(s){console.error("充值失败:",s),t({title:"充值失败",icon:"none"})}},onWithdrawTypeChange(a){this.withdrawTypeIndex=a.detail.value},async confirmWithdraw(){const{amount:a,account:e,name:s}=this.withdrawForm;if(!a||a<10)t({title:"提现金额不能少于10元",icon:"none"});else if(e&&s)if(parseFloat(a)>parseFloat(this.walletInfo.cashBalance))t({title:"提现金额不能超过余额",icon:"none"});else try{const l=await T({transactionAmount:parseFloat(a),withdrawAccount:e,withdrawAccountType:this.withdrawTypeIndex+1,withdrawAccountName:s,transactionDesc:"现金提现"});200===l.code?(t({title:"提现申请成功",icon:"success"}),this.hideWithdrawModal(),this.refreshData()):t({title:l.message||"提现申请失败",icon:"none"})}catch(l){console.error("提现申请失败:",l),t({title:"提现申请失败",icon:"none"})}else t({title:"请填写完整的账户信息",icon:"none"})},formatAmount:a=>A(a,"元").replace("元",""),formatTime(a){if(!a)return"";const e=new Date(a);return`${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`},getAmountClass:a=>1===a||3===a?"amount-positive":"amount-negative",getAmountText(a){const e=1===a.transactionType||3===a.transactionType?"+":"-";return a.coinAmount?`${e}${a.coinAmount}币`:a.transactionAmount?`${e}¥${this.formatAmount(a.transactionAmount)}`:""}}},[["render",function(a,e,t,b,P,C){const I=g,T=w,A=_,M=y,v=s("uni-popup"),x=k,D=o;return c(),l(D,{"scroll-y":"",class:"wallet-page","refresher-enabled":"",onRefresherrefresh:C.onRefresh,"refresher-triggered":P.refreshing},{default:n((()=>[i(T,{class:"wallet-container"},{default:n((()=>[i(T,{class:"balance-card"},{default:n((()=>[i(T,{class:"balance-header"},{default:n((()=>[i(I,{class:"balance-title"},{default:n((()=>[r("我的钱包")])),_:1}),i(I,{class:d(["balance-status",1===P.walletStatus?"status-normal":"status-frozen"])},{default:n((()=>[r(u(1===P.walletStatus?"正常":"冻结"),1)])),_:1},8,["class"])])),_:1}),i(T,{class:"balance-content"},{default:n((()=>[i(T,{class:"balance-item"},{default:n((()=>[i(I,{class:"balance-label"},{default:n((()=>[r("虚拟币余额")])),_:1}),i(I,{class:"balance-value coin"},{default:n((()=>[r(u(P.walletInfo.coinBalance||0)+"币",1)])),_:1})])),_:1}),i(T,{class:"balance-item"},{default:n((()=>[i(I,{class:"balance-label"},{default:n((()=>[r("现金余额")])),_:1}),i(I,{class:"balance-value cash"},{default:n((()=>[r("¥"+u(C.formatAmount(P.walletInfo.cashBalance)),1)])),_:1})])),_:1})])),_:1}),i(T,{class:"balance-actions"},{default:n((()=>[i(A,{class:"action-btn recharge-btn",onClick:C.showRechargeModal},{default:n((()=>[r("充值")])),_:1},8,["onClick"]),i(A,{class:"action-btn withdraw-btn",onClick:C.showWithdrawModal},{default:n((()=>[r("提现")])),_:1},8,["onClick"])])),_:1})])),_:1}),i(T,{class:"stats-card"},{default:n((()=>[i(T,{class:"stats-title"},{default:n((()=>[r("统计信息")])),_:1}),i(T,{class:"stats-grid"},{default:n((()=>[i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r(u(P.walletInfo.totalRecharge||0),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("累计充值")])),_:1})])),_:1}),i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r(u(P.walletInfo.totalConsume||0),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("累计消费")])),_:1})])),_:1}),i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r("¥"+u(C.formatAmount(P.walletInfo.totalIncome)),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("累计收入")])),_:1})])),_:1}),i(T,{class:"stats-item"},{default:n((()=>[i(I,{class:"stats-value"},{default:n((()=>[r("¥"+u(C.formatAmount(P.walletInfo.totalWithdraw)),1)])),_:1}),i(I,{class:"stats-label"},{default:n((()=>[r("累计提现")])),_:1})])),_:1})])),_:1})])),_:1}),i(T,{class:"transactions-card"},{default:n((()=>[i(T,{class:"transactions-header"},{default:n((()=>[i(I,{class:"transactions-title"},{default:n((()=>[r("交易记录")])),_:1}),i(M,{onChange:C.onTypeChange,value:P.typeIndex,range:P.typeOptions},{default:n((()=>[i(T,{class:"filter-btn"},{default:n((()=>[r(u(P.typeOptions[P.typeIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),i(T,{class:"transactions-list"},{default:n((()=>[(c(!0),h(m,null,f(P.transactions,((a,e)=>(c(),l(T,{key:e,class:"transaction-item"},{default:n((()=>[i(T,{class:"transaction-info"},{default:n((()=>[i(I,{class:"transaction-desc"},{default:n((()=>[r(u(a.transactionDesc),1)])),_:2},1024),i(I,{class:"transaction-time"},{default:n((()=>[r(u(C.formatTime(a.createdAt)),1)])),_:2},1024)])),_:2},1024),i(T,{class:d(["transaction-amount",C.getAmountClass(a.transactionType)])},{default:n((()=>[r(u(C.getAmountText(a)),1)])),_:2},1032,["class"])])),_:2},1024)))),128)),0!==P.transactions.length||P.loading?p("",!0):(c(),l(T,{key:0,class:"empty-state"},{default:n((()=>[i(I,{class:"empty-icon"},{default:n((()=>[r("📝")])),_:1}),i(I,{class:"empty-text"},{default:n((()=>[r("暂无交易记录")])),_:1}),i(I,{class:"empty-desc"},{default:n((()=>[r("您还没有任何交易记录")])),_:1}),i(A,{class:"retry-btn",onClick:C.refreshData},{default:n((()=>[r("刷新")])),_:1},8,["onClick"])])),_:1})),P.loading?(c(),l(T,{key:1,class:"loading-state"},{default:n((()=>[i(I,null,{default:n((()=>[r("加载中...")])),_:1})])),_:1})):p("",!0),P.hasMore&&P.transactions.length>0?(c(),l(T,{key:2,class:"load-more",onClick:C.loadMoreTransactions},{default:n((()=>[i(I,null,{default:n((()=>[r("点击加载更多")])),_:1})])),_:1},8,["onClick"])):p("",!0)])),_:1})])),_:1}),i(v,{ref:"rechargePopup",type:"bottom"},{default:n((()=>[i(T,{class:"popup-content"},{default:n((()=>[i(T,{class:"popup-header"},{default:n((()=>[i(I,{class:"popup-title"},{default:n((()=>[r("虚拟币充值")])),_:1}),i(I,{class:"popup-close",onClick:C.hideRechargeModal},{default:n((()=>[r("×")])),_:1},8,["onClick"])])),_:1}),i(T,{class:"recharge-packages"},{default:n((()=>[(c(!0),h(m,null,f(P.rechargePackages,((a,e)=>(c(),l(T,{key:e,class:d(["package-item",P.selectedPackage===e?"selected":""]),onClick:a=>C.selectPackage(e)},{default:n((()=>[i(I,{class:"package-amount"},{default:n((()=>[r(u(a.coinAmount)+"币",1)])),_:2},1024),i(I,{class:"package-price"},{default:n((()=>[r("¥"+u(a.price),1)])),_:2},1024),a.bonus>0?(c(),l(I,{key:0,class:"package-bonus"},{default:n((()=>[r("+"+u(a.bonus)+"赠送",1)])),_:2},1024)):p("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),i(T,{class:"payment-methods"},{default:n((()=>[i(I,{class:"section-title"},{default:n((()=>[r("支付方式")])),_:1}),i(T,{class:"payment-options"},{default:n((()=>[(c(!0),h(m,null,f(P.paymentMethods,((a,e)=>(c(),l(T,{key:e,class:d(["payment-item",P.selectedPayment===e?"selected":""]),onClick:a=>C.selectPayment(e)},{default:n((()=>[i(I,{class:"payment-name"},{default:n((()=>[r(u(a.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),i(A,{class:"confirm-btn",onClick:C.confirmRecharge,disabled:-1===P.selectedPackage},{default:n((()=>[r(" 确认充值 ")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},512),i(v,{ref:"withdrawPopup",type:"bottom"},{default:n((()=>[i(T,{class:"popup-content"},{default:n((()=>[i(T,{class:"popup-header"},{default:n((()=>[i(I,{class:"popup-title"},{default:n((()=>[r("现金提现")])),_:1}),i(I,{class:"popup-close",onClick:C.hideWithdrawModal},{default:n((()=>[r("×")])),_:1},8,["onClick"])])),_:1}),i(T,{class:"withdraw-form"},{default:n((()=>[i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("提现金额")])),_:1}),i(x,{class:"form-input",type:"number",modelValue:P.withdrawForm.amount,"onUpdate:modelValue":e[0]||(e[0]=a=>P.withdrawForm.amount=a),placeholder:"最少10元"},null,8,["modelValue"])])),_:1}),i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("提现方式")])),_:1}),i(M,{onChange:C.onWithdrawTypeChange,value:P.withdrawTypeIndex,range:P.withdrawTypes},{default:n((()=>[i(T,{class:"form-picker"},{default:n((()=>[r(u(P.withdrawTypes[P.withdrawTypeIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("账户信息")])),_:1}),i(x,{class:"form-input",modelValue:P.withdrawForm.account,"onUpdate:modelValue":e[1]||(e[1]=a=>P.withdrawForm.account=a),placeholder:"请输入账户号码"},null,8,["modelValue"])])),_:1}),i(T,{class:"form-item"},{default:n((()=>[i(I,{class:"form-label"},{default:n((()=>[r("账户姓名")])),_:1}),i(x,{class:"form-input",modelValue:P.withdrawForm.name,"onUpdate:modelValue":e[2]||(e[2]=a=>P.withdrawForm.name=a),placeholder:"请输入账户姓名"},null,8,["modelValue"])])),_:1})])),_:1}),i(A,{class:"confirm-btn",onClick:C.confirmWithdraw},{default:n((()=>[r(" 申请提现 ")])),_:1},8,["onClick"])])),_:1})])),_:1},512)])),_:1})])),_:1},8,["onRefresherrefresh","refresher-triggered"])}],["__scopeId","data-v-e9840f87"]]);export{M as default};
