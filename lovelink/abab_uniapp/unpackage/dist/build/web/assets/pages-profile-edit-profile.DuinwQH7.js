import{N as e,U as l,g as a,_ as t,r as s,a as u,o,d as n,w as c,i,f as r,h as d,B as f,j as p,A as g,t as m,R as _,s as v,T as h,V as b,q as y,M as V,L as k,W as x,v as C,X as w,Q as U,I}from"./index-BpPI9udZ.js";const S={createProfile:l=>e.post("/profile/create",l),updateProfile:l=>e.put("/profile/update",l),getProfile:l=>e.get(`/profile/detail/${l}`),getMyProfile:()=>e.get("/profile/my"),uploadCertificate:t=>new Promise(((s,u)=>{l({url:e.baseUrl+"/upload/certificate",filePath:t,name:"file",header:{token:a("token")||""},success:e=>{try{const l=e.data;s(l)}catch(l){u(l)}},fail:e=>{u(e)}})}))},P=t({__name:"edit-profile",setup(e){const l=s({realName:"",age:"",height:"",weight:"",education:0,educationCert:"",company:"",position:"",incomeLevel:0,workCity:"",hometown:"",maritalStatus:0,hasChildren:0,houseStatus:0,carStatus:0,selfIntroduction:"",hobby:""}),a=u(!1),t=u(!1),P=["请选择","高中及以下","大专","本科","硕士","博士及以上"],L=u(0),N=["请选择","5千以下","5千-1万","1万-2万","2万-5万","5万以上"],R=u(0),T=["请选择","未婚","离异","丧偶"],j=u(0),M=["请选择","无子女","有子女不同住","有子女同住"],O=u(0),q=["请选择","无房","有房有贷款","有房无贷款","与父母同住"],z=u(0),A=["请选择","无车","有车有贷款","有车无贷款"],B=u(0);function F(e){L.value=e.detail.value,l.education=parseInt(e.detail.value)}function Q(e){R.value=e.detail.value,l.incomeLevel=parseInt(e.detail.value)}function W(e){j.value=e.detail.value,l.maritalStatus=parseInt(e.detail.value)}function X(e){O.value=e.detail.value,l.hasChildren=parseInt(e.detail.value)}function $(e){z.value=e.detail.value,l.houseStatus=parseInt(e.detail.value)}function D(e){B.value=e.detail.value,l.carStatus=parseInt(e.detail.value)}function E(){_({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{const a=e.tempFilePaths[0];var t;console.log("选择的证明图片路径:",a),t=a,h({title:"上传中..."}),S.uploadCertificate(t).then((e=>{if(b(),console.log("服务器返回的URL:",e),!e||-1===e.indexOf("http"))return console.error("服务器返回的URL格式不正确:",e),void v({title:"上传失败，请重试",icon:"none"});l.educationCert=e,console.log("设置证明URL成功:",l.educationCert),v({title:"上传成功",icon:"success"})})).catch((e=>{b(),console.error("上传失败:",e),v({title:"上传失败",icon:"none"})}))},fail:e=>{console.error("选择图片失败:",e),v({title:"选择图片失败",icon:"none"})}})}async function G(){if(function(){if(!l.realName)return H("请输入真实姓名"),!1;if(!l.age)return H("请输入年龄"),!1;if(!l.height)return H("请输入身高"),!1;if(!l.weight)return H("请输入体重"),!1;if(0===l.education)return H("请选择学历"),!1;if(0===l.incomeLevel)return H("请选择收入水平"),!1;if(!l.workCity)return H("请输入工作城市"),!1;if(0===l.maritalStatus)return H("请选择婚姻状况"),!1;if(0===l.hasChildren)return H("请选择有无子女"),!1;if(0===l.houseStatus)return H("请选择住房情况"),!1;if(0===l.carStatus)return H("请选择车辆情况"),!1;if(!l.selfIntroduction)return H("请填写个人介绍"),!1;return!0}()){t.value=!0;try{let e;e=a.value?await S.updateProfile(l):await S.createProfile(l),console.log("提交结果:",e),v({title:a.value?"修改成功":"提交成功",icon:"success",duration:2e3}),setTimeout((()=>{w()}),2e3)}catch(e){console.error("提交失败:",e),v({title:"提交失败，请重试",icon:"none"})}finally{t.value=!1}}}function H(e){v({title:e,icon:"none"})}function J(){console.log("点击返回按钮");const e=U();console.log("当前页面栈长度:",e.length),e.length>1?w({delta:1,success:function(){console.log("返回上一页成功")},fail:function(e){console.error("返回上一页失败:",e),K()}}):(console.log("没有上一页，跳转到我的页面"),K())}function K(){I({url:"/pages/mine/mine",success:function(){console.log("跳转到我的页面成功")},fail:function(e){console.error("跳转到我的页面失败:",e),I({url:"/pages/index/index"})}})}return o((async()=>{await async function(e){try{t.value=!0;const s=await S.getProfile(e);console.log("获取到的用户资料:",s),s&&s.data&&s.data.profile?(a.value=!0,Object.assign(l,s.data.profile),L.value=l.education||0,R.value=l.incomeLevel||0,j.value=l.maritalStatus||0,O.value=l.hasChildren||0,z.value=l.houseStatus||0,B.value=l.carStatus||0,console.log("数据回显成功，进入编辑模式")):(a.value=!1,console.log("未获取到资料数据，进入新增模式"))}catch(s){console.error("获取资料失败:",s),a.value=!1,console.log("获取资料失败，进入新增模式")}finally{t.value=!1}}(21)})),(e,s)=>{const u=i,o=y,_=V,v=k,h=x,b=C;return r(),n(u,{class:"edit-profile-page"},{default:c((()=>[d(u,{class:"bg-layer"},{default:c((()=>[d(u,{class:"bg-gradient"}),d(u,{class:"overlay-gradient"})])),_:1}),d(u,{class:"content-container"},{default:c((()=>[d(u,{class:"top-buttons"},{default:c((()=>[d(u,{class:"back-btn",onClick:f(J,["stop"])},{default:c((()=>[d(o,{class:"back-arrow"},{default:c((()=>[p("←")])),_:1})])),_:1}),d(u,{class:g(["save-btn-container",{disabled:t.value}]),onClick:f(G,["stop"])},{default:c((()=>[t.value?(r(),n(u,{key:1,class:"loading-icon"})):(r(),n(o,{key:0,class:"save-btn"},{default:c((()=>[p(m(a.value?"保存":"提交"),1)])),_:1}))])),_:1},8,["class"])])),_:1}),d(u,{class:"header"},{default:c((()=>[d(u,{class:"page-title"},{default:c((()=>[p("编辑资料")])),_:1}),d(u,{class:"slogan"},{default:c((()=>[p("完善资料，提高匹配度")])),_:1})])),_:1}),d(u,{class:"profile-form-card"},{default:c((()=>[d(b,{"scroll-y":"",class:"form-scroll-view"},{default:c((()=>[d(u,{class:"form-container"},{default:c((()=>[d(u,{class:"form-section"},{default:c((()=>[d(u,{class:"section-title"},{default:c((()=>[p("基本信息")])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("真实姓名")])),_:1}),d(_,{class:"input-field",type:"text",modelValue:l.realName,"onUpdate:modelValue":s[0]||(s[0]=e=>l.realName=e),placeholder:"请输入真实姓名",maxlength:"20"},null,8,["modelValue"])])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("年龄")])),_:1}),d(_,{class:"input-field",type:"number",modelValue:l.age,"onUpdate:modelValue":s[1]||(s[1]=e=>l.age=e),placeholder:"请输入年龄",maxlength:"3"},null,8,["modelValue"])])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("身高(cm)")])),_:1}),d(_,{class:"input-field",type:"number",modelValue:l.height,"onUpdate:modelValue":s[2]||(s[2]=e=>l.height=e),placeholder:"请输入身高",maxlength:"3"},null,8,["modelValue"])])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("体重(kg)")])),_:1}),d(_,{class:"input-field",type:"number",modelValue:l.weight,"onUpdate:modelValue":s[3]||(s[3]=e=>l.weight=e),placeholder:"请输入体重",maxlength:"3"},null,8,["modelValue"])])),_:1})])),_:1}),d(u,{class:"form-section"},{default:c((()=>[d(u,{class:"section-title"},{default:c((()=>[p("教育工作")])),_:1}),d(u,{class:"select-group"},{default:c((()=>[d(o,{class:"select-label"},{default:c((()=>[p("学历")])),_:1}),d(v,{class:"picker",onChange:F,value:L.value,range:P},{default:c((()=>[d(u,{class:"picker-value"},{default:c((()=>[p(m(P[L.value]||"请选择学历"),1)])),_:1})])),_:1},8,["value"])])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("学历证明")])),_:1}),d(u,{class:"upload-field",onClick:E},{default:c((()=>[l.educationCert?(r(),n(o,{key:1,class:"uploaded"},{default:c((()=>[p("已上传")])),_:1})):(r(),n(o,{key:0},{default:c((()=>[p("上传证明")])),_:1})),d(o,{class:"upload-icon"},{default:c((()=>[p("+")])),_:1})])),_:1})])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("公司")])),_:1}),d(_,{class:"input-field",type:"text",modelValue:l.company,"onUpdate:modelValue":s[4]||(s[4]=e=>l.company=e),placeholder:"请输入公司名称",maxlength:"50"},null,8,["modelValue"])])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("职位")])),_:1}),d(_,{class:"input-field",type:"text",modelValue:l.position,"onUpdate:modelValue":s[5]||(s[5]=e=>l.position=e),placeholder:"请输入职位",maxlength:"30"},null,8,["modelValue"])])),_:1}),d(u,{class:"select-group"},{default:c((()=>[d(o,{class:"select-label"},{default:c((()=>[p("收入水平")])),_:1}),d(v,{class:"picker",onChange:Q,value:R.value,range:N},{default:c((()=>[d(u,{class:"picker-value"},{default:c((()=>[p(m(N[R.value]||"请选择收入水平"),1)])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),d(u,{class:"form-section"},{default:c((()=>[d(u,{class:"section-title"},{default:c((()=>[p("地区信息")])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("工作城市")])),_:1}),d(_,{class:"input-field",type:"text",modelValue:l.workCity,"onUpdate:modelValue":s[6]||(s[6]=e=>l.workCity=e),placeholder:"请输入工作城市",maxlength:"30"},null,8,["modelValue"])])),_:1}),d(u,{class:"input-group"},{default:c((()=>[d(o,{class:"input-label"},{default:c((()=>[p("家乡")])),_:1}),d(_,{class:"input-field",type:"text",modelValue:l.hometown,"onUpdate:modelValue":s[7]||(s[7]=e=>l.hometown=e),placeholder:"请输入家乡",maxlength:"50"},null,8,["modelValue"])])),_:1})])),_:1}),d(u,{class:"form-section"},{default:c((()=>[d(u,{class:"section-title"},{default:c((()=>[p("婚恋状况")])),_:1}),d(u,{class:"select-group"},{default:c((()=>[d(o,{class:"select-label"},{default:c((()=>[p("婚姻状况")])),_:1}),d(v,{class:"picker",onChange:W,value:j.value,range:T},{default:c((()=>[d(u,{class:"picker-value"},{default:c((()=>[p(m(T[j.value]||"请选择婚姻状况"),1)])),_:1})])),_:1},8,["value"])])),_:1}),d(u,{class:"select-group"},{default:c((()=>[d(o,{class:"select-label"},{default:c((()=>[p("有无子女")])),_:1}),d(v,{class:"picker",onChange:X,value:O.value,range:M},{default:c((()=>[d(u,{class:"picker-value"},{default:c((()=>[p(m(M[O.value]||"请选择有无子女"),1)])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),d(u,{class:"form-section"},{default:c((()=>[d(u,{class:"section-title"},{default:c((()=>[p("资产情况")])),_:1}),d(u,{class:"select-group"},{default:c((()=>[d(o,{class:"select-label"},{default:c((()=>[p("住房情况")])),_:1}),d(v,{class:"picker",onChange:$,value:z.value,range:q},{default:c((()=>[d(u,{class:"picker-value"},{default:c((()=>[p(m(q[z.value]||"请选择住房情况"),1)])),_:1})])),_:1},8,["value"])])),_:1}),d(u,{class:"select-group"},{default:c((()=>[d(o,{class:"select-label"},{default:c((()=>[p("车辆情况")])),_:1}),d(v,{class:"picker",onChange:D,value:B.value,range:A},{default:c((()=>[d(u,{class:"picker-value"},{default:c((()=>[p(m(A[B.value]||"请选择车辆情况"),1)])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),d(u,{class:"form-section"},{default:c((()=>[d(u,{class:"section-title"},{default:c((()=>[p("个人介绍")])),_:1}),d(u,{class:"textarea-group"},{default:c((()=>[d(h,{class:"textarea-field",modelValue:l.selfIntroduction,"onUpdate:modelValue":s[8]||(s[8]=e=>l.selfIntroduction=e),placeholder:"请简单介绍自己",maxlength:"500"},null,8,["modelValue"]),d(u,{class:"textarea-counter"},{default:c((()=>{var e;return[p(m((null==(e=l.selfIntroduction)?void 0:e.length)||0)+"/500",1)]})),_:1})])),_:1})])),_:1}),d(u,{class:"form-section"},{default:c((()=>[d(u,{class:"section-title"},{default:c((()=>[p("兴趣爱好")])),_:1}),d(u,{class:"textarea-group"},{default:c((()=>[d(h,{class:"textarea-field",modelValue:l.hobby,"onUpdate:modelValue":s[9]||(s[9]=e=>l.hobby=e),placeholder:"请填写您的兴趣爱好，用逗号分隔",maxlength:"200"},null,8,["modelValue"]),d(u,{class:"textarea-counter"},{default:c((()=>{var e;return[p(m((null==(e=l.hobby)?void 0:e.length)||0)+"/200",1)]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a1f7c4ae"]]);export{P as default};
