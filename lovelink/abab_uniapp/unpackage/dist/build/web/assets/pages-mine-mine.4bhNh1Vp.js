import{_ as e,r as a,a as s,o as t,d as l,w as i,g as n,i as c,f as o,h as u,j as r,k as d,t as f,A as m,l as p,m as g,F as _,n as v,p as k,s as y,H as w,J as C,I as h,q as b,u as x}from"./index-BpPI9udZ.js";import{_ as V}from"./coin.DbIpHXjZ.js";import{o as E}from"./uni-app.es.BvOIZWhW.js";import{getByUserInfo as D}from"./api-user-auth.CC_RESsW.js";import{g as I}from"./wallet.j0ZDQvx-.js";import j from"./api-moment.C6FdyTFv.js";const F=e({__name:"mine",setup(e){const F=a({avatar:!1,coin:!1}),L=s(0),T=a({id:"",nickname:"心动用户",avatar:"/static/mine/avatar.png",gender:1,age:28,followers:0,following:0,likes:0,isVip:!1,vipExpireDate:"2023-12-31",isVerified:0});async function $(){try{if(!n("token"))return void console.log("未登录，无法获取钱包信息");const e=await I();200===e.code&&(L.value=e.data.coinBalance||0)}catch(e){console.error("获取钱包信息失败:",e)}}async function B(){var e;try{if(!n("token"))return void console.log("未登录，无法获取用户动态");U.value=!0,q.value="";const a=await j.getMyMoments(1,3);if(200===a.code){const s=(null==(e=a.data)?void 0:e.records)||[];P.value=s.map((e=>({id:e.momentId,title:e.content,image:e.mediaList&&e.mediaList.length>0?e.mediaList[0].mediaUrl:"/static/mine/default-post.png",likes:e.likeCount||0,comments:e.commentCount||0,momentData:e}))),console.log("用户动态获取成功:",P.value)}else q.value=a.message||"获取动态失败",console.error("获取用户动态失败:",a)}catch(a){q.value="获取动态失败",console.error("获取用户动态异常:",a)}finally{U.value=!1}}t((()=>{$()})),E((()=>{!async function(){try{const e=n("token");if(!e)return void console.log("未登录，无法获取用户信息");const a=await D(e);a&&200===a.code&&a.data?(T.id=a.data.userId,T.nickname=a.data.nickname||"心动用户",T.avatar=a.data.avatarUrl||"/static/mine/avatar.png",T.gender=a.data.gender||1,T.followers=a.data.fan||0,T.following=a.data.countFollow||0,T.likes=a.data.countLike||0,T.isVip=1===a.data.isVip,T.vipExpireDate=a.data.vipExpireTime?new Date(a.data.vipExpireTime).toLocaleDateString():"",T.isVerified=a.data.isVerified,console.log("用户信息获取成功:",T)):console.error("获取用户信息失败:",a)}catch(e){console.error("获取用户信息异常:",e)}}(),$(),B()}));const M=[{name:"我的喜欢",icon:"icon-like",url:"/pages/mine/likes"},{name:"我的收藏",icon:"icon-favorite",url:"/pages/mine/favorites"},{name:"每日签到",icon:"icon-sign",url:"/pages/sign/sign"},{name:"优惠券",icon:"icon-voucher",url:"/pages/voucher/voucher-list"},{name:"我的相册",icon:"icon-album",url:"/pages/mine/album"},{name:"我的活动",icon:"icon-activity",url:"/pages/mine/activities"},{name:"我的礼物",icon:"icon-gift",url:"/pages/mine/gifts"},{name:"我的钱包",icon:"icon-wallet",url:"/pages/mine/wallet"},{name:"客服中心",icon:"icon-service",url:"/pages/mine/service"}],P=s([]),U=s(!1),q=s("");function z(e){F[e]=!0}function A(){k({url:"/pages/user/fans-list"})}function H(){k({url:"/pages/user/following-list"})}function J(){k({url:"/pages/mine/likes-received"})}function S(){const e=(null==T?void 0:T.id)||"";k({url:"/pages/profile/edit-profile"+(e?`?id=${e}`:""),fail:e=>{console.error("跳转失败:",e),y({title:"跳转失败，请稍后重试",icon:"none"})}})}function G(){k({url:"/pages/vip/recharge"})}function K(e){k({url:e.url})}function N(){if(!n("token"))return y({title:"请先登录",icon:"none"}),void k({url:"/pages/login/login"});k({url:"/pages/wallet/wallet"})}function O(){k({url:"/pages/moment/list?type=mine"})}function Q(){k({url:"/pages/moment/publish"})}function R(){k({url:"/pages/mine/settings"})}function W(){k({url:"/pages/mine/feedback"})}function X(){k({url:"/pages/mine/about"})}function Y(){w({title:"退出登录",content:"确定要退出当前账号吗？\n您的个人信息将被清除",confirmText:"退出",cancelText:"取消",confirmColor:"#FF6B8B",cancelColor:"#8E8E93",success:e=>{e.confirm&&(C("token"),C("userInfo"),T.id="",T.nickname="心动用户",T.avatar="/static/mine/avatar.png",T.gender=1,T.followers=0,T.following=0,T.likes=0,T.isVip=!1,T.isVerified=0,y({title:"已安全退出",icon:"success",duration:1500,success:()=>{setTimeout((()=>{h({url:"/pages/login/login"})}),1e3)}}))}})}return(e,a)=>{const s=c,t=b,n=x;return o(),l(s,{class:"mine-page"},{default:i((()=>[u(s,{class:"bg-layer"},{default:i((()=>[u(s,{class:"bg-gradient"}),u(s,{class:"overlay-gradient"})])),_:1}),u(s,{class:"content-container"},{default:i((()=>[u(s,{class:"header"},{default:i((()=>[u(s,{class:"left-section"},{default:i((()=>[u(t,{class:"page-title"},{default:i((()=>[r("我的")])),_:1})])),_:1}),u(s,{class:"currency-section",onClick:N},{default:i((()=>[u(n,{class:"currency-icon",src:V,mode:"aspectFit",onError:a[0]||(a[0]=e=>z("coin"))},{default:i((()=>[F.coin?(o(),l(s,{key:0,class:"coin-placeholder"})):d("",!0)])),_:1}),u(t,{class:"currency-amount"},{default:i((()=>[r(f(L.value),1)])),_:1})])),_:1})])),_:1}),u(s,{class:"user-card"},{default:i((()=>[u(s,{class:"user-info"},{default:i((()=>[u(n,{class:"avatar",src:T.avatar,mode:"aspectFill",onError:a[1]||(a[1]=e=>z("avatar"))},{default:i((()=>[F.avatar?(o(),l(s,{key:0,class:"avatar-placeholder"},{default:i((()=>[u(t,{class:"avatar-text"},{default:i((()=>[r(f(T.nickname.substring(0,1)),1)])),_:1})])),_:1})):d("",!0)])),_:1},8,["src"]),u(s,{class:"user-detail"},{default:i((()=>[u(s,{class:"name-row"},{default:i((()=>[u(t,{class:"nickname"},{default:i((()=>[r(f(T.nickname),1)])),_:1}),u(s,{class:m(["gender-tag",1===T.gender?"male":"female"])},{default:i((()=>[u(t,{class:"gender-icon"},{default:i((()=>[r(f(1===T.gender?"♂":"♀"),1)])),_:1})])),_:1},8,["class"])])),_:1}),u(s,{class:"user-desc"},{default:i((()=>[u(t,{class:"user-id"},{default:i((()=>[r("ID: "+f(T.id),1)])),_:1}),1===T.isVerified?(o(),l(t,{key:0,class:"user-verified verified"},{default:i((()=>[r("已实名")])),_:1})):(o(),l(t,{key:1,class:"user-verified unverified"},{default:i((()=>[r("未实名")])),_:1}))])),_:1})])),_:1})])),_:1}),u(s,{class:"user-stats"},{default:i((()=>[u(s,{class:"stat-item",onClick:A},{default:i((()=>[u(t,{class:"stat-num"},{default:i((()=>[r(f(T.followers),1)])),_:1}),u(t,{class:"stat-label"},{default:i((()=>[r("粉丝")])),_:1})])),_:1}),u(s,{class:"stat-item",onClick:H},{default:i((()=>[u(t,{class:"stat-num"},{default:i((()=>[r(f(T.following),1)])),_:1}),u(t,{class:"stat-label"},{default:i((()=>[r("关注")])),_:1})])),_:1}),u(s,{class:"stat-item",onClick:J},{default:i((()=>[u(t,{class:"stat-num"},{default:i((()=>[r(f(T.likes),1)])),_:1}),u(t,{class:"stat-label"},{default:i((()=>[r("获赞")])),_:1})])),_:1})])),_:1}),u(s,{class:"edit-profile-btn",onClick:S},{default:i((()=>[u(t,null,{default:i((()=>[r("编辑资料")])),_:1})])),_:1})])),_:1}),u(s,{class:"vip-card",onClick:G},{default:i((()=>[u(s,{class:"vip-info"},{default:i((()=>[u(t,{class:"vip-title"},{default:i((()=>[r(f(T.isVip?"VIP会员":"开通VIP"),1)])),_:1}),u(t,{class:"vip-desc"},{default:i((()=>[r(f(T.isVip?"会员有效期至 "+T.vipExpireDate:"专属特权 · 1v1精准配对"),1)])),_:1})])),_:1}),u(s,{class:"vip-button"},{default:i((()=>[r(f(T.isVip?"续费":"立即开通"),1)])),_:1})])),_:1}),u(s,{class:"menu-section"},{default:i((()=>[u(s,{class:"menu-row"},{default:i((()=>[(o(!0),p(_,null,g(M.slice(0,4),((e,a)=>(o(),l(s,{class:"menu-item",key:a,onClick:a=>K(e)},{default:i((()=>[u(s,{class:m(["menu-icon",e.icon])},null,8,["class"]),u(t,{class:"menu-name"},{default:i((()=>[r(f(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),u(s,{class:"menu-row"},{default:i((()=>[(o(!0),p(_,null,g(M.slice(4,8),((e,a)=>(o(),l(s,{class:"menu-item",key:a+4,onClick:a=>K(e)},{default:i((()=>[u(s,{class:m(["menu-icon",e.icon])},null,8,["class"]),u(t,{class:"menu-name"},{default:i((()=>[r(f(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),u(s,{class:"section posts-section"},{default:i((()=>[u(s,{class:"section-header"},{default:i((()=>[u(t,{class:"section-title"},{default:i((()=>[r("我的动态")])),_:1}),u(t,{class:"more-link",onClick:O},{default:i((()=>[r("查看全部")])),_:1})])),_:1}),U.value?(o(),l(s,{key:0,class:"loading-posts"},{default:i((()=>[u(t,{class:"loading-text"},{default:i((()=>[r("加载中...")])),_:1})])),_:1})):q.value?(o(),l(s,{key:1,class:"error-posts"},{default:i((()=>[u(t,{class:"error-text"},{default:i((()=>[r(f(q.value),1)])),_:1}),u(s,{class:"retry-btn",onClick:B},{default:i((()=>[u(t,null,{default:i((()=>[r("重试")])),_:1})])),_:1})])),_:1})):P.value.length>0?(o(),l(s,{key:2,class:"posts-list"},{default:i((()=>[(o(!0),p(_,null,g(P.value,((e,a)=>(o(),l(s,{class:"post-item",key:a,onClick:a=>function(e){e.momentData?k({url:`/pages/moment/detail?id=${e.momentData.momentId}`}):k({url:`/pages/mine/post-detail?id=${e.id}`})}(e)},{default:i((()=>[u(n,{class:"post-image",src:e.image,mode:"aspectFill",onError:e=>z(`post${a}`)},{default:i((()=>[F[`post${a}`]?(o(),l(s,{key:0,class:"image-placeholder"})):d("",!0)])),_:2},1032,["src","onError"]),u(t,{class:"post-title"},{default:i((()=>[r(f(e.title),1)])),_:2},1024),u(s,{class:"post-stats"},{default:i((()=>[u(s,{class:"stat"},{default:i((()=>[u(t,{class:"stat-icon like-icon"}),u(t,{class:"stat-count"},{default:i((()=>[r(f(e.likes),1)])),_:2},1024)])),_:2},1024),u(s,{class:"stat"},{default:i((()=>[u(t,{class:"stat-icon comment-icon"}),u(t,{class:"stat-count"},{default:i((()=>[r(f(e.comments),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(o(),l(s,{key:3,class:"empty-posts"},{default:i((()=>[u(t,{class:"empty-text"},{default:i((()=>[r("还没有发布动态，快去分享你的心情吧~")])),_:1}),u(s,{class:"create-post-btn",onClick:Q},{default:i((()=>[u(t,null,{default:i((()=>[r("发布动态")])),_:1})])),_:1})])),_:1}))])),_:1}),u(s,{class:"settings-section"},{default:i((()=>[u(s,{class:"setting-item",onClick:R},{default:i((()=>[u(t,{class:"setting-name"},{default:i((()=>[r("设置")])),_:1}),u(t,{class:"setting-arrow"})])),_:1}),u(s,{class:"setting-item",onClick:W},{default:i((()=>[u(t,{class:"setting-name"},{default:i((()=>[r("意见反馈")])),_:1}),u(t,{class:"setting-arrow"})])),_:1}),u(s,{class:"setting-item",onClick:X},{default:i((()=>[u(t,{class:"setting-name"},{default:i((()=>[r("关于我们")])),_:1}),u(t,{class:"setting-arrow"})])),_:1}),u(s,{class:"setting-item logout-item",onClick:Y},{default:i((()=>[u(t,{class:"setting-name logout-text"},{default:i((()=>[r("退出登录")])),_:1}),u(t,{class:"setting-arrow"})])),_:1})])),_:1})])),_:1}),u(v)])),_:1})}}},[["__scopeId","data-v-5b090416"]]);export{F as default};
