function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/api-moment.C6FdyTFv.js","assets/index-BpPI9udZ.js","assets/index-DMIaa8Q1.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{_ as a,a as e,a4 as t,s as l,o as s,a5 as o,b as c,g as n,d as i,w as u,i as r,f as d,h as m,j as v,a3 as f,t as _,k as g,l as p,m as k,F as y,A as h,Q as w,X as C,I as x,a6 as b,q as L,u as I,v as D,M as E,D as j}from"./index-BpPI9udZ.js";import{_ as F,a as V}from"./eye.BJNDfSeB.js";import{c as A}from"./uni-app.es.BvOIZWhW.js";import{checkUserFollow as M,toggleUserFollow as T}from"./api-user-detail.fhFDcuKa.js";const U=a({__name:"detail",setup(a){const U=e(null),z=e([]),O=e(""),P=e(!1),R=e(""),H=e({}),q=e(0),B=e(!1),K=e(!1),Q=e(!1),S=t((()=>(H.value.windowHeight||667)-88-100));async function X(){var a,e;try{const t=await c((()=>import("./api-moment.C6FdyTFv.js")),__vite__mapDeps([0,1,2])),l=await t.default.getCommentList(R.value);200===l.code?(z.value=(null==(a=l.data)?void 0:a.records)||[],console.log("评论列表数据:",l.data),console.log("评论记录:",null==(e=l.data)?void 0:e.records)):(console.error("获取评论列表失败:",l.message),z.value=[])}catch(t){console.error("加载评论列表失败:",t),z.value=[]}}function G(){w().length>1?C():x({url:"/pages/index/index"})}async function J(){try{const a=await c((()=>import("./api-moment.C6FdyTFv.js")),__vite__mapDeps([0,1,2]));200===(await a.default.likeMoment(R.value)).code&&(U.value.isLiked=!U.value.isLiked,U.value.likeCount=U.value.isLiked?(U.value.likeCount||0)+1:Math.max((U.value.likeCount||0)-1,0))}catch(a){console.error("点赞失败:",a),l({title:"操作失败",icon:"error"})}}function N(){P.value=!0}function W(){uni.onKeyboardHeightChange((a=>{q.value=a.height}))}function Y(){P.value=!1,q.value=0}async function Z(){if(O.value.trim())try{const a=await c((()=>import("./api-moment.C6FdyTFv.js")),__vite__mapDeps([0,1,2])),e=await a.default.addComment(R.value,O.value.trim());200===e.code?(O.value="",P.value=!1,q.value=0,await X(),U.value&&(U.value.commentCount=(U.value.commentCount||0)+1),l({title:"评论成功",icon:"success"}),setTimeout((()=>{b({selector:".comment-section",duration:300})}),100)):l({title:e.message||"评论失败",icon:"error"})}catch(a){console.error("评论失败:",a),l({title:"网络错误",icon:"error"})}else l({title:"请输入评论内容",icon:"none"})}function $(a){console.log("头像加载失败:",a),a.target.src="/static/default-avatar.svg"}function aa(a){console.log("评论头像加载失败:",a),a.target.src="/static/default-avatar.svg"}async function ea(){if(!Q.value&&U.value)try{Q.value=!0;const a=await T(U.value.userId);200===a.code?(B.value=!B.value,l({title:a.message||(B.value?"已关注":"取消关注"),icon:"success"})):l({title:a.message||"操作失败",icon:"none"})}catch(a){console.error("关注操作失败:",a),l({title:"网络错误，请重试",icon:"none"})}finally{Q.value=!1}}function ta(a){if(!a)return"";const e=new Date(a),t=new Date-e;return t<6e4?"刚刚":t<36e5?Math.floor(t/6e4)+"分钟前":t<864e5?Math.floor(t/36e5)+"小时前":t<6048e5?Math.floor(t/864e5)+"天前":e.toLocaleDateString()}return A((a=>{if(console.log("页面加载参数:",a),R.value=a.id,!R.value)return console.error("缺少动态ID参数"),void l({title:"参数错误",icon:"error"});"comment"===a.action&&setTimeout((()=>{P.value=!0}),500),async function(){await async function(){try{const a=await c((()=>import("./api-moment.C6FdyTFv.js")),__vite__mapDeps([0,1,2])),e=await a.default.getMomentDetail(R.value);200===e.code?(U.value=e.data,console.log("动态详情数据:",e.data),function(){if(!n("token")||!U.value)return void(K.value=!1);try{const a=n("userId");K.value=a&&a==U.value.userId}catch(a){console.error("检查当前用户失败:",a),K.value=!1}}(),K.value||await async function(){if(!U.value||K.value)return;try{const a=await M(U.value.userId);200===a.code&&(B.value=a.data||!1)}catch(a){console.error("检查关注状态失败:",a)}}(),await a.default.incrementViewCount(R.value)):(console.error("获取动态详情失败:",e.message),l({title:e.message||"获取失败",icon:"error"}))}catch(a){console.error("加载动态详情失败:",a),l({title:"网络错误",icon:"error"})}}(),await X()}()})),s((()=>{o({success:a=>{H.value=a}})})),(a,e)=>{const t=r,l=L,s=I,o=D,c=E;return d(),i(t,{class:"moment-detail-page"},{default:u((()=>[m(t,{class:"bg-layer"},{default:u((()=>[m(t,{class:"bg-gradient"})])),_:1}),m(t,{class:"content-container"},{default:u((()=>[m(t,{class:"custom-navbar"},{default:u((()=>[m(t,{class:"navbar-left",onClick:G},{default:u((()=>[m(l,{class:"back-icon"},{default:u((()=>[v("‹")])),_:1}),m(l,{class:"back-text"},{default:u((()=>[v("返回")])),_:1})])),_:1}),m(t,{class:"navbar-center"},{default:u((()=>[m(l,{class:"navbar-title"},{default:u((()=>[v("动态详情")])),_:1})])),_:1}),m(t,{class:"navbar-right"})])),_:1}),m(o,{"scroll-y":"",class:"scroll-area",style:f({height:S.value+"px"})},{default:u((()=>[U.value?(d(),i(t,{key:0,class:"moment-item"},{default:u((()=>[m(t,{class:"user-info"},{default:u((()=>[m(s,{src:U.value.avatarUrl||"/static/default-avatar.svg",class:"avatar",mode:"aspectFill",onError:$},null,8,["src"]),m(t,{class:"user-details"},{default:u((()=>[m(l,{class:"nickname"},{default:u((()=>[v(_(U.value.nickname||"匿名用户"),1)])),_:1}),m(l,{class:"time"},{default:u((()=>[v(_(ta(U.value.publishTime)),1)])),_:1})])),_:1}),K.value?g("",!0):(d(),i(t,{key:0,class:"follow-btn",onClick:ea},{default:u((()=>[m(l,{class:"follow-text"},{default:u((()=>[v(_(B.value?"已关注":"关注"),1)])),_:1})])),_:1}))])),_:1}),U.value.content?(d(),i(t,{key:0,class:"content"},{default:u((()=>[m(l,null,{default:u((()=>[v(_(U.value.content),1)])),_:1})])),_:1})):g("",!0),U.value.location?(d(),i(t,{key:1,class:"location"},{default:u((()=>[m(l,{class:"location-icon"},{default:u((()=>[v("📍")])),_:1}),m(l,{class:"location-text"},{default:u((()=>[v(_(U.value.location),1)])),_:1})])),_:1})):g("",!0),U.value.mediaList&&U.value.mediaList.length>0?(d(),i(t,{key:2,class:"media-grid"},{default:u((()=>[(d(!0),p(y,null,k(U.value.mediaList,((a,e)=>(d(),i(s,{key:a.mediaId,src:a.mediaUrl,class:"media-image",mode:"aspectFill",onClick:a=>function(a){const e=U.value.mediaList.map((a=>a.mediaUrl));j({urls:e,current:a})}(e)},{default:u((()=>[a.mediaUrl?g("",!0):(d(),i(t,{key:0,class:"image-placeholder"}))])),_:2},1032,["src","onClick"])))),128))])),_:1})):g("",!0),m(t,{class:"actions"},{default:u((()=>[m(t,{class:"action-item",onClick:J},{default:u((()=>[m(s,{src:U.value.isLiked?"/static/icons/heart-filled.png":"/static/icons/heart.png",class:"action-icon-img",mode:"aspectFit"},null,8,["src"]),m(l,{class:"action-text"},{default:u((()=>[v(_(U.value.likeCount||0),1)])),_:1})])),_:1}),m(t,{class:"action-item",onClick:N},{default:u((()=>[m(s,{src:F,class:"action-icon-img",mode:"aspectFit"}),m(l,{class:"action-text"},{default:u((()=>[v(_(z.value.length),1)])),_:1})])),_:1}),m(t,{class:"action-item"},{default:u((()=>[m(s,{src:V,class:"action-icon-img",mode:"aspectFit"}),m(l,{class:"action-text"},{default:u((()=>[v(_(U.value.viewCount||0),1)])),_:1})])),_:1})])),_:1})])),_:1})):g("",!0),m(t,{class:"comment-section"},{default:u((()=>[m(t,{class:"comment-title"},{default:u((()=>[v("评论 ("+_(z.value.length)+")",1)])),_:1}),0===z.value.length?(d(),i(t,{key:0,class:"no-comments"},{default:u((()=>[m(l,null,{default:u((()=>[v("暂无评论，快来抢沙发吧~")])),_:1})])),_:1})):(d(),i(t,{key:1,class:"comment-list"},{default:u((()=>[(d(!0),p(y,null,k(z.value,(a=>(d(),i(t,{key:a.commentId,class:"comment-item"},{default:u((()=>[m(s,{src:a.avatarUrl||"/static/default-avatar.svg",class:"comment-avatar",mode:"aspectFill",onError:aa},null,8,["src"]),m(t,{class:"comment-content"},{default:u((()=>[m(t,{class:"comment-header"},{default:u((()=>[m(l,{class:"comment-nickname"},{default:u((()=>[v(_(a.nickname||"匿名用户"),1)])),_:2},1024),m(l,{class:"comment-time"},{default:u((()=>[v(_(ta(a.createdAt)),1)])),_:2},1024)])),_:2},1024),m(l,{class:"comment-text"},{default:u((()=>[v(_(a.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1})])),_:1},8,["style"])])),_:1}),m(t,{class:h(["comment-input-container",{"keyboard-active":q.value>0}]),style:f({bottom:q.value+"px"})},{default:u((()=>[m(t,{class:"comment-input-wrapper"},{default:u((()=>[m(t,{class:"input-area"},{default:u((()=>[m(c,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=a=>O.value=a),class:"comment-input",placeholder:"好想约吗",focus:P.value,onBlur:Y,onFocus:W,onConfirm:Z,"confirm-type":"send",maxlength:"500"},null,8,["modelValue","focus"])])),_:1}),m(t,{class:h(["send-button",{active:O.value.trim()}]),onClick:Z},{default:u((()=>[m(l,{class:"send-text"},{default:u((()=>[v("发送")])),_:1})])),_:1},8,["class"])])),_:1})])),_:1},8,["class","style"])])),_:1})}}},[["__scopeId","data-v-13425e48"]]);export{U as default};
