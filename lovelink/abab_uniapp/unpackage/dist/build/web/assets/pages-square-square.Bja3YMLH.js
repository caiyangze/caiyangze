function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/api-square.ciSKT7xd.js","assets/index-BpPI9udZ.js","assets/index-DMIaa8Q1.css","assets/api-moment.C6FdyTFv.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{_ as a,r as e,a as t,o as s,g as l,c as n,d as o,w as i,b as c,z as r,s as u,i as d,f as m,h as f,j as g,t as p,k as _,l as v,m as k,F as h,n as y,p as C,q as w,u as L,P as I,x as b,A as M,B as E,C as x,D}from"./index-BpPI9udZ.js";import{_ as N}from"./coin.DbIpHXjZ.js";import{_ as P,a as j}from"./eye.BJNDfSeB.js";import{o as q,a as z,b as $}from"./uni-app.es.BvOIZWhW.js";import{g as A}from"./wallet.j0ZDQvx-.js";const F=a({__name:"square",setup(a){const F=e({coin:!1}),T=t(0),S=t(null),U=["北京","上海","广州","深圳","杭州","成都","重庆","武汉","南京","西安"],V=t([0]),O=t("北京"),R=t(""),B=t(0),Y=[{name:"推荐",type:"recommend"},{name:"附近",type:"nearby"},{name:"新人",type:"new"},{name:"活跃",type:"active"},{name:"动态广场",type:"moment"}],G=t([]),H=e({pageNum:1,pageSize:10,total:0,loading:!1,hasMore:!0}),J=t([]),K=t(!1),Q=e({pageNum:1,pageSize:10,total:0,loading:!1,hasMore:!0});function W(a){if(a.userProfile&&a.userProfile.age)return a.userProfile.age;if(a.birthDate){const e=function(a){if(!a)return null;const e=new Date(a),t=new Date;let s=t.getFullYear()-e.getFullYear();const l=t.getMonth()-e.getMonth();return(l<0||0===l&&t.getDate()<e.getDate())&&s--,s>0?s:null}(a.birthDate);if(e)return e}return"未知"}function X(a){return a.userProfile&&a.userProfile.selfIntroduction?a.userProfile.selfIntroduction:"这个人很神秘，没有留下介绍"}function Z(a){return a.userTags&&a.userTags.length>0?a.userTags:[{tagName:"暂无标签"}]}async function aa(a="recommend",e=!1){try{if(e&&(H.pageNum=1,H.hasMore=!0),!H.hasMore&&!e)return;H.loading=!0;const a=await c((()=>import("./api-square.ciSKT7xd.js")),__vite__mapDeps([0,1,2])),t=await a.default.getUserList(H.pageNum,H.pageSize);if(200===t.code){H.total=t.data.total,H.hasMore=H.pageNum*H.pageSize<H.total;const a=t.data.records.map((a=>({id:a.userId,name:a.nickname||"匿名用户",age:W(a),selfIntroduction:X(a),avatar:a.avatarUrl||"/static/default-avatar.png",tags:Z(a),isLiked:!1})));G.value=e?a:G.value.concat(a),H.pageNum++,console.log("用户列表获取成功:",G.value)}else console.error("用户列表获取失败:",t),1===H.pageNum&&ea()}catch(t){console.error("用户列表获取异常:",t),1===H.pageNum&&ea()}finally{H.loading=!1,e&&r()}}function ea(){G.value=[{id:1,name:"小雨",age:26,tags:["旅行","摄影","美食"],intro:"喜欢旅行，热爱生活，期待遇见有趣的灵魂",avatar:"/static/square/avatar1.png",isLiked:!1},{id:2,name:"阳阳",age:28,tags:["工程师","健身","电影"],intro:"工作认真负责，生活热情洋溢，喜欢健身和看电影",avatar:"/static/square/avatar2.png",isLiked:!1},{id:3,name:"小米",age:25,tags:["教师","阅读","音乐"],intro:"温柔贤淑，喜欢阅读和音乐，希望遇到志同道合的人",avatar:"/static/square/avatar3.png",isLiked:!1},{id:4,name:"大壮",age:30,tags:["医生","烹饪","篮球"],intro:"稳重可靠，工作是医生，业余爱好烹饪和打篮球",avatar:"/static/square/avatar4.png",isLiked:!1},{id:5,name:"晓晓",age:27,tags:["设计师","插画","咖啡"],intro:"创意无限，热爱设计和插画，喜欢品尝各种咖啡",avatar:"/static/square/avatar5.png",isLiked:!1},{id:6,name:"明明",age:29,tags:["金融","游泳","钢琴"],intro:"从事金融行业，爱好游泳和弹钢琴，性格开朗",avatar:"/static/square/avatar6.png",isLiked:!1}]}function ta(a){F[a]=!0}function sa(){R.value=O.value;const a=U.findIndex((a=>a===O.value));-1!==a&&(V.value=[a]),S.value.open()}function la(a){const e=a.detail.value[0];R.value=U[e]}function na(){O.value=R.value,S.value.close()}function oa(){S.value.close()}function ia(){C({url:"/pages/search/search"})}async function ca(){try{if(!l("token"))return void console.log("未登录，无法获取钱包信息");const a=await A();200===a.code&&(T.value=a.data.coinBalance||0)}catch(a){console.error("获取钱包信息失败:",a)}}function ra(){if(!l("token"))return u({title:"请先登录",icon:"none"}),void C({url:"/pages/login/login"});C({url:"/pages/wallet/wallet"})}async function ua(a=!1){if(!Q.loading){Q.loading=!0;try{const e=await c((()=>import("./api-moment.C6FdyTFv.js")),__vite__mapDeps([3,1,2])),t=a?1:Q.pageNum,s=await e.default.getPublicMoments(t,Q.pageSize);if(200!==s.code)throw new Error(s.message||"加载失败");{const e=s.data.records||[];a?(J.value=e,Q.pageNum=1,Q.hasMore=!0):J.value.push(...e),e.length<Q.pageSize?Q.hasMore=!1:Q.pageNum++}}catch(e){console.error("加载动态列表失败:",e),u({title:e.message||"加载失败",icon:"none"})}finally{Q.loading=!1,K.value=!1}}}function da(a){const e=new Date(a),t=new Date-e;return t<6e4?"刚刚":t<36e5?Math.floor(t/6e4)+"分钟前":t<864e5?Math.floor(t/36e5)+"小时前":Math.floor(t/864e5)+"天前"}function ma(a){x({itemList:["举报","不感兴趣","屏蔽用户"],success:function(a){switch(a.tapIndex){case 0:u({title:"举报成功",icon:"success"});break;case 1:u({title:"已标记",icon:"success"});break;case 2:u({title:"已屏蔽",icon:"success"})}}})}return s((()=>{aa("recommend"),ca()})),q((()=>{ca()})),z((()=>{"moment"===Y[B.value].type?(K.value=!0,ua(!0)):aa(Y[B.value].type,!0)})),$((()=>{"moment"===Y[B.value].type?!Q.loading&&Q.hasMore&&function(){if(!Q.hasMore)return;ua()}():!H.loading&&H.hasMore&&aa(Y[B.value].type)})),(a,e)=>{const t=d,s=w,l=L,r=I,x=b,q=n("uni-popup");return m(),o(t,{class:"square-page"},{default:i((()=>[f(t,{class:"bg-layer"},{default:i((()=>[f(t,{class:"bg-gradient"}),f(t,{class:"overlay-gradient"})])),_:1}),f(t,{class:"content-container"},{default:i((()=>[f(t,{class:"header"},{default:i((()=>[f(t,{class:"left-section"},{default:i((()=>[f(t,{class:"region-selector",onClick:sa},{default:i((()=>[f(s,{class:"region-text"},{default:i((()=>[g(p(O.value),1)])),_:1}),f(s,{class:"region-arrow"})])),_:1}),f(t,{class:"search-box",onClick:ia},{default:i((()=>[f(s,{class:"search-icon"}),f(s,{class:"search-placeholder"},{default:i((()=>[g("搜索")])),_:1})])),_:1})])),_:1}),f(t,{class:"currency-section",onClick:ra},{default:i((()=>[f(l,{class:"currency-icon",src:N,mode:"aspectFit",onError:e[0]||(e[0]=a=>ta("coin"))},{default:i((()=>[F.coin?(m(),o(t,{key:0,class:"coin-placeholder"})):_("",!0)])),_:1}),f(s,{class:"currency-amount"},{default:i((()=>[g(p(T.value),1)])),_:1})])),_:1})])),_:1}),f(t,{class:"main-content"},{default:i((()=>[f(t,{class:"filter-tabs"},{default:i((()=>[(m(),v(h,null,k(Y,((a,e)=>f(t,{key:e,class:M(["filter-tab",{active:B.value===e}]),onClick:a=>function(a){B.value=a,"moment"!==Y[a].type?aa(Y[a].type,!0):ua(!0)}(e)},{default:i((()=>[f(s,null,{default:i((()=>[g(p(a.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64))])),_:1}),4!==B.value?(m(),o(t,{key:0,class:"user-grid"},{default:i((()=>[(m(!0),v(h,null,k(G.value,((a,e)=>(m(),o(t,{class:"user-card",key:e,onClick:e=>function(a){C({url:`/pages/user/user-detail?id=${a.id}`})}(a)},{default:i((()=>[f(l,{class:"user-avatar",src:a.avatar,mode:"aspectFill",onError:a=>ta(`user${e}`)},{default:i((()=>[F[`user${e}`]?(m(),o(t,{key:0,class:"avatar-placeholder"})):_("",!0)])),_:2},1032,["src","onError"]),f(t,{class:"user-info"},{default:i((()=>[f(t,{class:"user-name-row"},{default:i((()=>[f(s,{class:"user-name"},{default:i((()=>[g(p(a.name),1)])),_:2},1024),f(s,{class:"user-age"},{default:i((()=>[g(p("number"==typeof a.age?a.age+"岁":a.age),1)])),_:2},1024)])),_:2},1024),f(t,{class:"user-tags"},{default:i((()=>[(m(!0),v(h,null,k(a.tags,((a,e)=>(m(),o(s,{class:"user-tag",key:e},{default:i((()=>[g(p(a.tagName||a),1)])),_:2},1024)))),128))])),_:2},1024),f(s,{class:"user-intro"},{default:i((()=>[g(p(a.selfIntroduction),1)])),_:2},1024)])),_:2},1024),f(t,{class:"interaction-btn",onClick:E((a=>function(a,e){G.value[e].isLiked=!G.value[e].isLiked,G.value[e].isLiked&&u({title:"已喜欢",icon:"none"})}(0,e)),["stop"])},{default:i((()=>[f(s,{class:M(["btn-icon",{liked:a.isLiked}])},{default:i((()=>[g("♥")])),_:2},1032,["class"])])),_:2},1032,["onClick"])])),_:2},1032,["onClick"])))),128)),H.loading?(m(),o(t,{key:0,class:"loading-more"},{default:i((()=>[f(t,{class:"loading-icon"}),f(s,{class:"loading-text"},{default:i((()=>[g("正在加载更多...")])),_:1})])),_:1})):_("",!0),!H.hasMore&&G.value.length>0&&!H.loading?(m(),o(t,{key:1,class:"no-more-data"},{default:i((()=>[f(s,null,{default:i((()=>[g("— 已经到底啦 —")])),_:1})])),_:1})):_("",!0),0!==G.value.length||H.loading?_("",!0):(m(),o(t,{key:2,class:"empty-data"},{default:i((()=>[f(s,{class:"empty-text"},{default:i((()=>[g("暂无数据")])),_:1})])),_:1}))])),_:1})):_("",!0),4===B.value?(m(),o(t,{key:1,class:"moment-grid"},{default:i((()=>[(m(!0),v(h,null,k(J.value,(a=>(m(),o(t,{key:a.momentId,class:"moment-card",onClick:e=>async function(a){try{const e=await c((()=>import("./api-moment.C6FdyTFv.js")),__vite__mapDeps([3,1,2]));await e.default.incrementViewCount(a.momentId),a.viewCount=(a.viewCount||0)+1,C({url:`/pages/moment/detail?id=${a.momentId}`})}catch(e){console.error("跳转详情页面失败:",e),C({url:`/pages/moment/detail?id=${a.momentId}`})}}(a)},{default:i((()=>[f(t,{class:"moment-header"},{default:i((()=>[f(l,{src:a.avatarUrl||"/static/default-avatar.png",class:"user-avatar",mode:"aspectFill",onError:e=>ta(`avatar${a.momentId}`)},{default:i((()=>[F[`avatar${a.momentId}`]?(m(),o(t,{key:0,class:"avatar-placeholder"})):_("",!0)])),_:2},1032,["src","onError"]),f(t,{class:"user-info"},{default:i((()=>[f(s,{class:"user-nickname"},{default:i((()=>[g(p(a.nickname||"匿名用户"),1)])),_:2},1024),f(s,{class:"publish-time"},{default:i((()=>[g(p(da(a.createdAt)),1)])),_:2},1024)])),_:2},1024),f(t,{class:"moment-menu",onClick:E((a=>ma()),["stop"])},{default:i((()=>[f(l,{src:"/static/icons/more.png",class:"menu-icon"})])),_:2},1032,["onClick"])])),_:2},1024),a.location?(m(),o(t,{key:0,class:"moment-location"},{default:i((()=>[f(s,{class:"location-icon"},{default:i((()=>[g("📍")])),_:1}),f(s,{class:"location-text"},{default:i((()=>[g(p(a.location),1)])),_:2},1024)])),_:2},1024)):_("",!0),a.mediaList&&a.mediaList.length>0?(m(),o(t,{key:1,class:"moment-media"},{default:i((()=>{return[f(t,{class:M(["media-grid",(e=a.mediaList.length,1===e?"single":2===e?"double":3===e?"three":4===e?"four":5===e?"five":6===e?"six":7===e?"seven":8===e?"eight":"nine")])},{default:i((()=>[(m(!0),v(h,null,k(a.mediaList,((e,s)=>(m(),o(t,{key:e.mediaId,class:"media-item",onClick:E((e=>function(a,e){const t=a.map((a=>a.mediaUrl));D({urls:t,current:e})}(a.mediaList,s)),["stop"])},{default:i((()=>[f(l,{src:e.mediaUrl,class:"media-image",mode:"aspectFit",onError:a=>ta(`media${e.mediaId}`)},{default:i((()=>[F[`media${e.mediaId}`]?(m(),o(t,{key:0,class:"image-placeholder"})):_("",!0)])),_:2},1032,["src","onError"])])),_:2},1032,["onClick"])))),128))])),_:2},1032,["class"])];var e})),_:2},1024)):_("",!0),f(t,{class:"moment-content"},{default:i((()=>[f(s,null,{default:i((()=>[g(p(a.content),1)])),_:2},1024)])),_:2},1024),f(t,{class:"moment-footer"},{default:i((()=>[f(t,{class:"moment-actions"},{default:i((()=>[f(t,{class:"action-item",onClick:E((e=>async function(a){try{const e=await c((()=>import("./api-moment.C6FdyTFv.js")),__vite__mapDeps([3,1,2])),t=await e.default.likeMoment(a.momentId);if(200!==t.code)throw new Error(t.message||"操作失败");a.isLiked=!a.isLiked,a.likeCount=a.isLiked?(a.likeCount||0)+1:Math.max((a.likeCount||0)-1,0)}catch(e){console.error("点赞失败:",e),u({title:e.message||"操作失败",icon:"none"})}}(a)),["stop"])},{default:i((()=>[f(l,{src:a.isLiked?"/static/icons/heart-filled.png":"/static/icons/heart.png",class:M(["action-icon",{liked:a.isLiked}])},null,8,["src","class"]),f(s,{class:"action-count"},{default:i((()=>[g(p(a.likeCount||0),1)])),_:2},1024)])),_:2},1032,["onClick"]),f(t,{class:"action-item",onClick:E((e=>function(a){C({url:`/pages/moment/detail?id=${a.momentId}&action=comment`})}(a)),["stop"])},{default:i((()=>[f(l,{src:P,class:"action-icon"}),f(s,{class:"action-count"},{default:i((()=>[g(p(a.commentCount||0),1)])),_:2},1024)])),_:2},1032,["onClick"]),f(t,{class:"action-item"},{default:i((()=>[f(l,{src:j,class:"action-icon"}),f(s,{class:"action-count"},{default:i((()=>[g(p(a.viewCount||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),Q.loading?(m(),o(t,{key:0,class:"loading-more"},{default:i((()=>[f(t,{class:"loading-icon"}),f(s,{class:"loading-text"},{default:i((()=>[g("正在加载更多...")])),_:1})])),_:1})):_("",!0),!Q.hasMore&&J.value.length>0&&!Q.loading?(m(),o(t,{key:1,class:"no-more-data"},{default:i((()=>[f(s,null,{default:i((()=>[g("— 已经到底啦 —")])),_:1})])),_:1})):_("",!0),0!==J.value.length||Q.loading?_("",!0):(m(),o(t,{key:2,class:"empty-data"},{default:i((()=>[f(s,{class:"empty-text"},{default:i((()=>[g("暂无动态")])),_:1})])),_:1}))])),_:1})):_("",!0)])),_:1})])),_:1}),f(q,{ref_key:"regionPopup",ref:S,type:"bottom"},{default:i((()=>[f(t,{class:"region-popup"},{default:i((()=>[f(t,{class:"region-popup-header"},{default:i((()=>[f(s,{class:"cancel-btn",onClick:oa},{default:i((()=>[g("取消")])),_:1}),f(s,{class:"title"},{default:i((()=>[g("选择地区")])),_:1}),f(s,{class:"confirm-btn",onClick:na},{default:i((()=>[g("确定")])),_:1})])),_:1}),f(x,{class:"region-picker","indicator-style":"height: 80rpx;",value:V.value,onChange:la},{default:i((()=>[f(r,null,{default:i((()=>[(m(),v(h,null,k(U,((a,e)=>f(t,{class:"picker-item",key:e},{default:i((()=>[g(p(a),1)])),_:2},1024))),64))])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},512),f(y)])),_:1})}}},[["__scopeId","data-v-7031f230"]]);export{F as default};
